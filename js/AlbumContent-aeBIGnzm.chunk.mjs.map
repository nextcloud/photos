{"version":3,"file":"AlbumContent-aeBIGnzm.chunk.mjs","sources":["../src/views/AlbumContent.vue"],"sourcesContent":["<!--\n  - SPDX-FileCopyrightText: 2022 Nextcloud GmbH and Nextcloud contributors\n  - SPDX-License-Identifier: AGPL-3.0-or-later\n-->\n<template>\n\t<div class=\"album-container\">\n\t\t<CollectionContent\n\t\t\tref=\"collectionContent\"\n\t\t\t:collection=\"album\"\n\t\t\t:collection-file-ids=\"albumFileIds\"\n\t\t\t:loading=\"loadingCollection || loadingCollectionFiles\"\n\t\t\t:error=\"errorFetchingCollection || errorFetchingCollectionFiles\">\n\t\t\t<!-- Header -->\n\t\t\t<HeaderNavigation\n\t\t\t\tkey=\"navigation\"\n\t\t\t\tslot=\"header\"\n\t\t\t\tslot-scope=\"{ selectedFileIds, resetSelection }\"\n\t\t\t\t:loading=\"loadingCollectionFiles\"\n\t\t\t\t:params=\"{ albumName }\"\n\t\t\t\t:path=\"'/' + albumName\"\n\t\t\t\t:title=\"albumName\"\n\t\t\t\t@refresh=\"fetchAlbumContent\">\n\t\t\t\t<div\n\t\t\t\t\tv-if=\"album !== undefined && album.attributes.location !== ''\"\n\t\t\t\t\tslot=\"subtitle\"\n\t\t\t\t\tclass=\"album__location\">\n\t\t\t\t\t<MapMarker />{{ album.attributes.location }}\n\t\t\t\t</div>\n\n\t\t\t\t<template slot=\"default\">\n\t\t\t\t\t<NcButton\n\t\t\t\t\t\tv-if=\"selectedFileIds.length > 0\"\n\t\t\t\t\t\t:aria-label=\"t('photos', 'Unselect all')\"\n\t\t\t\t\t\t@click=\"resetSelection\">\n\t\t\t\t\t\t<template #icon>\n\t\t\t\t\t\t\t<Close />\n\t\t\t\t\t\t</template>\n\t\t\t\t\t\t{{ t('photos', 'Unselect all') }}\n\t\t\t\t\t</NcButton>\n\n\t\t\t\t\t<span v-if=\"album !== undefined\" class=\"album-container__filters\">\n\t\t\t\t\t\t<PhotosFiltersInput\n\t\t\t\t\t\t\tv-if=\"editFilters\"\n\t\t\t\t\t\t\t:value=\"album.attributes.filters\"\n\t\t\t\t\t\t\tclass=\"timeline__filters\"\n\t\t\t\t\t\t\t@update:value=\"handleFiltersChange\" />\n\t\t\t\t\t\t<PhotosFiltersDisplay v-else :filters-value=\"album.attributes.filters\" />\n\n\t\t\t\t\t\t<NcButton\n\t\t\t\t\t\t\t:title=\"t('photos', 'Toggle filter')\"\n\t\t\t\t\t\t\t:aria-label=\"t('photos', 'Toggle filter')\"\n\t\t\t\t\t\t\tdata-cy-header-action=\"toggle-filters\"\n\t\t\t\t\t\t\ttype=\"tertiary\"\n\t\t\t\t\t\t\t@click=\"toggleFilters\">\n\t\t\t\t\t\t\t<template #icon>\n\t\t\t\t\t\t\t\t<FilterCheck v-if=\"editFilters\" />\n\t\t\t\t\t\t\t\t<FilterPlus v-else />\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t</NcButton>\n\t\t\t\t\t</span>\n\t\t\t\t</template>\n\n\t\t\t\t<template v-if=\"album !== undefined\" slot=\"right\">\n\t\t\t\t\t<NcButton @click=\"showAddPhotosModal = true\">\n\t\t\t\t\t\t<template #icon>\n\t\t\t\t\t\t\t<Plus :size=\"20\" />\n\t\t\t\t\t\t</template>\n\t\t\t\t\t\t{{ t('photos', 'Add photos to this album') }}\n\t\t\t\t\t</NcButton>\n\n\t\t\t\t\t<NcButton\n\t\t\t\t\t\tv-if=\"sharingEnabled\"\n\t\t\t\t\t\ttype=\"tertiary\"\n\t\t\t\t\t\t:aria-label=\"t('photos', 'Manage collaborators for this album')\"\n\t\t\t\t\t\t@click=\"showManageCollaboratorView = true\">\n\t\t\t\t\t\t<ShareVariant slot=\"icon\" />\n\t\t\t\t\t</NcButton>\n\n\t\t\t\t\t<NcActions :aria-label=\"t('photos', 'Open actions menu')\">\n\t\t\t\t\t\t<NcActionButton\n\t\t\t\t\t\t\t:close-after-click=\"true\"\n\t\t\t\t\t\t\t:aria-label=\"t('photos', 'Edit album details')\"\n\t\t\t\t\t\t\t@click=\"showEditAlbumForm = true\">\n\t\t\t\t\t\t\t{{ t('photos', 'Edit album details') }}\n\t\t\t\t\t\t\t<Pencil slot=\"icon\" />\n\t\t\t\t\t\t</NcActionButton>\n\n\t\t\t\t\t\t<!-- Support download from arbitrary origin\n\t\t\t\t\t\t<ActionDownload v-if=\"albumFileIds.length > 0\"\n\t\t\t\t\t\t\t:selected-file-ids=\"albumFileIds\"\n\t\t\t\t\t\t\t:title=\"t('photos', 'Download all files in album')\">\n\t\t\t\t\t\t\t<DownloadMultiple slot=\"icon\" />\n\t\t\t\t\t\t</ActionDownload>-->\n\n\t\t\t\t\t\t<NcActionButton\n\t\t\t\t\t\t\t:close-after-click=\"true\"\n\t\t\t\t\t\t\t@click=\"handleDeleteAlbum\">\n\t\t\t\t\t\t\t{{ t('photos', 'Delete album') }}\n\t\t\t\t\t\t\t<Delete slot=\"icon\" />\n\t\t\t\t\t\t</NcActionButton>\n\n\t\t\t\t\t\t<template v-if=\"selectedFileIds.length > 0\">\n\t\t\t\t\t\t\t<NcActionSeparator />\n\n\t\t\t\t\t\t\t<!-- Support download from arbitrary origin\n\t\t\t\t\t\t\t<ActionDownload :selected-file-ids=\"selectedFileIds\" :title=\"t('photos', 'Download selected files')\">\n\t\t\t\t\t\t\t\t<Download slot=\"icon\" />\n\t\t\t\t\t\t\t</ActionDownload>-->\n\n\t\t\t\t\t\t\t<ActionFavorite :selected-file-ids=\"selectedFileIds\" />\n\n\t\t\t\t\t\t\t<NcActionButton\n\t\t\t\t\t\t\t\tv-if=\"removableSelectedFiles.length !== 0\"\n\t\t\t\t\t\t\t\t:close-after-click=\"true\"\n\t\t\t\t\t\t\t\t@click=\"handleRemoveFilesFromAlbum(removableSelectedFiles)\">\n\t\t\t\t\t\t\t\t{{ t('photos', 'Remove selection from album') }}\n\t\t\t\t\t\t\t\t<Close slot=\"icon\" />\n\t\t\t\t\t\t\t</NcActionButton>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</NcActions>\n\t\t\t\t</template>\n\t\t\t</HeaderNavigation>\n\n\t\t\t<!-- No content -->\n\t\t\t<NcEmptyContent\n\t\t\t\tv-if=\"album !== undefined && album.attributes.nbItems === 0 && !(loadingCollectionFiles || loadingCollection)\"\n\t\t\t\tslot=\"empty-content\"\n\t\t\t\t:name=\"t('photos', 'This album does not have any photos or videos yet!')\"\n\t\t\t\tclass=\"album__empty\">\n\t\t\t\t<ImagePlus slot=\"icon\" />\n\n\t\t\t\t<NcButton\n\t\t\t\t\tslot=\"action\"\n\t\t\t\t\tclass=\"album__empty__button\"\n\t\t\t\t\ttype=\"primary\"\n\t\t\t\t\t:aria-label=\"t('photos', 'Add photos to this album')\"\n\t\t\t\t\t@click=\"showAddPhotosModal = true\">\n\t\t\t\t\t<Plus slot=\"icon\" />\n\t\t\t\t\t{{ t('photos', \"Add\") }}\n\t\t\t\t</NcButton>\n\t\t\t</NcEmptyContent>\n\t\t</CollectionContent>\n\n\t\t<PhotosPicker\n\t\t\tv-if=\"album !== undefined\"\n\t\t\t:open.sync=\"showAddPhotosModal\"\n\t\t\t:blacklist-ids=\"albumFileIds\"\n\t\t\t:destination=\"album.basename\"\n\t\t\t:name=\"t('photos', 'Add photos to {albumName}', { albumName: albumName })\"\n\t\t\t@files-picked=\"handleFilesPicked\" />\n\n\t\t<NcModal\n\t\t\tv-if=\"showManageCollaboratorView && album !== undefined\"\n\t\t\t:name=\"t('photos', 'Manage collaborators')\"\n\t\t\t@close=\"showManageCollaboratorView = false\">\n\t\t\t<CollaboratorsSelectionForm\n\t\t\t\t:album-name=\"album.basename\"\n\t\t\t\t:collaborators=\"album.attributes.collaborators\">\n\t\t\t\t<template slot-scope=\"{ collaborators }\">\n\t\t\t\t\t<NcButton\n\t\t\t\t\t\t:aria-label=\"t('photos', 'Save collaborators for this album.')\"\n\t\t\t\t\t\ttype=\"primary\"\n\t\t\t\t\t\t:disabled=\"loadingAddCollaborators\"\n\t\t\t\t\t\t@click=\"handleSetCollaborators(collaborators)\">\n\t\t\t\t\t\t<template #icon>\n\t\t\t\t\t\t\t<NcLoadingIcon v-if=\"loadingAddCollaborators\" />\n\t\t\t\t\t\t</template>\n\t\t\t\t\t\t{{ t('photos', 'Save') }}\n\t\t\t\t\t</NcButton>\n\t\t\t\t</template>\n\t\t\t</CollaboratorsSelectionForm>\n\t\t</NcModal>\n\n\t\t<NcDialog\n\t\t\tv-if=\"showEditAlbumForm\"\n\t\t\t:name=\"t('photos', 'Edit album details')\"\n\t\t\tclose-on-click-outside\n\t\t\tsize=\"normal\"\n\t\t\t@closing=\"showEditAlbumForm = false\">\n\t\t\t<AlbumForm :album=\"album\" @done=\"redirectToNewName\" />\n\t\t</NcDialog>\n\t</div>\n</template>\n\n<script lang='ts'>\nimport type { Album } from '../store/albums.js'\n\nimport { translate } from '@nextcloud/l10n'\nimport { isMobile, NcActionButton, NcActions, NcActionSeparator, NcButton, NcDialog, NcEmptyContent, NcLoadingIcon, NcModal } from '@nextcloud/vue'\nimport Close from 'vue-material-design-icons/Close.vue'\nimport Delete from 'vue-material-design-icons/Delete.vue'\nimport FilterCheck from 'vue-material-design-icons/FilterCheck.vue'\nimport FilterPlus from 'vue-material-design-icons/FilterPlus.vue'\n// import Download from 'vue-material-design-icons/Download.vue'\n// import DownloadMultiple from 'vue-material-design-icons/DownloadMultiple.vue'\nimport ImagePlus from 'vue-material-design-icons/ImagePlus.vue'\nimport MapMarker from 'vue-material-design-icons/MapMarker.vue'\nimport Pencil from 'vue-material-design-icons/Pencil.vue'\nimport Plus from 'vue-material-design-icons/Plus.vue'\nimport ShareVariant from 'vue-material-design-icons/ShareVariant.vue'\n// import ActionDownload from '../components/Actions/ActionDownload.vue'\nimport ActionFavorite from '../components/Actions/ActionFavorite.vue'\nimport AlbumForm from '../components/Albums/AlbumForm.vue'\nimport CollaboratorsSelectionForm from '../components/Albums/CollaboratorsSelectionForm.vue'\nimport CollectionContent from '../components/Collection/CollectionContent.vue'\nimport HeaderNavigation from '../components/HeaderNavigation.vue'\nimport PhotosFiltersDisplay from '../components/PhotosFilters/PhotosFiltersDisplay.vue'\nimport PhotosFiltersInput from '../components/PhotosFilters/PhotosFiltersInput.vue'\nimport PhotosPicker from '../components/PhotosPicker.vue'\nimport FetchCollectionContentMixin from '../mixins/FetchCollectionContentMixin.js'\nimport FetchFilesMixin from '../mixins/FetchFilesMixin.js'\nimport logger from '../services/logger.js'\nimport { albumFilesExtraProps, albumsExtraProps } from '../store/albums.ts'\n\nexport default {\n\tname: 'AlbumContent',\n\tcomponents: {\n\t\t// ActionDownload,\n\t\tActionFavorite,\n\t\tAlbumForm,\n\t\tClose,\n\t\tCollaboratorsSelectionForm,\n\t\tCollectionContent,\n\t\tDelete,\n\t\t// Download,\n\t\t// DownloadMultiple,\n\t\tPhotosPicker,\n\t\tHeaderNavigation,\n\t\tImagePlus,\n\t\tMapMarker,\n\t\tNcActionButton,\n\t\tNcActions,\n\t\tNcActionSeparator,\n\t\tNcButton,\n\t\tNcDialog,\n\t\tNcEmptyContent,\n\t\tNcLoadingIcon,\n\t\tNcModal,\n\t\tPencil,\n\t\tPlus,\n\t\tShareVariant,\n\t\tFilterPlus,\n\t\tFilterCheck,\n\t\tPhotosFiltersInput,\n\t\tPhotosFiltersDisplay,\n\t},\n\n\tmixins: [\n\t\tFetchCollectionContentMixin,\n\t\tFetchFilesMixin,\n\t\tisMobile,\n\t],\n\n\tprops: {\n\t\talbumName: {\n\t\t\ttype: String,\n\t\t\tdefault: '/',\n\t\t},\n\t},\n\n\tdata() {\n\t\treturn {\n\t\t\tshowAddPhotosModal: false,\n\t\t\tshowManageCollaboratorView: false,\n\t\t\tshowEditAlbumForm: false,\n\t\t\teditFilters: false,\n\n\t\t\tloadingAddCollaborators: false,\n\t\t}\n\t},\n\n\tcomputed: {\n\t\talbum(): Album {\n\t\t\treturn this.$store.getters.getAlbum(this.albumName)\n\t\t},\n\n\t\talbumFileIds(): string[] {\n\t\t\treturn this.$store.getters.getAlbumFiles(this.albumName)\n\t\t},\n\n\t\tsharingEnabled(): boolean {\n\t\t\treturn OC.Share !== undefined\n\t\t},\n\n\t\talbumFileName(): string {\n\t\t\treturn this.$store.getters.getAlbumName(this.albumName)\n\t\t},\n\n\t\tremovableSelectedFiles() {\n\t\t\treturn (this.$refs.collectionContent?.selectedFileIds as string[])\n\t\t\t\t.map((fileId) => this.$store.state.files.files[fileId])\n\t\t\t\t.filter((file) => file.attributes['photos-album-file-origin'] !== 'filters')\n\t\t\t\t.map((file) => file.fileid.toString())\n\t\t},\n\t},\n\n\tasync mounted() {\n\t\tthis.fetchAlbum()\n\t\tthis.fetchAlbumContent()\n\t},\n\n\tmethods: {\n\t\tasync fetchAlbum() {\n\t\t\tawait this.fetchCollection(\n\t\t\t\tthis.albumFileName,\n\t\t\t\talbumsExtraProps,\n\t\t\t)\n\t\t},\n\n\t\tasync fetchAlbumContent() {\n\t\t\tawait this.fetchCollectionFiles(this.albumFileName, albumFilesExtraProps)\n\t\t},\n\n\t\tredirectToNewName({ album }) {\n\t\t\tthis.showEditAlbumForm = false\n\n\t\t\tif (this.album?.basename !== album.basename) {\n\t\t\t\tthis.$router.push(`/albums/${album.basename}`)\n\t\t\t}\n\t\t},\n\n\t\tasync handleFilesPicked(fileIds: string[]) {\n\t\t\tthis.showAddPhotosModal = false\n\t\t\tawait this.$store.dispatch('addFilesToCollection', { collectionFileName: this.album?.root + this.album?.path, fileIdsToAdd: fileIds })\n\t\t\t// Re-fetch album content to have the proper filenames.\n\t\t\tawait this.fetchAlbumContent()\n\t\t},\n\n\t\tasync handleRemoveFilesFromAlbum(fileIds: string[]) {\n\t\t\tthis.$refs.collectionContent?.onUncheckFiles(fileIds)\n\t\t\tawait this.$store.dispatch('removeFilesFromCollection', { collectionFileName: this.album?.root + this.album?.path, fileIdsToRemove: fileIds })\n\t\t},\n\n\t\tasync handleDeleteAlbum() {\n\t\t\tawait this.$store.dispatch('deleteCollection', { collectionFileName: this.album?.root + this.album?.path })\n\t\t\tthis.$router.push('/albums')\n\t\t},\n\n\t\tasync handleSetCollaborators(collaborators) {\n\t\t\ttry {\n\t\t\t\tthis.loadingAddCollaborators = true\n\t\t\t\tthis.showManageCollaboratorView = false\n\t\t\t\tawait this.$store.dispatch('updateCollection', { collectionFileName: this.album?.root + this.album?.path, properties: { collaborators } })\n\t\t\t} catch (error) {\n\t\t\t\tlogger.error('Error while setting album collaborators', { error })\n\t\t\t} finally {\n\t\t\t\tthis.loadingAddCollaborators = false\n\t\t\t}\n\t\t},\n\n\t\ttoggleFilters() {\n\t\t\tthis.editFilters = !this.editFilters\n\t\t\tif (!this.editFilters) {\n\t\t\t\tthis.extraFilters = {}\n\t\t\t\tthis.resetFetchFilesState()\n\t\t\t}\n\t\t},\n\n\t\tasync handleFiltersChange(filters) {\n\t\t\tawait this.$store.dispatch('updateCollection', { collectionFileName: this.album?.root + this.album?.path, properties: { filters } })\n\t\t\tthis.fetchAlbumContent()\n\t\t},\n\n\t\tt: translate,\n\t},\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.album-container {\n\theight: 100%;\n\n\t:deep(.collection) {\n\t\theight: 100%;\n\t}\n\n\t&__filters {\n\t\tdisplay: flex;\n\t\tgap: 8px;\n\t}\n}\n\n.album {\n\t&__title {\n\t\twidth: 100%;\n\t}\n\n\t&__name {\n\t\toverflow: hidden;\n\t\twhite-space: nowrap;\n\t\ttext-overflow: ellipsis;\n\t}\n\n\t&__location {\n\t\tmargin-left: -4px;\n\t\tdisplay: flex;\n\t\tcolor: var(--color-text-lighter);\n\t}\n}\n</style>\n"],"names":["_sfc_main","ActionFavorite","AlbumForm","Close","CollaboratorsSelectionForm","CollectionContent","Delete","PhotosPicker","HeaderNavigation","ImagePlus","MapMarker","NcActionButton","NcActions","NcActionSeparator","NcButton","NcDialog","NcEmptyContent","NcLoadingIcon","NcModal","Pencil","Plus","ShareVariant","FilterPlus","FilterCheck","PhotosFiltersInput","PhotosFiltersDisplay","FetchCollectionContentMixin","FetchFilesMixin","isMobile","fileId","file","albumsExtraProps","albumFilesExtraProps","album","fileIds","collaborators","error","logger","filters","translate"],"mappings":"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"}
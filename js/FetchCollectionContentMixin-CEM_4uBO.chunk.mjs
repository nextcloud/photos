import{d as u,a as s}from"./vue.runtime.esm-OiydnxB-.chunk.mjs";import{c as F,s as c,l as a,S as d}from"./index-ycziVi-9.chunk.mjs";import{a as g,b as f}from"./collectionFetcher-DAjdzmEV.chunk.mjs";import{A as m}from"./AbortControllerMixin-BH-eXynx.chunk.mjs";const b=u({name:"FetchCollectionContentMixin",data(){return{fetchSemaphore:new d(1),loadingCollection:!1,loadingCollectionFiles:!1,errorFetchingCollection:null,errorFetchingCollectionFiles:null}},mixins:[m],methods:{async fetchCollection(e,l,n){var i;if(this.loadingCollection)return null;try{this.loadingCollection=!0,this.errorFetchingCollection=null;const o=await f(e,{signal:this.abortController.signal},l,n);return this.$store.dispatch("addCollections",{collections:[o]}),o}catch(o){if(((i=o.response)==null?void 0:i.status)===404)return this.errorFetchingCollection=404,null;this.errorFetchingCollection=o,a.error("[PublicCollectionContent] Error fetching collection",{error:o}),c(s("photos","Failed to fetch collection."))}finally{this.loadingCollection=!1}return null},async fetchCollectionFiles(e,l=[],n){var i;if(this.loadingCollectionFiles)return[];l=[...l,...F];const o=await this.fetchSemaphore.acquire();try{this.errorFetchingCollectionFiles=null,this.loadingCollectionFiles=!0;const t=await g(e,{signal:this.abortController.signal},l,n),h=t.map(C=>{var r;return(r=C.fileid)==null?void 0:r.toString()});return this.$store.dispatch("appendFiles",t),await this.$store.commit("setCollectionFiles",{collectionFileName:e,fileIds:h}),t}catch(t){if(((i=t.response)==null?void 0:i.status)===404)return this.errorFetchingCollectionFiles=404,[];this.errorFetchingCollectionFiles=t,c(s("photos","Failed to fetch collections list.")),a.error("[PublicCollectionContent] Error fetching collection files",{error:t})}finally{this.loadingCollectionFiles=!1,this.fetchSemaphore.release(o)}return[]}}});export{b as F};
//# sourceMappingURL=FetchCollectionContentMixin-CEM_4uBO.chunk.mjs.map

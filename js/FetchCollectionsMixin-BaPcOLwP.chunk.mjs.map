{"version":3,"file":"FetchCollectionsMixin-BaPcOLwP.chunk.mjs","sources":["../src/mixins/FetchCollectionsMixin.ts"],"sourcesContent":["/**\n * SPDX-FileCopyrightText: 2022 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nimport type { WebDAVClient } from 'webdav'\n\nimport { defineComponent } from 'vue'\nimport {\n\ttype Collection,\n\n\tfetchCollections,\n} from '../services/collectionFetcher.js'\nimport { davClient } from '../services/DavClient.ts'\nimport logger from '../services/logger.js'\nimport AbortControllerMixin from './AbortControllerMixin.js'\n\nexport default defineComponent({\n\tname: 'FetchCollectionsMixin',\n\n\tdata() {\n\t\treturn {\n\t\t\terrorFetchingCollections: null as null | number | Error | unknown,\n\t\t\tloadingCollections: false,\n\t\t}\n\t},\n\n\tmixins: [AbortControllerMixin],\n\n\tmethods: {\n\t\tasync fetchCollections(collectionHome: string, extraProps: string[] = [], client: WebDAVClient = davClient): Promise<Collection[]> {\n\t\t\tif (this.loadingCollections) {\n\t\t\t\treturn []\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\tthis.loadingCollections = true\n\t\t\t\tthis.errorFetchingCollections = null\n\n\t\t\t\tconst collections = await fetchCollections(collectionHome, { signal: this.abortController.signal }, extraProps, client)\n\n\t\t\t\tthis.$store.dispatch('addCollections', { collections })\n\n\t\t\t\treturn collections\n\t\t\t} catch (error) {\n\t\t\t\tif (error.response?.status === 404) {\n\t\t\t\t\tthis.errorFetchingCollections = 404\n\t\t\t\t} else {\n\t\t\t\t\tthis.errorFetchingCollections = error\n\t\t\t\t}\n\t\t\t\tlogger.error('Error fetching collections:', { error })\n\t\t\t} finally {\n\t\t\t\tthis.loadingCollections = false\n\t\t\t}\n\n\t\t\treturn []\n\t\t},\n\t},\n})\n"],"names":[],"mappings":";;;;;;AAiBA,MAAA,wBAAe,gBAAgB;AAAA,EAC9B,MAAM;AAAA,EAEN,OAAO;AACC,WAAA;AAAA,MACN,0BAA0B;AAAA,MAC1B,oBAAoB;AAAA,IACrB;AAAA,EACD;AAAA,EAEA,QAAQ,CAAC,oBAAoB;AAAA,EAE7B,SAAS;AAAA,IACR,MAAM,iBAAiB,gBAAwB,aAAuB,CAAA,GAAI,SAAuB,WAAkC;AAClI,UAAI,KAAK,oBAAoB;AAC5B,eAAO,CAAC;AAAA,MAAA;AAGL,UAAA;AACH,aAAK,qBAAqB;AAC1B,aAAK,2BAA2B;AAE1B,cAAA,cAAc,MAAM,iBAAiB,gBAAgB,EAAE,QAAQ,KAAK,gBAAgB,UAAU,YAAY,MAAM;AAEtH,aAAK,OAAO,SAAS,kBAAkB,EAAE,aAAa;AAE/C,eAAA;AAAA,eACC,OAAO;AACX,YAAA,MAAM,UAAU,WAAW,KAAK;AACnC,eAAK,2BAA2B;AAAA,QAAA,OAC1B;AACN,eAAK,2BAA2B;AAAA,QAAA;AAEjC,eAAO,MAAM,+BAA+B,EAAE,MAAA,CAAO;AAAA,MAAA,UACpD;AACD,aAAK,qBAAqB;AAAA,MAAA;AAG3B,aAAO,CAAC;AAAA,IAAA;AAAA,EACT;AAEF,CAAC;"}
import{d as E,a as u,k as x}from"./vue.runtime.esm-OiydnxB-.chunk.mjs";import{N as P}from"./NcCheckboxRadioSwitch-Di43R9CE-DU845puP.chunk.mjs";import{n as k,t as F,V as N}from"./icons-UgBTm9C1.chunk.mjs";import{C as O}from"./index-ycziVi-9.chunk.mjs";var R=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","#","$","%","*","+",",","-",".",":",";","=","?","@","[","]","^","_","{","|","}","~"],c=e=>{let t=0;for(let a=0;a<e.length;a++){let i=e[a],s=R.indexOf(i);t=t*83+s}return t},v=e=>{let t=e/255;return t<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)},b=e=>{let t=Math.max(0,Math.min(1,e));return t<=.0031308?Math.trunc(t*12.92*255+.5):Math.trunc((1.055*Math.pow(t,.4166666666666667)-.055)*255+.5)},T=e=>e<0?-1:1,L=(e,t)=>T(e)*Math.pow(Math.abs(e),t),$=class extends Error{constructor(e){super(e),this.name="ValidationError",this.message=e}},q=e=>{if(!e||e.length<6)throw new $("The blurhash string must be at least 6 characters");let t=c(e[0]),a=Math.floor(t/9)+1,i=t%9+1;if(e.length!==4+2*i*a)throw new $("blurhash length mismatch: length is ".concat(e.length," but it should be ").concat(4+2*i*a))},A=e=>{let t=e>>16,a=e>>8&255,i=e&255;return[v(t),v(a),v(i)]},D=(e,t)=>{let a=Math.floor(e/361),i=Math.floor(e/19)%19,s=e%19;return[L((a-9)/9,2)*t,L((i-9)/9,2)*t,L((s-9)/9,2)*t]},U=(e,t,a,i)=>{q(e),i=i|1;let s=c(e[0]),S=Math.floor(s/9)+1,g=s%9+1,I=(c(e[1])+1)/166,h=new Array(g*S);for(let r=0;r<h.length;r++)if(r===0){let l=c(e.substring(2,6));h[r]=A(l)}else{let l=c(e.substring(4+r*2,6+r*2));h[r]=D(l,I*i)}let o=t*4,n=new Uint8ClampedArray(o*a);for(let r=0;r<a;r++)for(let l=0;l<t;l++){let y=0,_=0,C=0;for(let d=0;d<S;d++)for(let m=0;m<g;m++){let f=Math.cos(Math.PI*l*m/t)*Math.cos(Math.PI*r*d/a),p=h[m+d*g];y+=p[0]*f,_+=p[1]*f,C+=p[2]*f}let V=b(y),B=b(_),z=b(C);n[4*l+0+r*o]=V,n[4*l+1+r*o]=B,n[4*l+2+r*o]=z,n[4*l+3+r*o]=255}return n},W=U;const j='<svg xmlns="http://www.w3.org/2000/svg" id="mdi-star" viewBox="0 0 24 24"><path d="M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.45,13.97L5.82,21L12,17.27Z" /></svg>',Z=E({name:"FavoriteIcon",components:{NcIconSvgWrapper:O},data(){return{StarSvg:j}},mounted(){this.$nextTick(()=>{var e;const t=this.$el.querySelector("svg");(e=t==null?void 0:t.setAttribute)==null||e.call(t,"viewBox","-4 -4 30 30")})},methods:{t:u}});var G=function(){var e=this,t=e._self._c;return e._self._setupProxy,t("NcIconSvgWrapper",{staticClass:"favorite-marker-icon",attrs:{name:e.t("photos","Favorite"),svg:e.StarSvg}})},H=[],J=k(Z,G,H,!1,null,"38da3233");const K=J.exports,Q="images",w=[];async function M(e){var t;try{if(!w[e]){const a=await((t=window.caches)==null?void 0:t.open(Q)),i=await(a==null?void 0:a.match(e));w[e]=i!==void 0}return w[e]}catch(a){return!1}}const X={name:"FileComponent",components:{FavoriteIcon:K,NcCheckboxRadioSwitch:P,VideoOutline:N,PlayCircleOutlineIcon:F},inheritAttrs:!1,props:{file:{type:Object,required:!0},selected:{type:Boolean,default:!1},allowSelection:{type:Boolean,default:!0},distance:{type:Number,default:0}},data(){return{initialized:!1,loadedSmall:!1,errorSmall:!1,loadedLarge:!1,errorLarge:!1}},computed:{ariaLabel(){return this.file.attributes.favorite?u("photos",'Favorite image, open the full size "{name}" image',{name:this.file.basename}):u("photos",'Open the full size "{name}" image',{name:this.file.basename})},isImage(){var e,t;return(t=(e=this.file.mime)==null?void 0:e.startsWith("image"))!=null?t:!1},decodedEtag(){return this.file.attributes.etag.replace("&quot;","").replace("&quot;","")},srcLarge(){return this.getItemURL(512)},srcSmall(){return this.getItemURL(64)},isVisible(){return this.distance===0},hasBlurhash(){return this.file.attributes.metadataBlurhash!==void 0}},watch:{async file(){this.initialized=!1,this.loadedSmall=!1,this.errorSmall=!1,this.loadedLarge=!1,this.errorLarge=!1,await this.init()}},async mounted(){await this.init()},beforeDestroy(){this.$refs.imgSmall!==void 0&&(this.$refs.imgSmall.src=""),this.$refs.srcLarge!==void 0&&(this.$refs.srcLarge.src="")},methods:{async init(){[this.loadedSmall,this.loadedLarge]=await Promise.all([await M(this.srcSmall),await M(this.srcLarge)]),this.initialized=!0,await this.$nextTick(),this.drawBlurhash()},emitClick(){this.$emit("click",this.file.fileid)},onLoadSmall(){this.loadedSmall=!0},onLoadLarge(){this.loadedLarge=!0},onErrorSmall(){this.errorSmall=!0},onErrorLarge(){this.errorLarge=!0},onToggle(e){this.$emit("select-toggled",{id:this.file.fileid,value:e})},getItemURL(e){var t;const a=(t=this.$route)==null?void 0:t.params.token;return a?x("/apps/photos/api/v1/publicPreview/".concat(this.file.fileid,"?etag=").concat(this.decodedEtag,"&x=").concat(e,"&y=").concat(e,"&token=").concat(a)):x("/apps/photos/api/v1/preview/".concat(this.file.fileid,"?etag=").concat(this.decodedEtag,"&x=").concat(e,"&y=").concat(e))},drawBlurhash(){if(!this.hasBlurhash||!this.$refs.canvas)return;const e=this.$refs.canvas.width,t=this.$refs.canvas.height,a=W(this.file.attributes.metadataBlurhash,e,t),i=this.$refs.canvas.getContext("2d"),s=i.createImageData(e,t);s.data.set(a),i.putImageData(s,0,0)},t:u}};var Y=function(){var a;var e=this,t=e._self._c;return t("div",{staticClass:"file-container",class:{selected:e.selected},attrs:{"data-test":"media"}},[t("a",{staticClass:"file",attrs:{href:e.file.source,"aria-label":e.ariaLabel},on:{click:function(i){return i.stopPropagation(),i.preventDefault(),e.emitClick.apply(null,arguments)}}},[t("div",{staticClass:"file__images"},[(a=e.file.mime)!=null&&a.includes("video")?t("VideoOutline",{staticClass:"icon-overlay",attrs:{size:64}}):e.file.attributes["metadata-files-live-photo"]!==void 0?t("PlayCircleOutlineIcon",{staticClass:"icon-overlay",attrs:{size:64}}):e._e(),e.initialized?[e.hasBlurhash&&!e.loadedSmall&&!e.loadedLarge?t("canvas",{ref:"canvas",staticClass:"file__blurhash",attrs:{"aria-hidden":"true"}}):e._e(),!e.loadedLarge&&(e.loadedSmall||e.distance<5&&!e.errorSmall)?t("img",{key:"".concat(e.file.basename,"-small"),ref:"imgSmall",attrs:{src:e.srcSmall,alt:e.file.basename,decoding:e.loadedSmall||e.isVisible?"sync":"async",fetchpriority:e.loadedSmall||e.isVisible?"high":"low",loading:e.loadedSmall||e.isVisible?"eager":e.distance<2?"auto":"lazy"},on:{load:e.onLoadSmall,error:e.onErrorSmall}}):e._e(),e.loadedLarge||(e.isVisible||e.distance<2&&(e.loadedSmall||e.errorSmall))&&!e.errorLarge?t("img",{key:"".concat(e.file.basename,"-large"),ref:"imgLarge",attrs:{src:e.srcLarge,alt:e.file.basename,decoding:e.loadedLarge||e.isVisible?"sync":"async",fetchpriority:e.loadedLarge||e.isVisible?"high":"low",loading:e.loadedLarge||e.isVisible?"auto":"lazy"},on:{load:e.onLoadLarge,error:e.onErrorLarge}}):e._e()]:e._e()],2)]),e.allowSelection?t("NcCheckboxRadioSwitch",{staticClass:"selection-checkbox",attrs:{"aria-label":e.t("photos","Select image {imageName}",{imageName:e.file.basename}),"model-value":e.selected},on:{"update:model-value":e.onToggle}}):e._e(),e.file.attributes.favorite===1?e._m(0):e._e()],1)},ee=[function(){var e=this,t=e._self._c;return t("FavoriteIcon",{staticClass:"favorite-state"})}],te=k(X,Y,ee,!1,null,"bdcfb54f");const se=te.exports;export{se as F};
//# sourceMappingURL=FileComponent-4EaYtoHz.chunk.mjs.map

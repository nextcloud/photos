import"./index-Dt0wq4bO.chunk.mjs";import{V as _,a as v,k as z,p as J,R as se,b as w,d as Z,Q as le,a5 as de}from"./vue.runtime.esm-OiydnxB-.chunk.mjs";import{U as ce,g as ue}from"./index-DPkUyJ8g-BlLzolVA.chunk.mjs";import{N as fe}from"./NcEmptyContent-RnRTX9Z0.chunk.mjs";import{ae as T,O as pe,a as ee,l as F,w as he}from"./index-ycziVi-9.chunk.mjs";import{n as S,v as te}from"./icons-UgBTm9C1.chunk.mjs";import{L as me}from"./video-BDfR9rZh.chunk.mjs";import{A as re}from"./AbortControllerMixin-BH-eXynx.chunk.mjs";import{H as ge}from"./HeaderNavigation-83I_NFFa.chunk.mjs";import{f as we}from"./fileFetcher-BYWMW9gM.chunk.mjs";import"./preload-helper-CPULxMJS.chunk.mjs";import"./index-COmVzmHC.chunk.mjs";import"./index-DuF3OKwX.chunk.mjs";import"./dialog-CiY8TRVl.chunk.mjs";import"./useHotKey-DwbsMrnX.chunk.mjs";import"./NcActionButton-1gSJfFUC-DtAb5qOU.chunk.mjs";import"./NcProgressBar-D7zYeXBH-B7c0IkhC.chunk.mjs";import"./createElementId-DhjFt1I9-D5Zp4M-4.chunk.mjs";var ye=Object.defineProperty,ve=Object.defineProperties,be=Object.getOwnPropertyDescriptors,N=Object.getOwnPropertySymbols,Oe=Object.prototype.hasOwnProperty,Ce=Object.prototype.propertyIsEnumerable,A=(e,t,r)=>t in e?ye(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,k=(e,t)=>{for(var r in t||(t={}))Oe.call(t,r)&&A(e,r,t[r]);if(N)for(var r of N(t))Ce.call(t,r)&&A(e,r,t[r]);return e},G=(e,t)=>ve(e,be(t));function j(e){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?j=function(t){return typeof t}:j=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},j(e)}function je(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _e(e){return Fe(e)||Se(e)||Re()}function Fe(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}function Se(e){if(Symbol.iterator in Object(e)||Object.prototype.toString.call(e)==="[object Arguments]")return Array.from(e)}function Re(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function De(){return typeof Reflect<"u"&&Reflect.defineMetadata&&Reflect.getOwnMetadataKeys}function Le(e,t){L(e,t),Object.getOwnPropertyNames(t.prototype).forEach(function(r){L(e.prototype,t.prototype,r)}),Object.getOwnPropertyNames(t).forEach(function(r){L(e,t,r)})}function L(e,t,r){var i=r?Reflect.getOwnMetadataKeys(t,r):Reflect.getOwnMetadataKeys(t);i.forEach(function(o){var s=r?Reflect.getOwnMetadata(o,t,r):Reflect.getOwnMetadata(o,t);r?Reflect.defineMetadata(o,s,e,r):Reflect.defineMetadata(o,s,e)})}var Pe={__proto__:[]},Ee=Pe instanceof Array;function M(e){return function(t,r,i){var o=typeof t=="function"?t:t.constructor;o.__decorators__||(o.__decorators__=[]),typeof i!="number"&&(i=void 0),o.__decorators__.push(function(s){return e(s,r,i)})}}function xe(e){var t=j(e);return e==null||t!=="object"&&t!=="function"}function ze(e,t){var r=t.prototype._init;t.prototype._init=function(){var s=this,l=Object.getOwnPropertyNames(e);if(e.$options.props)for(var n in e.$options.props)e.hasOwnProperty(n)||l.push(n);l.forEach(function(a){Object.defineProperty(s,a,{get:function(){return e[a]},set:function(d){e[a]=d},configurable:!0})})};var i=new t;t.prototype._init=r;var o={};return Object.keys(i).forEach(function(s){i[s]!==void 0&&(o[s]=i[s])}),o}var x=["data","beforeCreate","created","beforeMount","mounted","beforeDestroy","destroyed","beforeUpdate","updated","activated","deactivated","render","errorCaptured","serverPrefetch"];function U(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};t.name=t.name||e._componentTag||e.name;var r=e.prototype;Object.getOwnPropertyNames(r).forEach(function(n){if(n!=="constructor"){if(x.indexOf(n)>-1){t[n]=r[n];return}var a=Object.getOwnPropertyDescriptor(r,n);a.value!==void 0?typeof a.value=="function"?(t.methods||(t.methods={}))[n]=a.value:(t.mixins||(t.mixins=[])).push({data:function(){return je({},n,a.value)}}):(a.get||a.set)&&((t.computed||(t.computed={}))[n]={get:a.get,set:a.set})}}),(t.mixins||(t.mixins=[])).push({data:function(){return ze(this,e)}});var i=e.__decorators__;i&&(i.forEach(function(n){return n(t)}),delete e.__decorators__);var o=Object.getPrototypeOf(e.prototype),s=o instanceof _?o.constructor:_,l=s.extend(t);return $e(l,e,s),De()&&Le(l,e),l}var Me={prototype:!0,arguments:!0,callee:!0,caller:!0};function $e(e,t,r){Object.getOwnPropertyNames(t).forEach(function(i){if(!Me[i]){var o=Object.getOwnPropertyDescriptor(e,i);if(!(o&&!o.configurable)){var s=Object.getOwnPropertyDescriptor(t,i);if(!Ee){if(i==="cid")return;var l=Object.getOwnPropertyDescriptor(r,i);if(!xe(s.value)&&l&&l.value===s.value)return}Object.defineProperty(e,i,s)}}})}function ie(e){return typeof e=="function"?U(e):function(t){return U(t,e)}}ie.registerHooks=function(e){x.push.apply(x,_e(e))};function We(e){return typeof e!="function"||!e.managed&&!e.managedReactive}function Ie(e){var t=function(){var r=this,i=typeof e=="function"?e.call(this):e;i=Object.create(i||null),i[y]=Object.create(this[y]||{});for(var o in t.managed)i[t.managed[o]]=this[o];var s=function(n){i[t.managedReactive[n]]=l[n],Object.defineProperty(i[y],t.managedReactive[n],{enumerable:!0,configurable:!0,get:function(){return r[n]}})},l=this;for(var o in t.managedReactive)s(o);return i};return t.managed={},t.managedReactive={},t}var y="__reactiveInject__";function Te(e){Array.isArray(e.inject)||(e.inject=e.inject||{},e.inject[y]={from:y,default:{}})}var Ne=typeof Reflect<"u"&&typeof Reflect.getMetadata<"u";function Ae(e,t,r){if(Ne&&!Array.isArray(e)&&typeof e!="function"&&!e.hasOwnProperty("type")&&typeof e.type>"u"){var i=Reflect.getMetadata("design:type",t,r);i!==Object&&(e.type=i)}}function p(e){return e===void 0&&(e={}),function(t,r){Ae(e,t,r),M(function(i,o){(i.props||(i.props={}))[o]=e})(t,r)}}function b(e){return M(function(t,r){var i=t.provide;Te(t),We(i)&&(i=t.provide=Ie(i)),i.managedReactive[r]=r})}function ke(e,t){t===void 0&&(t={});var r=t.deep,i=r===void 0?!1:r,o=t.immediate,s=o===void 0?!1:o;return M(function(l,n){typeof l.watch!="object"&&(l.watch=Object.create(null));var a=l.watch;typeof a[e]=="object"&&!Array.isArray(a[e])?a[e]=[a[e]]:typeof a[e]>"u"&&(a[e]=[]),a[e].push({handler:n,deep:i,immediate:s})})}const Ge=(e,t)=>e>720&&t>480?10:5,Ue=e=>Math.floor(e/250),He=e=>Math.round(e*1.5),Ve=(e,t,r)=>{const i=e/t;return Math.round(r*i)},H=(e,...t)=>{e&&console.debug(...t)};var qe=Object.defineProperty,Be=Object.getOwnPropertyDescriptor,u=(e,t,r,i)=>{for(var o=i>1?void 0:i?Be(t,r):t,s=e.length-1,l;s>=0;s--)(l=e[s])&&(o=(i?l(t,r,o):l(o))||o);return i&&o&&qe(t,r,o),o};let c=class extends _{constructor(){super(...arguments),this.updateLock=!1,this.bottomReached=!1,this.ref=null,this.containerData={windowSize:{height:0,width:0},windowScroll:{x:0,y:0},elementWindowOffset:0,elementSize:{height:0,width:0}}}get loadingBatch(){return this.loader&&this.updateLock}get configData(){return this.computeConfigData(this.containerData,this.items)}get layoutData(){return this.computeLayoutData(this.configData)}get renderData(){return this.computeRenderData(this.configData,this.containerData,this.layoutData)}mounted(){var e;this.ref=this.$refs.virtualGrid,this.initiliazeGrid(),window.addEventListener("resize",this.resize),((e=this.scrollElement)!=null?e:window).addEventListener("scroll",this.scroll)}beforeDestroy(){var e;window.removeEventListener("resize",this.resize),((e=this.scrollElement)!=null?e:window).removeEventListener("scroll",this.scroll)}onScrollElementChanged(e,t){(t!=null?t:window).removeEventListener("scroll",this.scroll),(e!=null?e:window).addEventListener("scroll",this.scroll)}resize(){this.loadMoreData()}scroll(){this.loadMoreData()}initiliazeGrid(){this.computeContainerData(),this.$nextTick(async()=>{this.loadMoreData()})}loadMoreData(){this.loadMoreDataAsync().catch(e=>{e&&console.error("Fail to load next data batch",e)}).then()}async loadMoreDataAsync(){this.computeContainerData();const e=this.containerData.windowScroll.y+this.containerData.windowSize.height,t=Math.max(0,this.containerData.elementWindowOffset+this.containerData.elementSize.height-this.updateTriggerMargin);!this.bottomReached&&e>=t&&!this.updateLock&&(this.updateLock=!0,H(this.debug,"Loading next batch"),await this.updateFunction()&&(H(this.debug,"Bottom reached"),this.bottomReached=!0),this.updateLock=!1,await this.loadMoreDataAsync())}computeContainerData(){if(this.ref===null)return;const e=this.getWindowSize(),t=this.getWindowScroll(),r=this.getElementOffset(this.ref),i=this.getElementSize(this.ref);this.containerData={windowSize:e,windowScroll:t,elementWindowOffset:r,elementSize:i}}computeConfigData(e,t){if(e===null||t===null)return{windowMargin:0,gridGap:0,columnCount:1,entries:[]};const r=e.elementSize?e.elementSize.width:0,i=this.getWindowMargin(e.windowSize.height),o=this.getGridGap(r,e.windowSize.height),s=this.getColumnCount(r),l=this.getColumnWidth(s,o,r),n=t.map(a=>{if(!a.width)return a;const d=l*a.columnSpan+o*(a.columnSpan-1);return G(k({},a),{height:this.getItemRatioHeight(a.height,a.width,d),width:d})});return{windowMargin:i,gridGap:o,columnCount:s,entries:n}}computeLayoutData(e){if(e===null)return{cells:[],totalHeight:0};let t=1,r=0,i=0,o=0;const s=e.entries.map((n,a)=>{const{columnCount:d,gridGap:g}=e;let f=n.columnSpan,h=n.height;f<1&&(f=d);const m=(a+o)%d;n.newRow&&m!==0&&(o+=d-m);const $=a+o,R=$%d+1,D=Math.floor($/d)+1;if(R+f>d+1){const I=R+f-d-1,ae=I/f;h=h*(1-ae),f-=I}f>1&&(o+=f-1),D!==t&&(t=D,r+=i+g,i=0);const ne=r,W=Math.round(h);return i=Math.max(i,W),G(k({},n),{columnNumber:R,rowNumber:D,offset:ne,height:W,columnSpan:f})}),l=r+i;return{cells:s,totalHeight:l}}computeRenderData(e,t,r){if(r===null||e===null)return{cellsToRender:[],firstRenderedRowNumber:0,firstRenderedRowOffset:0};const i=[];let o=null,s=null;if(t.elementWindowOffset!==null){const l=t.elementWindowOffset;for(const n of r.cells){const a=l+n.offset,d=a+n.height,g=t.windowScroll.y,f=g+t.windowSize.height,h=g-e.windowMargin,m=f+e.windowMargin;a>m||d<h||(o===null&&(o=n.rowNumber),n.rowNumber===o&&(s=s?Math.min(s,n.offset):n.offset),i.push(n))}}return{cellsToRender:i,firstRenderedRowNumber:o,firstRenderedRowOffset:s}}getColumnWidth(e,t,r){if(e===null||t===null||r===null)return 0;const i=(e-1)*t;return Math.round((r-i)/e)}getGridRowStart(e,t){if(t===null)return;const r=t.firstRenderedRowNumber!==null?t.firstRenderedRowNumber-1:0;return"".concat(e.rowNumber-r)}resetGrid(){this.bottomReached=!1,this.loadMoreData()}isSameElementSize(e,t){return e.width===t.width&&e.height===t.height}getWindowSize(){return{width:window.innerWidth,height:window.innerHeight}}getElementSize(e){const t=e.getBoundingClientRect();return{width:t.width,height:t.height}}isSameElementScroll(e,t){return e.x===t.x&&e.y===t.y}getWindowScroll(){return{x:window.scrollX,y:window.scrollY}}getElementOffset(e){return window.scrollY+e.getBoundingClientRect().top}};u([p({required:!0})],c.prototype,"items",2),u([p({default:()=>()=>!0})],c.prototype,"updateFunction",2),u([p({default:()=>Ge})],c.prototype,"getGridGap",2),u([p({default:()=>Ue})],c.prototype,"getColumnCount",2),u([p({default:()=>He})],c.prototype,"getWindowMargin",2),u([p({default:()=>Ve})],c.prototype,"getItemRatioHeight",2),u([p({default:null})],c.prototype,"scrollElement",2),u([p({default:500})],c.prototype,"updateTriggerMargin",2),u([p({default:null})],c.prototype,"loader",2),u([p({default:!1})],c.prototype,"debug",2),u([b()],c.prototype,"updateLock",2),u([b()],c.prototype,"bottomReached",2),u([b()],c.prototype,"ref",2),u([b()],c.prototype,"containerData",2),u([ke("scrollElement")],c.prototype,"onScrollElementChanged",1),c=u([ie({name:"VirtualGrid"})],c);var Ke=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{ref:"virtualGrid",style:{boxSizing:"border-box",height:e.layoutData.totalHeight+"px",paddingTop:e.renderData!==null&&e.renderData.firstRenderedRowOffset!==null?e.renderData.firstRenderedRowOffset+"px":"0px"}},[r("div",{staticClass:"grid",style:{display:"-ms-grid",display:"grid","align-items":"center","grid-template-columns":"repeat("+e.configData.columnCount+", 1fr)",gap:e.configData.gridGap+"px"}},e._l(e.renderData.cellsToRender,function(i){return r("div",{key:i.id,staticClass:"grid-item-wrapper",style:{height:i.height+"px","grid-column-start":i.columnNumber,"grid-column-end":i.columnNumber+i.columnSpan,"grid-row-start":e.getGridRowStart(i,e.renderData)}},[r(i.renderComponent,e._g({tag:"component",attrs:{item:i}},e.$listeners))],1)}),0),r(e.loadingBatch&&e.loader,{tag:"component"})],1)},Ye=[];function Qe(e,t,r,i,o,s,l,n){var a=typeof e=="function"?e.options:e;t&&(a.render=t,a.staticRenderFns=r,a._compiled=!0);var d;if(o&&(d=o),d)if(a.functional){a._injectStyles=d;var g=a.render;a.render=function(h,m){return d.call(m),g(h,m)}}else{var f=a.beforeCreate;a.beforeCreate=f?[].concat(f,d):[d]}return{exports:e,options:a}}const V={};var Xe=Qe(c,Ke,Ye,!1,Je);function Je(e){for(let t in V)this[t]=V[t]}var Ze=function(){return Xe.exports}();const et={name:"FileLegacy",inheritAttrs:!1,props:{item:{type:Object,required:!0}},data(){return{loaded:!1,error:!1}},computed:{ariaUuid(){return"image-".concat(this.item.injected.fileid)},ariaLabel(){return v("photos",'Open the full size "{name}" image',{name:this.item.injected.basename})},isImage(){return this.item.injected.mime.startsWith("image")},decodedEtag(){return this.item.injected.etag.replace("&quot;","").replace("&quot;","")},src(){return z("/core/preview?fileId=".concat(this.item.injected.fileid,"&c=").concat(this.decodedEtag,"&x=").concat(250,"&y=").concat(250,"&forceIcon=0&a=").concat(this.croppedLayout?"0":"1"))},croppedLayout(){return this.$store.state.userConfig.croppedLayout}},beforeDestroy(){this.$refs.src=""},methods:{openViewer(){window.OCA.Viewer.open({fileInfo:T(this.item.injected),list:this.item.injected.list.map(e=>T(e))})},onLoad(){this.loaded=!0},onError(){this.error=!0},t:v}};var tt=function(){var e=this,t=e._self._c;return t("a",{staticClass:"file",class:{"file--cropped":e.croppedLayout},attrs:{href:e.item.injected.source,"aria-label":e.ariaLabel},on:{click:function(r){return r.preventDefault(),e.openViewer.apply(null,arguments)}}},[e.item.injected.mime.includes("video")&&e.item.injected.hasPreview?t("div",{staticClass:"icon-video-white"}):e._e(),t("transition-group",{staticClass:"transition-group",attrs:{name:"fade"}},[e.error?e._e():t("img",{key:"".concat(e.item.injected.basename,"-img"),ref:"img",attrs:{src:e.src,alt:e.item.injected.basename,"aria-describedby":e.ariaUuid},on:{load:e.onLoad,error:e.onError}}),!e.loaded||e.error?t("svg",{key:"".concat(e.item.injected.basename,"-svg"),attrs:{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32",fill:"url(#placeholder__gradient)"}},[e.isImage?t("use",{attrs:{href:"#placeholder--img"}}):t("use",{attrs:{href:"#placeholder--video"}})]):e._e()]),t("p",{staticClass:"hidden-visually",attrs:{id:e.ariaUuid}},[e._v(e._s(e.item.injected.basename))]),t("div",{staticClass:"cover",attrs:{role:"none"}})],1)},rt=[],it=S(et,tt,rt,!1,null,"6f079611");const ot=it.exports;var nt=Object.defineProperty,at=Object.defineProperties,st=Object.getOwnPropertyDescriptors,q=Object.getOwnPropertySymbols,lt=Object.prototype.hasOwnProperty,dt=Object.prototype.propertyIsEnumerable,B=(e,t,r)=>t in e?nt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,ct=(e,t)=>{for(var r in t||(t={}))lt.call(t,r)&&B(e,r,t[r]);if(q)for(var r of q(t))dt.call(t,r)&&B(e,r,t[r]);return e},ut=(e,t)=>at(e,st(t));const ft={name:"FolderTagPreview",components:{FolderOutline:te,RouterLink:me},props:{name:{type:String,required:!0},path:{type:String,default:""},fileList:{type:Array,default:()=>[]}},data(){return{failed:[]}},computed:{isEmpty(){return this.previewList.length===0},ariaLabel(){return v("photos",'Open the "{name}" folder',{name:this.name})},previewList(){return this.fileList.filter(e=>this.failed.indexOf(e.fileid)===-1)},previewUrl(){if(this.previewList.length===0)return null;const{fileid:e,etag:t}=this.previewList.at(-1);return z("/core/preview?fileId=".concat(e,"&c=").concat(t,"&x=").concat(250,"&y=").concat(250,"&forceIcon=0&a=0"))},toLink(){var e;const t="/files/".concat((e=J())==null?void 0:e.uid);let r=this.path.replace(new RegExp("^".concat(t)),"");return r=/^\/?(.+)/i.exec(r)[1],ut(ct({},this.$route),{params:{path:r.split("/")}})}},methods:{onPreviewFail({fileid:e}){this.failed.push(e)},t:v}};var pt=function(){var e=this,t=e._self._c;return t("RouterLink",{staticClass:"folder",attrs:{to:e.toLink,"aria-label":e.ariaLabel}},[e.previewUrl?t("img",{staticClass:"folder__image",attrs:{src:e.previewUrl,alt:""},on:{error:function(r){return e.onPreviewFail(e.file)}}}):t("span",{staticClass:"folder__image folder__image--placeholder"},[t("FolderOutline",{staticClass:"folder__icon",attrs:{size:96,"fill-color":"var(--color-primary-element)"}})],1),t("span",{staticClass:"folder__details"},[t("FolderOutline"),t("span",{staticClass:"folder__title"},[e._v(e._s(e.name))])],1)])},ht=[],mt=S(ft,pt,ht,!1,null,"0660a5ac");const gt=mt.exports;var wt=Object.defineProperty,yt=Object.defineProperties,vt=Object.getOwnPropertyDescriptors,K=Object.getOwnPropertySymbols,bt=Object.prototype.hasOwnProperty,Ot=Object.prototype.propertyIsEnumerable,Y=(e,t,r)=>t in e?wt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Ct=(e,t)=>{for(var r in t||(t={}))bt.call(t,r)&&Y(e,r,t[r]);if(K)for(var r of K(t))Ot.call(t,r)&&Y(e,r,t[r]);return e},jt=(e,t)=>yt(e,vt(t));async function oe(e="/",t={}){const r=z("/apps/photos/api/v1/".concat(t.shared?"shared":"albums")),i=(await pe.get(r+e,t)).data.map(n=>jt(Ct({},n),{filename:"".concat(w).concat(n.filename),source:decodeURI(se+"".concat(w).concat(n.filename))}));let o;const s=[],l=[];for(const n of i)n.filename==="".concat(w).concat(e)?o=n:n.type!=="file"?s.push(n):ee.indexOf(n.mime)>-1&&l.push(n);return{folder:o,folders:s,files:l}}const _t=Z({name:"FolderComponent",components:{FolderTagPreview:gt},mixins:[re],inheritAttrs:!1,props:{item:{type:Object,required:!0}},data(){return{previewFolder:this.item.injected.fileid}},computed:{files(){return this.$store.state.folders.files},subFolders(){return this.$store.state.folders.subFolders},folders(){return this.$store.state.folders.folders},folderContent(){return this.folders[this.item.injected.fileid]},previewFiles(){const e=this.folders[this.previewFolder],t=e?e.map(r=>this.files[r]).slice(0,4):[];if(t.length===0&&this.subFolders[this.previewFolder]&&this.previewFolder===this.item.injected.fileid){const r=this.subFolders[this.previewFolder][0];this.updatePreviewFolder(r),this.folders[this.previewFolder]||this.getFolderData(this.files[this.previewFolder].filename)}return t}},async created(){this.folderContent||await this.getFolderData(this.item.injected.filename)},methods:{async getFolderData(e){var t;try{const r="/files/".concat((t=J())==null?void 0:t.uid),i=e.replace(new RegExp("^".concat(r)),""),{folder:o,folders:s,files:l}=await oe(i,{shared:this.item.injected.showShared,signal:this.abortController.signal});this.$store.dispatch("updateFolders",{fileid:o==null?void 0:o.fileid,files:l,folders:s}),this.$store.dispatch("updateFoldersFiles",{folder:o,files:l,folders:s})}catch(r){F.error("Failed to get folder content",{error:r,filename:e})}},updatePreviewFolder(e){this.previewFolder=e}}});var Ft=function(){var e=this,t=e._self._c;return e._self._setupProxy,t("FolderTagPreview",{attrs:{id:e.item.injected.fileid,name:e.item.injected.basename.toString(),path:e.item.injected.filename,"file-list":e.previewFiles}})},St=[],Rt=S(_t,Ft,St,!1,null,"d58b828a");const Dt=Rt.exports,O={400:{marginTop:66,marginW:8,count:3,folderCount:1},700:{marginTop:66,marginW:8,count:4,folderCount:1},1024:{marginTop:66,marginW:44,count:5,folderCount:2},1280:{marginTop:66,marginW:44,count:4,folderCount:2},1440:{marginTop:88,marginW:66,count:5,folderCount:3},1600:{marginTop:88,marginW:66,count:6,folderCount:4},2048:{marginTop:88,marginW:66,count:7,folderCount:4},2560:{marginTop:88,marginW:88,count:8,folderCount:6},3440:{marginTop:88,marginW:88,count:9,folderCount:8},max:{marginTop:88,marginW:88,count:10,folderCount:10}},C=new _({data(){return{gridConfig:O.max}},watch:{gridConfig(e){this.$emit("changed",e)}},created(){window.addEventListener("resize",this.handleWindowResize),this.handleWindowResize()},beforeDestroy(){window.removeEventListener("resize",this.handleWindowResize)},methods:{handleWindowResize(){const e=Object.keys(O).map(t=>Number.parseInt(t)).find(t=>t>document.documentElement.clientWidth);this.gridConfig=O[e]||O.max}}}),Lt=Z({data(){return{gridConfig:{}}},created(){C.$on("changed",this.handleGridConfigChange),F.debug("Grid config",{gridConfig:C.gridConfig}),this.gridConfig=C.gridConfig},beforeDestroy(){C.$off("changed",this.handleGridConfigChange)},methods:{handleGridConfigChange(e){this.gridConfig=e}}});var Pt=Object.defineProperty,Et=Object.defineProperties,xt=Object.getOwnPropertyDescriptors,Q=Object.getOwnPropertySymbols,zt=Object.prototype.hasOwnProperty,Mt=Object.prototype.propertyIsEnumerable,X=(e,t,r)=>t in e?Pt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,P=(e,t)=>{for(var r in t||(t={}))zt.call(t,r)&&X(e,r,t[r]);if(Q)for(var r of Q(t))Mt.call(t,r)&&X(e,r,t[r]);return e},E=(e,t)=>Et(e,xt(t));const $t={name:"FoldersView",components:{FolderOutline:te,HeaderNavigation:ge,NcEmptyContent:fe,NcLoadingIcon:he,UploadPicker:ce,VirtualGrid:Ze},mixins:[re,Lt],props:{rootTitle:{type:String,required:!0},path:{type:String,default:"/"},showShared:{type:Boolean,default:!1}},data(){return{error:null,allowedMimes:ee,initializing:!0,loading:!1,appContent:document.getElementById("app-content-vue"),uploader:ue()}},computed:{files(){return this.$store.state.folders.files},folders(){return this.$store.state.folders.folders},folderId(){return this.$store.state.folders.paths[this.path]},folder(){return this.files[this.folderId]},folderAsFolder(){if(this.folder)return new le(E(P({},this.folder),{permissions:de(this.folder.permissions),owner:null}))},folderContent(){return this.folders[this.folderId]||[]},fileList(){return this.folderContent&&this.folderContent.map(e=>this.files[e]).filter(e=>!!e)},subFolders(){return this.folderId&&this.files[this.folderId]&&this.$store.state.folders.subFolders[this.folderId]},folderList(){return this.subFolders&&this.subFolders.map(e=>this.files[e]).filter(e=>!!e)},contentList(){var e;const t=this.folderList&&this.folderList.map(i=>({id:"folder-".concat(i.fileid),injected:E(P({},i),{showShared:this.showShared}),width:232,height:280,columnSpan:1,renderComponent:Dt})),r=(e=this.fileList)==null?void 0:e.map(i=>({id:"file-".concat(i.fileid),injected:E(P({},i),{list:this.fileList}),width:256,height:256,columnSpan:1,renderComponent:ot}));return[...t||[],...r||[]]},isEmpty(){return!this.haveFiles&&!this.haveFolders},haveFiles(){return!!this.fileList&&this.fileList.length!==0},haveFolders(){return!!this.folderList&&this.folderList.length!==0}},watch:{path(){this.fetchFolderContent()},showShared(){this.fetchFolderContent()}},beforeMount(){this.fetchFolderContent()},methods:{onRefresh(){this.fetchFolderContent()},async fetchFolderContent(){var e,t,r,i,o,s,l;this.error=null,this.loading=!0,(r=(t=(e=window.OCA)==null?void 0:e.Viewer)==null?void 0:t.close)==null||r.call(t),(l=(s=(o=(i=window.OCA)==null?void 0:i.Files)==null?void 0:o.Sidebar)==null?void 0:s.close)==null||l.call(s),(!this.files[this.folderId]||!this.folders[this.folderId])&&(this.initializing=!0);try{const{folder:n,folders:a,files:d}=await oe(this.path,{shared:this.showShared,signal:this.abortController.signal});this.$store.dispatch("addPath",{path:this.path,fileid:n==null?void 0:n.fileid}),this.$store.dispatch("updateFolders",{fileid:n==null?void 0:n.fileid,files:d,folders:a}),this.$store.dispatch("updateFoldersFiles",{folder:n,files:d,folders:a})}catch(n){n!=null&&n.response&&n.response.status&&(n.response.status===404?(this.error=404,setTimeout(()=>{var a;this.$router.push({name:(a=this.$route.name)!=null?a:void 0})},3e3)):this.error=n),F.error("Error fetching album data",{error:n})}finally{this.loading=!1,this.initializing=!1}},async onUpload(e){var t;const r=e.source.split(w).pop(),i=await we(w+r);if(i===null){F.error("Failed to fetch file",{relPath:r});return}const o={fileid:i.fileid,basename:i.basename,etag:i.attributes.etag,filename:i.root+i.path,source:i.source,lastmod:(t=i.mtime)==null?void 0:t.getTime(),mime:i.mime,size:i.size,type:"file",permissions:"",hasPreview:i.attributes.hasPreview};this.$store.dispatch("appendFoldersFiles",[o]),this.$store.dispatch("addFilesToFolder",{fileid:this.folderId,files:[o]})},t:v}};var Wt=function(){var r,i,o,s;var e=this,t=e._self._c;return e.error===404?t("NcEmptyContent",{attrs:{name:e.t("photos","This folder does not exist")},scopedSlots:e._u([{key:"icon",fn:function(){return[t("FolderOutline")]},proxy:!0}],null,!1,610611029)}):e.error?t("NcEmptyContent",{attrs:{name:e.t("photos","An error occurred")}}):e.initializing?t("NcEmptyContent",{attrs:{name:e.t("photos","Loading folders …")},scopedSlots:e._u([{key:"icon",fn:function(){return[t("NcLoadingIcon")]},proxy:!0}])}):e.initializing?e._e():t("div",[t("HeaderNavigation",{key:"navigation",class:{"photos-navigation--uploading":((r=e.uploader.queue)==null?void 0:r.length)>0},attrs:{loading:e.loading,path:e.path,title:((s=(o=(i=e.folder)==null?void 0:i.basename)==null?void 0:o.toString)==null?void 0:s.call(o))||e.rootTitle,"root-title":e.rootTitle},on:{refresh:e.onRefresh}},[t("UploadPicker",{attrs:{accept:e.allowedMimes,destination:e.folderAsFolder,multiple:!0},on:{uploaded:e.onUpload}})],1),e.isEmpty?t("NcEmptyContent",{key:"emptycontent",attrs:{name:e.t("photos","No photos in here")},scopedSlots:e._u([{key:"icon",fn:function(){return[t("FolderOutline")]},proxy:!0}],null,!1,610611029)}):t("div",{staticClass:"grid-container",class:{"grid-container--folders":e.haveFolders}},[t("VirtualGrid",{ref:"virtualgrid",attrs:{items:e.contentList,"scroll-element":e.appContent,"get-column-count":()=>e.haveFolders?e.gridConfig.folderCount:e.gridConfig.count,"get-grid-gap":()=>e.haveFolders?16:8}})],1)],1)},It=[],Tt=S($t,Wt,It,!1,null,"8c8a8b95");const ir=Tt.exports;export{ir as default};
//# sourceMappingURL=FoldersView-BY5qPD7L.chunk.mjs.map

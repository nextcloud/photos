import{d as p,t as v,q as i,w as m,N as g,j as c,y as C,_ as f}from"./vue.runtime.esm-DMa8KkVG.chunk.mjs";import{_ as b,$ as P,n as S,a0 as x,H as N,C as k,B as w,a1 as D,a2 as I,a3 as A,a4 as T,p as d,f as $,M,E as R,T as W}from"./index-B6un_sFJ.chunk.mjs";import{B as F,n as u,M as U}from"./icons-CG9j2hi8.chunk.mjs";import{f as V}from"./collectionFetcher-D79nAIin.chunk.mjs";import{c as j}from"./index-Dc4e3UzN.chunk.mjs";const B=p({__name:"DateRangeFilterDisplay",props:{value:null},setup(e){return{__sfc:!0,t:v,NcDateTime:b,CalendarMonth:F}}});var q=function(){var e=this,a=e._self._c,t=e._self._setupProxy;return e.value!==void 0?a("div",[a(t.CalendarMonth),e._v(" "),a("b",[e._v(e._s(t.t("photos","Date range"))+": ")]),a("span",[a(t.NcDateTime,{attrs:{timestamp:e.value.start,format:{dateStyle:"long"},"relative-time":!1}}),e._v(" â¸± "),a(t.NcDateTime,{attrs:{timestamp:e.value.end,format:{dateStyle:"long"},"relative-time":!1}})],1)],1):e._e()},E=[],L=u(B,q,E,!1,null,null);const O=L.exports,z=p({__name:"DateRangeFilterInput",props:{value:null},emits:["update:value"],setup(e,{emit:a}){const t=e,l=i([null,null]);return t.value!==void 0&&(l.value=[new Date(t.value.start),new Date(t.value.end)]),m(l,n=>{n[0]===null||n[1]===null?a("update:value",void 0):a("update:value",{start:n[0].getTime(),end:n[1].getTime()})}),{__sfc:!0,props:t,emit:a,dateRange:l,t:v,NcDateTimePicker:P}}});var Q=function(){var e=this,a=e._self._c,t=e._self._setupProxy;return a(t.NcDateTimePicker,{attrs:{clearable:!0,type:"date-range",placeholder:t.t("photos","Select a date range")},scopedSlots:e._u([{key:"default",fn:function(){return[e._v(" "+e._s(t.t("photos","Date range"))+" ")]},proxy:!0}]),model:{value:t.dateRange,callback:function(l){t.dateRange=l},expression:"dateRange"}})},H=[],G=u(z,Q,H,!1,null,null);const J=G.exports,K="date-range",X={id:K,inputComponent:J,displayComponent:O,getQuery(e){return e===void 0?"":`
			<d:and>
				<d:gt>
					<d:prop><nc:metadata-photos-original_date_time/></d:prop>
					<d:literal>${e.start/1e3}</d:literal>
				</d:gt>
				<d:lt>
					<d:prop><nc:metadata-photos-original_date_time/></d:prop>
					<d:literal>${e.end/1e3+24*60*60}</d:literal>
				</d:lt>
			</d:and>`}};I(A);const Y={__name:"NcChip",props:{ariaLabelClose:{type:String,default:x("Close")},text:{type:String,default:""},type:{type:String,default:"secondary",validator:e=>["primary","secondary","tertiary"].includes(e)},iconPath:{type:String,default:null},iconSvg:{type:String,default:null},noClose:{type:Boolean,default:!1},variant:{type:String,default:"secondary",validator:e=>["primary","secondary","tertiary"].includes(e)}},emits:["close"],setup(e,{emit:a}){const t=e,l=g(),n=c(()=>t.type!=="secondary"?t.type:t.variant),o=c(()=>!t.noClose);return{__sfc:!0,props:t,emit:a,slots:l,realVariant:n,canClose:o,hasActions:()=>!!l.actions?.(),hasIcon:()=>!!(t.iconPath||t.iconSvg||l.icon?.()),onClose:()=>{a("close")},mdiClose:D,NcActions:w,NcActionButton:k,NcIconSvgWrapper:N}}};var Z=function(){var e=this,a=e._self._c,t=e._self._setupProxy;return a("div",{staticClass:"nc-chip",class:{[`nc-chip--${t.realVariant}`]:!0,"nc-chip--no-actions":e.noClose&&!t.hasActions(),"nc-chip--no-icon":!t.hasIcon()}},[t.hasIcon()?a("span",{staticClass:"nc-chip__icon"},[e._t("icon",function(){return[e.iconPath||e.iconSvg?a(t.NcIconSvgWrapper,{attrs:{inline:"",path:e.iconPath,svg:e.iconPath?void 0:e.iconSvg,size:18}}):e._e()]})],2):e._e(),a("span",{staticClass:"nc-chip__text"},[e._t("default",function(){return[e._v(e._s(e.text))]})],2),t.canClose||t.hasActions()?a(t.NcActions,{staticClass:"nc-chip__actions",attrs:{"force-menu":!t.canClose,variant:"tertiary-no-background"}},[t.canClose?a(t.NcActionButton,{attrs:{"close-after-click":""},on:{click:t.onClose},scopedSlots:e._u([{key:"icon",fn:function(){return[a(t.NcIconSvgWrapper,{attrs:{path:t.mdiClose,size:20}})]},proxy:!0}],null,!1,2547223506)},[e._v(" "+e._s(e.ariaLabelClose)+" ")]):e._e(),e._t("actions")],2):e._e()],1)},ee=[],te=S(Y,Z,ee,!1,null,"e82c5d32");const h=te.exports;function ae(){const e=i(new AbortController),a=c(()=>e.value.signal);function t(){e.value.abort(),e.value=new AbortController}return C(()=>{e.value.abort()}),j.beforeEach((l,n,o)=>{t(),o()}),{abortSignal:a,abortPendingRequest:t}}function le(){const e=i(null),a=i(!1),{abortSignal:t}=ae();async function l(n,o=[],_=T){if(a.value)return[];try{a.value=!0,e.value=null;const s=await V(n,{signal:t.value},o,_);return d.dispatch("addCollections",{collections:s}),s}catch(s){s.response?.status===404?e.value=404:e.value=s,$.error("Error fetching collections:",{error:s})}finally{a.value=!1}return[]}return{fetchCollections:l,errorFetchingCollections:e,loadingCollections:a}}function y(e,a){const{fetchCollections:t,loadingCollections:l}=le(),n=i([]),o=c({get(){return(e.value??[]).map(s=>{const r=d.getters.getPlace(s);return{label:r?.displayname??s,previewUrl:r?f(`/apps/photos/api/v1/preview/${r.attributes["last-photo"]}?x=64&y=64`):void 0}})},set(s){s.length===0?a("update:value",void 0):a("update:value",s.map(r=>r.label))}}),_=c(()=>n.value.filter(s=>!o.value.includes(s)));return m(()=>d.getters.places,s=>{n.value=Object.values(s).map(r=>({label:r.displayname,previewUrl:f(`/apps/photos/api/v1/preview/${r.attributes["last-photo"]}?x=64&y=64`)}))},{immediate:!0}),Object.values(d.getters.places).length===0&&t(M),{availablePlacesWithoutSelections:_,selectedPlaces:o,loadingCollections:l}}const se=p({__name:"PlacesFilterDisplay",props:{value:null},emits:["update:value"],setup(e,{emit:a}){const t=e,{selectedPlaces:l}=y(t,a);return{__sfc:!0,props:t,emit:a,selectedPlaces:l,t:v,NcChip:h,MapMarker:U}}});var ne=function(){var e=this,a=e._self._c,t=e._self._setupProxy;return a("div",[a(t.MapMarker),e._v(" "),a("b",[e._v(e._s(t.t("photos","Places"))+": ")]),e._l(t.selectedPlaces,function(l){return a("span",{key:l.label},[a(t.NcChip,{attrs:{"no-close":""},scopedSlots:e._u([l.previewUrl!==void 0?{key:"icon",fn:function(){return[a("img",{staticClass:"place__preview",attrs:{src:l.previewUrl}})]},proxy:!0}:null,{key:"default",fn:function(){return[e._v(" "+e._s(l.label)+" ")]},proxy:!0}],null,!0)})],1)})],2)},oe=[],re=u(se,ne,oe,!1,null,"7e775100");const ie=re.exports,ce=p({__name:"PlacesFilterInput",props:{value:null},emits:["update:value"],setup(e,{emit:a}){const t=e,{availablePlacesWithoutSelections:l,loadingCollections:n,selectedPlaces:o}=y(t,a);return{__sfc:!0,props:t,emit:a,availablePlacesWithoutSelections:l,loadingCollections:n,selectedPlaces:o,t:v,NcChip:h,NcListItemIcon:W,NcSelect:R}}});var pe=function(){var e=this,a=e._self._c,t=e._self._setupProxy;return a(t.NcSelect,{staticClass:"places-select",attrs:{options:t.availablePlacesWithoutSelections,"aria-label-combobox":t.t("photos","Select places"),placeholder:t.t("photos","Select places"),loading:t.loadingCollections,multiple:!0},scopedSlots:e._u([{key:"option",fn:function(l){return[a(t.NcListItemIcon,{attrs:{name:l.label,"is-no-user":!0,url:l.previewUrl}})]}},{key:"selected-option",fn:function(l){return[a(t.NcChip,{attrs:{"no-close":""},scopedSlots:e._u([{key:"icon",fn:function(){return[a("img",{staticClass:"place__preview",attrs:{src:l.previewUrl}})]},proxy:!0},{key:"default",fn:function(){return[e._v(" "+e._s(l.label)+" ")]},proxy:!0}],null,!0)})]}}]),model:{value:t.selectedPlaces,callback:function(l){t.selectedPlaces=l},expression:"selectedPlaces"}})},ue=[],de=u(ce,pe,ue,!1,null,"0d9a8f03");const ve=de.exports,_e="places",fe={id:_e,inputComponent:ve,displayComponent:ie,getQuery(e){return e===void 0?"":`<d:or>${e.map(a=>`
			<d:eq>
				<d:prop><nc:metadata-photos-place/></d:prop>
				<d:literal>${a}</d:literal>
			</d:eq>
		`).join("")}</d:or>`}},me=[X,fe],he=p({__name:"PhotosFiltersDisplay",props:{filtersValue:null},setup(e){return{__sfc:!0,filters:me}}});var ye=function(){var e=this,a=e._self._c,t=e._self._setupProxy;return Object.keys(e.filtersValue).length!==0?a("div",{staticClass:"photos-filters"},e._l(t.filters.filter(l=>e.filtersValue[l.id]!==void 0),function(l){return a(l.displayComponent,{key:l.id,tag:"component",staticClass:"photos-filters__filter",attrs:{value:e.filtersValue[l.id],"data-cy-photos-filters-display":l.id}})}),1):e._e()},ge=[],Ce=u(he,ye,ge,!1,null,"af35af63");const ke=Ce.exports;export{ke as P,me as p};
//# sourceMappingURL=PhotosFiltersDisplay-BhCQloH-.chunk.mjs.map

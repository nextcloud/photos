import{d as m,g as p,a0 as w,a as f,aa as V,e as u,o as P,_ as y}from"./vue.runtime.esm-DOYee4Bn.chunk.mjs";import{r as D,ah as I,m as k,a as H,D as C,y as A,J as O,d as M,p as c,l as F,A as S}from"./index-C5qH3lrk.chunk.mjs";import{n as g}from"./icons-BoPzhPJ9.chunk.mjs";import{N as T,a as $}from"./NcSelect-QVd6uJPA-DWrs5JTh.chunk.mjs";import{s as R}from"./dialog-DQR05qmT.chunk.mjs";import W from"./NcDateTimePicker-COA4A2Dy.chunk.mjs";import{N as j}from"./NcDialog-Bg0hY6TP-DcCANJCa.chunk.mjs";import{N as L}from"./NcActionButton-CD1Z-o2Y-G-PWjTEm.chunk.mjs";import{N as B}from"./NcDateTime-enXYuwj8-DcQMJJRM.chunk.mjs";import{f as b}from"./collectionFetcher-D-MT6hjC.chunk.mjs";import{r as E}from"./video-Di3FEmjE.chunk.mjs";const Y='<svg xmlns="http://www.w3.org/2000/svg" id="mdi-calendar-month" viewBox="0 0 24 24"><path d="M9,10V12H7V10H9M13,10V12H11V10H13M17,10V12H15V10H17M19,3A2,2 0 0,1 21,5V19A2,2 0 0,1 19,21H5C3.89,21 3,20.1 3,19V5A2,2 0 0,1 5,3H6V1H8V3H16V1H18V3H19M19,19V8H5V19H19M9,14V16H7V14H9M13,14V16H11V14H13M17,14V16H15V14H17Z" /></svg>',q=m({__name:"CustomDateRangePickerDialog",emits:["close"],setup(t,{emit:a}){const e=p([null,null]);return w(e,s=>{(s[0]!==null||s[1]!==null)&&a("close",{start:s[0].getTime(),end:s[1].getTime()})}),{__sfc:!0,emit:a,dateRange:e,t:f,NcDateTimePicker:W,NcDialog:j}}});var z=function(){var t=this,a=t._self._c,e=t._self._setupProxy;return a(e.NcDialog,{attrs:{name:e.t("photos","Select a custom date range"),size:"normal"},on:{closing:function(s){return e.emit("close",void 0)}}},[a("div",{staticClass:"date-range-picker-dialog",attrs:{"data-cy-photos-filters-input":"custom-date-range"}},[a(e.NcDateTimePicker,{staticClass:"date-range-picker-dialog__picker",attrs:{clearable:!0,type:"date-range",placeholder:e.t("photos","Select a date range")},scopedSlots:t._u([{key:"default",fn:function(){return[t._v(" "+t._s(e.t("photos","Date range"))+" ")]},proxy:!0}]),model:{value:e.dateRange,callback:function(s){e.dateRange=s},expression:"dateRange"}})],1)])},Q=[],Z=g(q,z,Q,!1,null,"3b73070f");const J=Z.exports;D(I);const G={__name:"NcChip",props:{ariaLabelClose:{type:String,default:k("Close")},actionsContainer:{type:String,default:"body"},text:{type:String,default:""},type:{type:String,default:"secondary",validator:t=>["primary","secondary","tertiary","error","warning","success"].includes(t)},iconPath:{type:String,default:null},iconSvg:{type:String,default:null},noClose:{type:Boolean,default:!1},variant:{type:String,default:"secondary",validator:t=>["primary","secondary","tertiary","error","warning","success"].includes(t)}},emits:["close"],setup(t,{emit:a}){const e=t,s=V(),n=u(()=>e.type!=="secondary"?e.type:e.variant),o=u(()=>!e.noClose);return{__sfc:!0,props:e,emit:a,slots:s,realVariant:n,canClose:o,hasActions:()=>!!s.actions?.(),hasIcon:()=>!!(e.iconPath||e.iconSvg||s.icon?.()),mdiClose:O,NcActionButton:L,NcActions:A,NcIconSvgWrapper:C}}};var K=function(){var t=this,a=t._self._c,e=t._self._setupProxy;return a("div",{staticClass:"nc-chip",class:{[`nc-chip--${e.realVariant}`]:!0,"nc-chip--no-actions":t.noClose&&!e.hasActions(),"nc-chip--no-icon":!e.hasIcon()}},[e.hasIcon()?a("span",{staticClass:"nc-chip__icon"},[t._t("icon",function(){return[t.iconPath||t.iconSvg?a(e.NcIconSvgWrapper,{attrs:{inline:"",path:t.iconPath,svg:t.iconPath?void 0:t.iconSvg,size:18}}):t._e()]})],2):t._e(),a("span",{staticClass:"nc-chip__text"},[t._t("default",function(){return[t._v(t._s(t.text))]})],2),e.canClose||e.hasActions()?a(e.NcActions,{staticClass:"nc-chip__actions",attrs:{container:t.actionsContainer,"force-menu":!e.canClose,variant:"tertiary-no-background"}},[e.canClose?a(e.NcActionButton,{attrs:{"close-after-click":""},on:{click:function(s){return e.emit("close")}},scopedSlots:t._u([{key:"icon",fn:function(){return[a(e.NcIconSvgWrapper,{attrs:{path:e.mdiClose,size:20}})]},proxy:!0}],null,!1,2547223506)},[t._v(" "+t._s(t.ariaLabelClose)+" ")]):t._e(),t._t("actions")],2):t._e()],1)},U=[],X=H(G,K,U,!1,null,"88e86387");const x=X.exports,tt=m({__name:"DateRangeOption",props:{value:null},emits:["deselect"],setup(t,{emit:a}){return{__sfc:!0,emit:a,NcChip:x,NcDateTime:B}}});var et=function(){var t=this,a=t._self._c,e=t._self._setupProxy;return a(e.NcChip,{attrs:{"data-cy-photos-filters-option":"date-range"},on:{close:function(s){return e.emit("deselect")}},scopedSlots:t._u([{key:"default",fn:function(){return[a(e.NcDateTime,{attrs:{timestamp:t.value.start,format:{dateStyle:"long"},"relative-time":!1}}),t._v(" ⸱ "),a(e.NcDateTime,{attrs:{timestamp:t.value.end,format:{dateStyle:"long"},"relative-time":!1}})]},proxy:!0}])})},at=[],st=g(tt,et,at,!1,null,null);const ot=st.exports,v="date-range",nt={id:v,icon:Y,renderOptionComponent:ot,async getOptions(){const t=new Date;return[{filterId:v,label:f("photos","Last week"),value:{start:new Date(t.getFullYear(),t.getMonth(),t.getDate()-t.getDay()-7).getTime(),end:new Date(t.getFullYear(),t.getMonth(),t.getDate()-t.getDay()-1).getTime()}},{filterId:v,label:f("photos","Last Month"),value:{start:new Date(t.getFullYear(),t.getMonth()-1,1).getTime(),end:new Date(t.getFullYear(),t.getMonth(),0).getTime()}},{filterId:v,label:f("photos","Custom…"),value:void 0,async getValue(){return new Promise(a=>{R(J,void 0,a)})}}]},getQuery(t){return`<d:or>${t.map(a=>`
			<d:and>
				<d:gt>
					<d:prop><nc:metadata-photos-original_date_time/></d:prop>
					<d:literal>${a.start/1e3}</d:literal>
				</d:gt>
				<d:lt>
					<d:prop><nc:metadata-photos-original_date_time/></d:prop>
					<d:literal>${a.end/1e3+86400}</d:literal>
				</d:lt>
			</d:and>`).join("")}</d:or>`}},rt='<svg xmlns="http://www.w3.org/2000/svg" id="mdi-map-marker" viewBox="0 0 24 24"><path d="M12,11.5A2.5,2.5 0 0,1 9.5,9A2.5,2.5 0 0,1 12,6.5A2.5,2.5 0 0,1 14.5,9A2.5,2.5 0 0,1 12,11.5M12,2A7,7 0 0,0 5,9C5,14.25 12,22 12,22C12,22 19,14.25 19,9A7,7 0 0,0 12,2Z" /></svg>';function it(){const t=p(new AbortController),a=u(()=>t.value.signal);function e(){t.value.abort(),t.value=new AbortController}return P(()=>{t.value.abort()}),E.beforeEach((s,n,o)=>{e(),o()}),{abortSignal:a,abortPendingRequest:e}}function lt(){const t=p(null),a=p(!1),{abortSignal:e}=it();async function s(n,o=[],d=M){if(a.value)return[];try{a.value=!0,t.value=null;const r=await b(n,{signal:e.value},o,d);return c.dispatch("addCollections",{collections:r}),r}catch(r){r.response?.status===404?t.value=404:t.value=r,F.error("Error fetching collections:",{error:r})}finally{a.value=!1}return[]}return{fetchCollections:s,errorFetchingCollections:t,loadingCollections:a}}const ct=m({__name:"PlaceOption",props:{value:null},emits:["deselect"],setup(t,{emit:a}){const e=t,{fetchCollections:s}=lt(),n=u(()=>{const o=c.getters.getPlace(e.value);return o?y(`/apps/photos/api/v1/preview/${o.attributes["last-photo"]}?x=64&y=64`):""});return Object.values(c.getters.places).length===0&&s(S),{__sfc:!0,props:e,fetchCollections:s,placeImageSource:n,emit:a,NcChip:x}}});var pt=function(){var t=this,a=t._self._c,e=t._self._setupProxy;return a(e.NcChip,{attrs:{"data-cy-photos-filters-option":"place"},on:{close:function(s){return e.emit("deselect")}},scopedSlots:t._u([t.value!==void 0?{key:"icon",fn:function(){return[a("img",{staticClass:"place__preview",attrs:{src:e.placeImageSource}})]},proxy:!0}:null,{key:"default",fn:function(){return[t._v(" "+t._s(t.value)+" ")]},proxy:!0}],null,!0)})},ut=[],dt=g(ct,pt,ut,!1,null,"2881d1a8");const ft=dt.exports,h="places",mt={id:h,icon:rt,renderOptionComponent:ft,async getOptions(){if(Object.values(c.getters.places).length===0){const t=await b(S);c.dispatch("addCollections",{collections:t})}return Object.values(Object.values(c.getters.places)).map(t=>({filterId:h,label:t.displayname,value:t.displayname,imgSrc:y(`/apps/photos/api/v1/preview/${t.attributes["last-photo"]}?x=64&y=64`)}))},getQuery(t){return`<d:or>${t.map(a=>`
			<d:eq>
				<d:prop><nc:metadata-photos-place/></d:prop>
				<d:literal>${a}</d:literal>
			</d:eq>
		`).join("")}</d:or>`}},N=[nt,mt],gt=m({__name:"PhotosFiltersDisplay",props:{selectedFilters:null},emits:["deselect-filter"],setup(t,{emit:a}){const e=t,s=u(()=>N.filter(n=>{const o=e.selectedFilters[n.id];return o!==void 0&&o.length!==0}));return{__sfc:!0,props:e,emit:a,availableFilters:s,NcIconSvgWrapper:C}}});var vt=function(){var t=this,a=t._self._c,e=t._self._setupProxy;return a("div",{staticClass:"photos-filters-display"},t._l(e.availableFilters,function(s){return a("div",{key:s.id,staticClass:"photos-filters-display__filter"},[a(e.NcIconSvgWrapper,{attrs:{svg:s.icon}}),a("div",{staticClass:"photos-filters-display__filter__options-container"},t._l(t.selectedFilters[s.id],function(n,o){return a(s.renderOptionComponent,{key:`${s.id}_${o}`,tag:"component",staticClass:"photos-filters-display__filter__options-container__option",attrs:{value:n},on:{deselect:function(d){return e.emit("deselect-filter",{filterId:s.id,value:n})}}})}),1)],1)}),0)},_t=[],ht=g(gt,vt,_t,!1,null,"db72611f");const Mt=ht.exports,yt=m({__name:"PhotosFiltersInput",props:{selectedFilters:null},emits:["select-filter"],setup(t,{emit:a}){const e=t,s=p([]),n=u(()=>s.value.filter(i=>!_(i))),o=p(!0),d=N.map(async i=>{const l=await i.getOptions();s.value.push(...l)});Promise.all(d).then(()=>{o.value=!1});function r(i){i.forEach(async l=>{l.getValue!==void 0&&(l.value=await l.getValue()),l.value!==void 0&&a("select-filter",l)})}function _(i){return e.selectedFilters[i.filterId]?.includes(i.value)}return{__sfc:!0,props:e,emit:a,availableOptions:s,availableOptionsWithSelection:n,loading:o,getOptionsPromises:d,handleSelectOptions:r,optionIsSelected:_,t:f,NcListItemIcon:$,NcSelect:T}}});var Ct=function(){var t=this,a=t._self._c,e=t._self._setupProxy;return a("div",{staticClass:"photos-filters-input",attrs:{"data-cy-photos-filters-input":""}},[a(e.NcSelect,{staticClass:"places-select",attrs:{options:e.availableOptionsWithSelection,"aria-label-combobox":e.t("photos","Select filters"),placeholder:e.t("photos","Select filters"),loading:e.loading,multiple:!0},on:{"option:selected":e.handleSelectOptions},scopedSlots:t._u([{key:"option",fn:function(s){return[a(e.NcListItemIcon,{attrs:{name:s.label,"is-no-user":!0,url:s.imgSrc}})]}}])})],1)},St=[],bt=g(yt,Ct,St,!1,null,"cd233c90");const Ft=bt.exports;export{Mt as P,Ft as a,N as f};
//# sourceMappingURL=PhotosFiltersInput-B1N6dvUw.chunk.mjs.map

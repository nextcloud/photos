import{d as m,g as u,H as w,a as f,a4 as V,e as d,o as k,k as y}from"./vue.runtime.esm-OiydnxB-.chunk.mjs";import{r as P,ak as I,k as D,n as H,C,x as A,J as O,d as M,p,l as F,z as S}from"./index-ycziVi-9.chunk.mjs";import{n as g}from"./icons-UgBTm9C1.chunk.mjs";import{N as T,a as R}from"./NcSelect-BD9fhCVy-vmNiMZzD.chunk.mjs";import{s as W}from"./dialog-CiY8TRVl.chunk.mjs";import j from"./NcDateTimePicker-BP2THb4s.chunk.mjs";import{N as L}from"./NcDialog-Bu9xyU24-In8X1aeg.chunk.mjs";import{N as B}from"./NcActionButton-1gSJfFUC-DtAb5qOU.chunk.mjs";import{N as z}from"./NcDateTime-enXYuwj8-BbRwmIXM.chunk.mjs";import{f as b}from"./collectionFetcher-DAjdzmEV.chunk.mjs";import{r as E}from"./video-BDfR9rZh.chunk.mjs";const Y='<svg xmlns="http://www.w3.org/2000/svg" id="mdi-calendar-month" viewBox="0 0 24 24"><path d="M9,10V12H7V10H9M13,10V12H11V10H13M17,10V12H15V10H17M19,3A2,2 0 0,1 21,5V19A2,2 0 0,1 19,21H5C3.89,21 3,20.1 3,19V5A2,2 0 0,1 5,3H6V1H8V3H16V1H18V3H19M19,19V8H5V19H19M9,14V16H7V14H9M13,14V16H11V14H13M17,14V16H15V14H17Z" /></svg>',$=m({__name:"CustomDateRangePickerDialog",emits:["close"],setup(t,{emit:a}){const e=u([null,null]);return w(e,n=>{(n[0]!==null||n[1]!==null)&&a("close",{start:n[0].getTime(),end:n[1].getTime()})}),{__sfc:!0,emit:a,dateRange:e,t:f,NcDateTimePicker:j,NcDialog:L}}});var q=function(){var t=this,a=t._self._c,e=t._self._setupProxy;return a(e.NcDialog,{attrs:{name:e.t("photos","Select a custom date range"),size:"normal"},on:{closing:function(n){return e.emit("close",void 0)}}},[a("div",{staticClass:"date-range-picker-dialog",attrs:{"data-cy-photos-filters-input":"custom-date-range"}},[a(e.NcDateTimePicker,{staticClass:"date-range-picker-dialog__picker",attrs:{clearable:!0,type:"date-range",placeholder:e.t("photos","Select a date range")},scopedSlots:t._u([{key:"default",fn:function(){return[t._v(" "+t._s(e.t("photos","Date range"))+" ")]},proxy:!0}]),model:{value:e.dateRange,callback:function(n){e.dateRange=n},expression:"dateRange"}})],1)])},Q=[],Z=g($,q,Q,!1,null,"3b73070f");const J=Z.exports;P(I);const G={__name:"NcChip",props:{ariaLabelClose:{type:String,default:D("Close")},actionsContainer:{type:String,default:"body"},text:{type:String,default:""},type:{type:String,default:"secondary",validator:t=>["primary","secondary","tertiary","error","warning","success"].includes(t)},iconPath:{type:String,default:null},iconSvg:{type:String,default:null},noClose:{type:Boolean,default:!1},variant:{type:String,default:"secondary",validator:t=>["primary","secondary","tertiary","error","warning","success"].includes(t)}},emits:["close"],setup(t,{emit:a}){const e=t,n=V(),s=d(()=>e.type!=="secondary"?e.type:e.variant),o=d(()=>!e.noClose);return{__sfc:!0,props:e,emit:a,slots:n,realVariant:s,canClose:o,hasActions:()=>{var l;return!!((l=n.actions)!=null&&l.call(n))},hasIcon:()=>{var l;return!!(e.iconPath||e.iconSvg||(l=n.icon)!=null&&l.call(n))},mdiClose:O,NcActionButton:B,NcActions:A,NcIconSvgWrapper:C}}};var K=function(){var t=this,a=t._self._c,e=t._self._setupProxy;return a("div",{staticClass:"nc-chip",class:{["nc-chip--".concat(e.realVariant)]:!0,"nc-chip--no-actions":t.noClose&&!e.hasActions(),"nc-chip--no-icon":!e.hasIcon()}},[e.hasIcon()?a("span",{staticClass:"nc-chip__icon"},[t._t("icon",function(){return[t.iconPath||t.iconSvg?a(e.NcIconSvgWrapper,{attrs:{inline:"",path:t.iconPath,svg:t.iconPath?void 0:t.iconSvg,size:18}}):t._e()]})],2):t._e(),a("span",{staticClass:"nc-chip__text"},[t._t("default",function(){return[t._v(t._s(t.text))]})],2),e.canClose||e.hasActions()?a(e.NcActions,{staticClass:"nc-chip__actions",attrs:{container:t.actionsContainer,"force-menu":!e.canClose,variant:"tertiary-no-background"}},[e.canClose?a(e.NcActionButton,{attrs:{"close-after-click":""},on:{click:function(n){return e.emit("close")}},scopedSlots:t._u([{key:"icon",fn:function(){return[a(e.NcIconSvgWrapper,{attrs:{path:e.mdiClose,size:20}})]},proxy:!0}],null,!1,2547223506)},[t._v(" "+t._s(t.ariaLabelClose)+" ")]):t._e(),t._t("actions")],2):t._e()],1)},U=[],X=H(G,K,U,!1,null,"c8e429a5");const x=X.exports,tt=m({__name:"DateRangeOption",props:{value:null},emits:["deselect"],setup(t,{emit:a}){return{__sfc:!0,emit:a,NcChip:x,NcDateTime:z}}});var et=function(){var t=this,a=t._self._c,e=t._self._setupProxy;return a(e.NcChip,{attrs:{"data-cy-photos-filters-option":"date-range"},on:{close:function(n){return e.emit("deselect")}},scopedSlots:t._u([{key:"default",fn:function(){return[a(e.NcDateTime,{attrs:{timestamp:t.value.start,format:{dateStyle:"long"},"relative-time":!1}}),t._v(" ⸱ "),a(e.NcDateTime,{attrs:{timestamp:t.value.end,format:{dateStyle:"long"},"relative-time":!1}})]},proxy:!0}])})},at=[],nt=g(tt,et,at,!1,null,null);const ot=nt.exports,_="date-range",st={id:_,icon:Y,renderOptionComponent:ot,async getOptions(){const t=new Date;return[{filterId:_,label:f("photos","Last week"),value:{start:new Date(t.getFullYear(),t.getMonth(),t.getDate()-t.getDay()-7).getTime(),end:new Date(t.getFullYear(),t.getMonth(),t.getDate()-t.getDay()-1).getTime()}},{filterId:_,label:f("photos","Last Month"),value:{start:new Date(t.getFullYear(),t.getMonth()-1,1).getTime(),end:new Date(t.getFullYear(),t.getMonth(),0).getTime()}},{filterId:_,label:f("photos","Custom…"),value:void 0,async getValue(){return new Promise(a=>{W(J,void 0,a)})}}]},getQuery(t){const a=t.map(e=>"\n			<d:and>\n				<d:gt>\n					<d:prop><nc:metadata-photos-original_date_time/></d:prop>\n					<d:literal>".concat(e.start/1e3,"</d:literal>\n				</d:gt>\n				<d:lt>\n					<d:prop><nc:metadata-photos-original_date_time/></d:prop>\n					<d:literal>").concat(e.end/1e3+86400,"</d:literal>\n				</d:lt>\n			</d:and>"));return"<d:or>".concat(a.join(""),"</d:or>")}},lt='<svg xmlns="http://www.w3.org/2000/svg" id="mdi-map-marker" viewBox="0 0 24 24"><path d="M12,11.5A2.5,2.5 0 0,1 9.5,9A2.5,2.5 0 0,1 12,6.5A2.5,2.5 0 0,1 14.5,9A2.5,2.5 0 0,1 12,11.5M12,2A7,7 0 0,0 5,9C5,14.25 12,22 12,22C12,22 19,14.25 19,9A7,7 0 0,0 12,2Z" /></svg>';function rt(){const t=u(new AbortController),a=d(()=>t.value.signal);function e(){t.value.abort(),t.value=new AbortController}return k(()=>{t.value.abort()}),E.beforeEach((n,s,o)=>{e(),o()}),{abortSignal:a,abortPendingRequest:e}}function it(){const t=u(null),a=u(!1),{abortSignal:e}=rt();async function n(s,o=[],l=M){var v;if(a.value)return[];try{a.value=!0,t.value=null;const i=await b(s,{signal:e.value},o,l);return p.dispatch("addCollections",{collections:i}),i}catch(i){((v=i.response)==null?void 0:v.status)===404?t.value=404:t.value=i,F.error("Error fetching collections:",{error:i})}finally{a.value=!1}return[]}return{fetchCollections:n,errorFetchingCollections:t,loadingCollections:a}}const ct=m({__name:"PlaceOption",props:{value:null},emits:["deselect"],setup(t,{emit:a}){const e=t,{fetchCollections:n}=it(),s=d(()=>{const o=p.getters.getPlace(e.value);return o?y("/apps/photos/api/v1/preview/".concat(o.attributes["last-photo"],"?x=").concat(64,"&y=").concat(64)):""});return Object.values(p.getters.places).length===0&&n(S),{__sfc:!0,props:e,emit:a,fetchCollections:n,placeImageSource:s,NcChip:x}}});var pt=function(){var t=this,a=t._self._c,e=t._self._setupProxy;return a(e.NcChip,{attrs:{"data-cy-photos-filters-option":"place"},on:{close:function(n){return e.emit("deselect")}},scopedSlots:t._u([t.value!==void 0?{key:"icon",fn:function(){return[a("img",{staticClass:"place__preview",attrs:{src:e.placeImageSource}})]},proxy:!0}:null,{key:"default",fn:function(){return[t._v(" "+t._s(t.value)+" ")]},proxy:!0}],null,!0)})},ut=[],dt=g(ct,pt,ut,!1,null,"e05d44dd");const ft=dt.exports,h="places",mt={id:h,icon:lt,renderOptionComponent:ft,async getOptions(){if(Object.values(p.getters.places).length===0){const t=await b(S);p.dispatch("addCollections",{collections:t})}return Object.values(Object.values(p.getters.places)).map(t=>({filterId:h,label:t.displayname,value:t.displayname,imgSrc:y("/apps/photos/api/v1/preview/".concat(t.attributes["last-photo"],"?x=").concat(64,"&y=").concat(64))}))},getQuery(t){const a=t.map(e=>"\n			<d:eq>\n				<d:prop><nc:metadata-photos-place/></d:prop>\n				<d:literal>".concat(e,"</d:literal>\n			</d:eq>\n		"));return"<d:or>".concat(a.join(""),"</d:or>")}},N=[st,mt],gt=m({__name:"PhotosFiltersDisplay",props:{selectedFilters:null},emits:["deselect-filter"],setup(t,{emit:a}){const e=t,n=d(()=>N.filter(s=>{const o=e.selectedFilters[s.id];return o!==void 0&&o.length!==0}));return{__sfc:!0,props:e,emit:a,availableFilters:n,NcIconSvgWrapper:C}}});var vt=function(){var t=this,a=t._self._c,e=t._self._setupProxy;return a("div",{staticClass:"photos-filters-display"},t._l(e.availableFilters,function(n){return a("div",{key:n.id,staticClass:"photos-filters-display__filter"},[a(e.NcIconSvgWrapper,{attrs:{svg:n.icon}}),a("div",{staticClass:"photos-filters-display__filter__options-container"},t._l(t.selectedFilters[n.id],function(s,o){return a(n.renderOptionComponent,{key:"".concat(n.id,"_").concat(o),tag:"component",staticClass:"photos-filters-display__filter__options-container__option",attrs:{value:s},on:{deselect:function(l){return e.emit("deselect-filter",{filterId:n.id,value:s})}}})}),1)],1)}),0)},_t=[],ht=g(gt,vt,_t,!1,null,"db72611f");const Mt=ht.exports,yt=m({__name:"PhotosFiltersInput",props:{selectedFilters:null},emits:["select-filter"],setup(t,{emit:a}){const e=t,n=u([]),s=d(()=>n.value.filter(c=>!i(c))),o=u(!0),l=N.map(async c=>{const r=await c.getOptions();n.value.push(...r)});Promise.all(l).then(()=>{o.value=!1});function v(c){c.forEach(async r=>{r.getValue!==void 0&&(r.value=await r.getValue()),r.value!==void 0&&a("select-filter",r)})}function i(c){var r;return(r=e.selectedFilters[c.filterId])==null?void 0:r.includes(c.value)}return{__sfc:!0,props:e,emit:a,availableOptions:n,availableOptionsWithSelection:s,loading:o,getOptionsPromises:l,handleSelectOptions:v,optionIsSelected:i,t:f,NcListItemIcon:R,NcSelect:T}}});var Ct=function(){var t=this,a=t._self._c,e=t._self._setupProxy;return a("div",{staticClass:"photos-filters-input",attrs:{"data-cy-photos-filters-input":""}},[a(e.NcSelect,{staticClass:"places-select",attrs:{options:e.availableOptionsWithSelection,"aria-label-combobox":e.t("photos","Select filters"),placeholder:e.t("photos","Select filters"),loading:e.loading,multiple:!0},on:{"option:selected":e.handleSelectOptions},scopedSlots:t._u([{key:"option",fn:function(n){return[a(e.NcListItemIcon,{attrs:{name:n.label,"is-no-user":!0,url:n.imgSrc}})]}}])})],1)},St=[],bt=g(yt,Ct,St,!1,null,"cd233c90");const Ft=bt.exports;export{Mt as P,Ft as a,N as f};
//# sourceMappingURL=PhotosFiltersInput-BXJdN7DC.chunk.mjs.map

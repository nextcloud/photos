import{d as m,c as p,w as N,t as f,ag as V,f as u,p as P,l as y}from"./preload-helper-3AjuMuUS.chunk.mjs";import{i as I,r as D,ao as k,t as H,n as A,C,x as O,J as M,ap as F,d as T,p as c,l as $,z as S}from"./index-gMNm7ohC.chunk.mjs";import{n as g}from"./icons-CFZwNZD8.chunk.mjs";import{N as R,a as W}from"./NcSelect-DTniMiUS-XMMR2P9B.chunk.mjs";import j from"./NcDateTimePicker-4mXXqQG0.chunk.mjs";import{N as L}from"./NcActionButton-DykQxmXJ-C3Q_TP_S.chunk.mjs";import{N as B}from"./NcDateTime-enXYuwj8-D4J7Fl4q.chunk.mjs";import{f as b}from"./collectionFetcher-DQVcpU4T.chunk.mjs";import{r as z}from"./video-DMMJP8Yk.chunk.mjs";const E='<svg xmlns="http://www.w3.org/2000/svg" id="mdi-calendar-month" viewBox="0 0 24 24"><path d="M9,10V12H7V10H9M13,10V12H11V10H13M17,10V12H15V10H17M19,3A2,2 0 0,1 21,5V19A2,2 0 0,1 19,21H5C3.89,21 3,20.1 3,19V5A2,2 0 0,1 5,3H6V1H8V3H16V1H18V3H19M19,19V8H5V19H19M9,14V16H7V14H9M13,14V16H11V14H13M17,14V16H15V14H17Z" /></svg>',Y=m({__name:"CustomDateRangePickerDialog",emits:["close"],setup(e,{emit:a}){const t=p([null,null]);return N(t,s=>{(s[0]!==null||s[1]!==null)&&a("close",{start:s[0].getTime(),end:s[1].getTime()})}),{__sfc:!0,emit:a,dateRange:t,t:f,NcDateTimePicker:j,NcDialog:I}}});var q=function(){var e=this,a=e._self._c,t=e._self._setupProxy;return a(t.NcDialog,{attrs:{name:t.t("photos","Select a custom date range"),size:"normal"},on:{closing:function(s){return t.emit("close",void 0)}}},[a("div",{staticClass:"date-range-picker-dialog",attrs:{"data-cy-photos-filters-input":"custom-date-range"}},[a(t.NcDateTimePicker,{staticClass:"date-range-picker-dialog__picker",attrs:{clearable:!0,type:"date-range",placeholder:t.t("photos","Select a date range")},scopedSlots:e._u([{key:"default",fn:function(){return[e._v(" "+e._s(t.t("photos","Date range"))+" ")]},proxy:!0}]),model:{value:t.dateRange,callback:function(s){t.dateRange=s},expression:"dateRange"}})],1)])},Q=[],Z=g(Y,q,Q,!1,null,"3b73070f");const J=Z.exports;D(k);const G={__name:"NcChip",props:{ariaLabelClose:{type:String,default:H("Close")},actionsContainer:{type:String,default:"body"},text:{type:String,default:""},type:{type:String,default:"secondary",validator:e=>["primary","secondary","tertiary","error","warning","success"].includes(e)},iconPath:{type:String,default:null},iconSvg:{type:String,default:null},noClose:{type:Boolean,default:!1},variant:{type:String,default:"secondary",validator:e=>["primary","secondary","tertiary","error","warning","success"].includes(e)}},emits:["close"],setup(e,{emit:a}){const t=e,s=V(),n=u(()=>t.type!=="secondary"?t.type:t.variant),o=u(()=>!t.noClose);return{__sfc:!0,props:t,emit:a,slots:s,realVariant:n,canClose:o,hasActions:()=>!!s.actions?.(),hasIcon:()=>!!(t.iconPath||t.iconSvg||s.icon?.()),mdiClose:M,NcActionButton:L,NcActions:O,NcIconSvgWrapper:C}}};var K=function(){var e=this,a=e._self._c,t=e._self._setupProxy;return a("div",{staticClass:"nc-chip",class:{[`nc-chip--${t.realVariant}`]:!0,"nc-chip--no-actions":e.noClose&&!t.hasActions(),"nc-chip--no-icon":!t.hasIcon()}},[t.hasIcon()?a("span",{staticClass:"nc-chip__icon"},[e._t("icon",function(){return[e.iconPath||e.iconSvg?a(t.NcIconSvgWrapper,{attrs:{inline:"",path:e.iconPath,svg:e.iconPath?void 0:e.iconSvg,size:18}}):e._e()]})],2):e._e(),a("span",{staticClass:"nc-chip__text"},[e._t("default",function(){return[e._v(e._s(e.text))]})],2),t.canClose||t.hasActions()?a(t.NcActions,{staticClass:"nc-chip__actions",attrs:{container:e.actionsContainer,"force-menu":!t.canClose,variant:"tertiary-no-background"}},[t.canClose?a(t.NcActionButton,{attrs:{"close-after-click":""},on:{click:function(s){return t.emit("close")}},scopedSlots:e._u([{key:"icon",fn:function(){return[a(t.NcIconSvgWrapper,{attrs:{path:t.mdiClose,size:20}})]},proxy:!0}],null,!1,2547223506)},[e._v(" "+e._s(e.ariaLabelClose)+" ")]):e._e(),e._t("actions")],2):e._e()],1)},U=[],X=A(G,K,U,!1,null,"88e86387");const x=X.exports,ee=m({__name:"DateRangeOption",props:{value:null},emits:["deselect"],setup(e,{emit:a}){return{__sfc:!0,emit:a,NcChip:x,NcDateTime:B}}});var te=function(){var e=this,a=e._self._c,t=e._self._setupProxy;return a(t.NcChip,{attrs:{"data-cy-photos-filters-option":"date-range"},on:{close:function(s){return t.emit("deselect")}},scopedSlots:e._u([{key:"default",fn:function(){return[a(t.NcDateTime,{attrs:{timestamp:e.value.start,format:{dateStyle:"long"},"relative-time":!1}}),e._v(" ⸱ "),a(t.NcDateTime,{attrs:{timestamp:e.value.end,format:{dateStyle:"long"},"relative-time":!1}})]},proxy:!0}])})},ae=[],se=g(ee,te,ae,!1,null,null);const oe=se.exports,v="date-range",ne={id:v,icon:E,renderOptionComponent:oe,async getOptions(){const e=new Date;return[{filterId:v,label:f("photos","Last week"),value:{start:new Date(e.getFullYear(),e.getMonth(),e.getDate()-e.getDay()-7).getTime(),end:new Date(e.getFullYear(),e.getMonth(),e.getDate()-e.getDay()-1).getTime()}},{filterId:v,label:f("photos","Last Month"),value:{start:new Date(e.getFullYear(),e.getMonth()-1,1).getTime(),end:new Date(e.getFullYear(),e.getMonth(),0).getTime()}},{filterId:v,label:f("photos","Custom…"),value:void 0,async getValue(){return new Promise(a=>{F(J,void 0,a)})}}]},getQuery(e){return`<d:or>${e.map(a=>`
			<d:and>
				<d:gt>
					<d:prop><nc:metadata-photos-original_date_time/></d:prop>
					<d:literal>${a.start/1e3}</d:literal>
				</d:gt>
				<d:lt>
					<d:prop><nc:metadata-photos-original_date_time/></d:prop>
					<d:literal>${a.end/1e3+86400}</d:literal>
				</d:lt>
			</d:and>`).join("")}</d:or>`}},re='<svg xmlns="http://www.w3.org/2000/svg" id="mdi-map-marker" viewBox="0 0 24 24"><path d="M12,11.5A2.5,2.5 0 0,1 9.5,9A2.5,2.5 0 0,1 12,6.5A2.5,2.5 0 0,1 14.5,9A2.5,2.5 0 0,1 12,11.5M12,2A7,7 0 0,0 5,9C5,14.25 12,22 12,22C12,22 19,14.25 19,9A7,7 0 0,0 12,2Z" /></svg>';function ie(){const e=p(new AbortController),a=u(()=>e.value.signal);function t(){e.value.abort(),e.value=new AbortController}return P(()=>{e.value.abort()}),z.beforeEach((s,n,o)=>{t(),o()}),{abortSignal:a,abortPendingRequest:t}}function le(){const e=p(null),a=p(!1),{abortSignal:t}=ie();async function s(n,o=[],d=T){if(a.value)return[];try{a.value=!0,e.value=null;const r=await b(n,{signal:t.value},o,d);return c.dispatch("addCollections",{collections:r}),r}catch(r){r.response?.status===404?e.value=404:e.value=r,$.error("Error fetching collections:",{error:r})}finally{a.value=!1}return[]}return{fetchCollections:s,errorFetchingCollections:e,loadingCollections:a}}const ce=m({__name:"PlaceOption",props:{value:null},emits:["deselect"],setup(e,{emit:a}){const t=e,{fetchCollections:s}=le(),n=u(()=>{const o=c.getters.getPlace(t.value);return o?y(`/apps/photos/api/v1/preview/${o.attributes["last-photo"]}?x=64&y=64`):""});return Object.values(c.getters.places).length===0&&s(S),{__sfc:!0,props:t,emit:a,fetchCollections:s,placeImageSource:n,NcChip:x}}});var pe=function(){var e=this,a=e._self._c,t=e._self._setupProxy;return a(t.NcChip,{attrs:{"data-cy-photos-filters-option":"place"},on:{close:function(s){return t.emit("deselect")}},scopedSlots:e._u([e.value!==void 0?{key:"icon",fn:function(){return[a("img",{staticClass:"place__preview",attrs:{src:t.placeImageSource}})]},proxy:!0}:null,{key:"default",fn:function(){return[e._v(" "+e._s(e.value)+" ")]},proxy:!0}],null,!0)})},ue=[],de=g(ce,pe,ue,!1,null,"e05d44dd");const fe=de.exports,h="places",me={id:h,icon:re,renderOptionComponent:fe,async getOptions(){if(Object.values(c.getters.places).length===0){const e=await b(S);c.dispatch("addCollections",{collections:e})}return Object.values(Object.values(c.getters.places)).map(e=>({filterId:h,label:e.displayname,value:e.displayname,imgSrc:y(`/apps/photos/api/v1/preview/${e.attributes["last-photo"]}?x=64&y=64`)}))},getQuery(e){return`<d:or>${e.map(a=>`
			<d:eq>
				<d:prop><nc:metadata-photos-place/></d:prop>
				<d:literal>${a}</d:literal>
			</d:eq>
		`).join("")}</d:or>`}},w=[ne,me],ge=m({__name:"PhotosFiltersDisplay",props:{selectedFilters:null},emits:["deselect-filter"],setup(e,{emit:a}){const t=e,s=u(()=>w.filter(n=>{const o=t.selectedFilters[n.id];return o!==void 0&&o.length!==0}));return{__sfc:!0,props:t,emit:a,availableFilters:s,NcIconSvgWrapper:C}}});var ve=function(){var e=this,a=e._self._c,t=e._self._setupProxy;return a("div",{staticClass:"photos-filters-display"},e._l(t.availableFilters,function(s){return a("div",{key:s.id,staticClass:"photos-filters-display__filter"},[a(t.NcIconSvgWrapper,{attrs:{svg:s.icon}}),a("div",{staticClass:"photos-filters-display__filter__options-container"},e._l(e.selectedFilters[s.id],function(n,o){return a(s.renderOptionComponent,{key:`${s.id}_${o}`,tag:"component",staticClass:"photos-filters-display__filter__options-container__option",attrs:{value:n},on:{deselect:function(d){return t.emit("deselect-filter",{filterId:s.id,value:n})}}})}),1)],1)}),0)},_e=[],he=g(ge,ve,_e,!1,null,"db72611f");const Ae=he.exports,ye=m({__name:"PhotosFiltersInput",props:{selectedFilters:null},emits:["select-filter"],setup(e,{emit:a}){const t=e,s=p([]),n=u(()=>s.value.filter(i=>!_(i))),o=p(!0),d=w.map(async i=>{const l=await i.getOptions();s.value.push(...l)});Promise.all(d).then(()=>{o.value=!1});function r(i){i.forEach(async l=>{l.getValue!==void 0&&(l.value=await l.getValue()),l.value!==void 0&&a("select-filter",l)})}function _(i){return t.selectedFilters[i.filterId]?.includes(i.value)}return{__sfc:!0,props:t,emit:a,availableOptions:s,availableOptionsWithSelection:n,loading:o,getOptionsPromises:d,handleSelectOptions:r,optionIsSelected:_,t:f,NcListItemIcon:W,NcSelect:R}}});var Ce=function(){var e=this,a=e._self._c,t=e._self._setupProxy;return a("div",{staticClass:"photos-filters-input",attrs:{"data-cy-photos-filters-input":""}},[a(t.NcSelect,{staticClass:"places-select",attrs:{options:t.availableOptionsWithSelection,"aria-label-combobox":t.t("photos","Select filters"),placeholder:t.t("photos","Select filters"),loading:t.loading,multiple:!0},on:{"option:selected":t.handleSelectOptions},scopedSlots:e._u([{key:"option",fn:function(s){return[a(t.NcListItemIcon,{attrs:{name:s.label,"is-no-user":!0,url:s.imgSrc}})]}}])})],1)},Se=[],be=g(ye,Ce,Se,!1,null,"cd233c90");const Oe=be.exports;export{Ae as P,Oe as a,w as f};
//# sourceMappingURL=PhotosFiltersInput-BkfVrpqr.chunk.mjs.map

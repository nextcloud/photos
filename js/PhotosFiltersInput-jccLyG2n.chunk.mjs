import{d as m,b as p,w,t as f,a3 as V,q as u,z as P,_ as y}from"./vue.runtime.esm-Ct3_M7aQ.chunk.mjs";import{r as I,X as k,a as D,n as H,e as C,s as A,ak as O,al as M,p as c,l as F,af as S}from"./index-BbsYjFcn.chunk.mjs";import{n as g}from"./icons-VGG7keIQ.chunk.mjs";import{N as T,a as $}from"./NcSelect-CjUzohn5-BtK6gdRg.chunk.mjs";import{s as R}from"./dialog-DMSB8C_5.chunk.mjs";import{N as W}from"./NcDateTimePicker-BsszyOjb.chunk.mjs";import{N as j}from"./NcDialog-CKgpZOiy-eEyn0akO.chunk.mjs";import{N as L}from"./NcActionButton-CuVNJJtW-Cz6I6vjz.chunk.mjs";import{N as B}from"./NcDateTime-DshRFtUU-DHSFcYLn.chunk.mjs";import{f as b}from"./collectionFetcher-CdDTUYiR.chunk.mjs";import{d as q}from"./video-CBshWR5j.chunk.mjs";const z='<svg xmlns="http://www.w3.org/2000/svg" id="mdi-calendar-month" viewBox="0 0 24 24"><path d="M9,10V12H7V10H9M13,10V12H11V10H13M17,10V12H15V10H17M19,3A2,2 0 0,1 21,5V19A2,2 0 0,1 19,21H5C3.89,21 3,20.1 3,19V5A2,2 0 0,1 5,3H6V1H8V3H16V1H18V3H19M19,19V8H5V19H19M9,14V16H7V14H9M13,14V16H11V14H13M17,14V16H15V14H17Z" /></svg>',E=m({__name:"CustomDateRangePickerDialog",emits:["close"],setup(t,{emit:a}){const e=p([null,null]);return w(e,s=>{(s[0]!==null||s[1]!==null)&&a("close",{start:s[0].getTime(),end:s[1].getTime()})}),{__sfc:!0,emit:a,dateRange:e,t:f,NcDateTimePicker:W,NcDialog:j}}});var Y=function(){var t=this,a=t._self._c,e=t._self._setupProxy;return a(e.NcDialog,{attrs:{name:e.t("photos","Select a custom date range"),size:"normal"},on:{closing:function(s){return e.emit("close",void 0)}}},[a("div",{staticClass:"date-range-picker-dialog",attrs:{"data-cy-photos-filters-input":"custom-date-range"}},[a(e.NcDateTimePicker,{staticClass:"date-range-picker-dialog__picker",attrs:{clearable:!0,type:"date-range",placeholder:e.t("photos","Select a date range")},scopedSlots:t._u([{key:"default",fn:function(){return[t._v(" "+t._s(e.t("photos","Date range"))+" ")]},proxy:!0}]),model:{value:e.dateRange,callback:function(s){e.dateRange=s},expression:"dateRange"}})],1)])},Q=[],Z=g(E,Y,Q,!1,null,"3b73070f");const X=Z.exports;I(k);const G={__name:"NcChip",props:{ariaLabelClose:{type:String,default:D("Close")},actionsContainer:{type:String,default:"body"},text:{type:String,default:""},type:{type:String,default:"secondary",validator:t=>["primary","secondary","tertiary"].includes(t)},iconPath:{type:String,default:null},iconSvg:{type:String,default:null},noClose:{type:Boolean,default:!1},variant:{type:String,default:"secondary",validator:t=>["primary","secondary","tertiary"].includes(t)}},emits:["close"],setup(t,{emit:a}){const e=t,s=V(),n=u(()=>e.type!=="secondary"?e.type:e.variant),o=u(()=>!e.noClose);return{__sfc:!0,props:e,emit:a,slots:s,realVariant:n,canClose:o,hasActions:()=>!!s.actions?.(),hasIcon:()=>!!(e.iconPath||e.iconSvg||s.icon?.()),onClose:()=>{a("close")},mdiClose:O,NcActions:A,NcActionButton:L,NcIconSvgWrapper:C}}};var J=function(){var t=this,a=t._self._c,e=t._self._setupProxy;return a("div",{staticClass:"nc-chip",class:{[`nc-chip--${e.realVariant}`]:!0,"nc-chip--no-actions":t.noClose&&!e.hasActions(),"nc-chip--no-icon":!e.hasIcon()}},[e.hasIcon()?a("span",{staticClass:"nc-chip__icon"},[t._t("icon",function(){return[t.iconPath||t.iconSvg?a(e.NcIconSvgWrapper,{attrs:{inline:"",path:t.iconPath,svg:t.iconPath?void 0:t.iconSvg,size:18}}):t._e()]})],2):t._e(),a("span",{staticClass:"nc-chip__text"},[t._t("default",function(){return[t._v(t._s(t.text))]})],2),e.canClose||e.hasActions()?a(e.NcActions,{staticClass:"nc-chip__actions",attrs:{container:t.actionsContainer,"force-menu":!e.canClose,variant:"tertiary-no-background"}},[e.canClose?a(e.NcActionButton,{attrs:{"close-after-click":""},on:{click:e.onClose},scopedSlots:t._u([{key:"icon",fn:function(){return[a(e.NcIconSvgWrapper,{attrs:{path:e.mdiClose,size:20}})]},proxy:!0}],null,!1,2547223506)},[t._v(" "+t._s(t.ariaLabelClose)+" ")]):t._e(),t._t("actions")],2):t._e()],1)},K=[],U=H(G,J,K,!1,null,"a7b8715a");const N=U.exports,tt=m({__name:"DateRangeOption",props:{value:null},emits:["deselect"],setup(t,{emit:a}){return{__sfc:!0,emit:a,NcChip:N,NcDateTime:B}}});var et=function(){var t=this,a=t._self._c,e=t._self._setupProxy;return a(e.NcChip,{attrs:{"data-cy-photos-filters-option":"date-range"},on:{close:function(s){return e.emit("deselect")}},scopedSlots:t._u([{key:"default",fn:function(){return[a(e.NcDateTime,{attrs:{timestamp:t.value.start,format:{dateStyle:"long"},"relative-time":!1}}),t._v(" ⸱ "),a(e.NcDateTime,{attrs:{timestamp:t.value.end,format:{dateStyle:"long"},"relative-time":!1}})]},proxy:!0}])})},at=[],st=g(tt,et,at,!1,null,null);const ot=st.exports,v="date-range",nt={id:v,icon:z,renderOptionComponent:ot,async getOptions(){const t=new Date;return[{filterId:v,label:f("photos","Last week"),value:{start:new Date(t.getFullYear(),t.getMonth(),t.getDate()-t.getDay()-7).getTime(),end:new Date(t.getFullYear(),t.getMonth(),t.getDate()-t.getDay()-1).getTime()}},{filterId:v,label:f("photos","Last Month"),value:{start:new Date(t.getFullYear(),t.getMonth()-1,1).getTime(),end:new Date(t.getFullYear(),t.getMonth(),0).getTime()}},{filterId:v,label:f("photos","Custom…"),value:void 0,async getValue(){return new Promise(a=>{R(X,void 0,a)})}}]},getQuery(t){return`<d:or>${t.map(a=>`
			<d:and>
				<d:gt>
					<d:prop><nc:metadata-photos-original_date_time/></d:prop>
					<d:literal>${a.start/1e3}</d:literal>
				</d:gt>
				<d:lt>
					<d:prop><nc:metadata-photos-original_date_time/></d:prop>
					<d:literal>${a.end/1e3+86400}</d:literal>
				</d:lt>
			</d:and>`).join("")}</d:or>`}},lt='<svg xmlns="http://www.w3.org/2000/svg" id="mdi-map-marker" viewBox="0 0 24 24"><path d="M12,11.5A2.5,2.5 0 0,1 9.5,9A2.5,2.5 0 0,1 12,6.5A2.5,2.5 0 0,1 14.5,9A2.5,2.5 0 0,1 12,11.5M12,2A7,7 0 0,0 5,9C5,14.25 12,22 12,22C12,22 19,14.25 19,9A7,7 0 0,0 12,2Z" /></svg>';function rt(){const t=p(new AbortController),a=u(()=>t.value.signal);function e(){t.value.abort(),t.value=new AbortController}return P(()=>{t.value.abort()}),q.beforeEach((s,n,o)=>{e(),o()}),{abortSignal:a,abortPendingRequest:e}}function it(){const t=p(null),a=p(!1),{abortSignal:e}=rt();async function s(n,o=[],d=M){if(a.value)return[];try{a.value=!0,t.value=null;const l=await b(n,{signal:e.value},o,d);return c.dispatch("addCollections",{collections:l}),l}catch(l){l.response?.status===404?t.value=404:t.value=l,F.error("Error fetching collections:",{error:l})}finally{a.value=!1}return[]}return{fetchCollections:s,errorFetchingCollections:t,loadingCollections:a}}const ct=m({__name:"PlaceOption",props:{value:null},emits:["deselect"],setup(t,{emit:a}){const e=t,{fetchCollections:s}=it(),n=u(()=>{const o=c.getters.getPlace(e.value);return o?y(`/apps/photos/api/v1/preview/${o.attributes["last-photo"]}?x=64&y=64`):""});return Object.values(c.getters.places).length===0&&s(S),{__sfc:!0,props:e,fetchCollections:s,placeImageSource:n,emit:a,NcChip:N}}});var pt=function(){var t=this,a=t._self._c,e=t._self._setupProxy;return a(e.NcChip,{attrs:{"data-cy-photos-filters-option":"place"},on:{close:function(s){return e.emit("deselect")}},scopedSlots:t._u([t.value!==void 0?{key:"icon",fn:function(){return[a("img",{staticClass:"place__preview",attrs:{src:e.placeImageSource}})]},proxy:!0}:null,{key:"default",fn:function(){return[t._v(" "+t._s(t.value)+" ")]},proxy:!0}],null,!0)})},ut=[],dt=g(ct,pt,ut,!1,null,"2881d1a8");const ft=dt.exports,h="places",mt={id:h,icon:lt,renderOptionComponent:ft,async getOptions(){if(Object.values(c.getters.places).length===0){const t=await b(S);c.dispatch("addCollections",{collections:t})}return Object.values(Object.values(c.getters.places)).map(t=>({filterId:h,label:t.displayname,value:t.displayname,imgSrc:y(`/apps/photos/api/v1/preview/${t.attributes["last-photo"]}?x=64&y=64`)}))},getQuery(t){return`<d:or>${t.map(a=>`
			<d:eq>
				<d:prop><nc:metadata-photos-place/></d:prop>
				<d:literal>${a}</d:literal>
			</d:eq>
		`).join("")}</d:or>`}},x=[nt,mt],gt=m({__name:"PhotosFiltersDisplay",props:{selectedFilters:null},emits:["deselect-filter"],setup(t,{emit:a}){const e=t,s=u(()=>x.filter(n=>{const o=e.selectedFilters[n.id];return o!==void 0&&o.length!==0}));return{__sfc:!0,props:e,emit:a,availableFilters:s,NcIconSvgWrapper:C}}});var vt=function(){var t=this,a=t._self._c,e=t._self._setupProxy;return a("div",{staticClass:"photos-filters-display"},t._l(e.availableFilters,function(s){return a("div",{key:s.id,staticClass:"photos-filters-display__filter"},[a(e.NcIconSvgWrapper,{attrs:{svg:s.icon}}),a("div",{staticClass:"photos-filters-display__filter__options-container"},t._l(t.selectedFilters[s.id],function(n,o){return a(s.renderOptionComponent,{key:`${s.id}_${o}`,tag:"component",staticClass:"photos-filters-display__filter__options-container__option",attrs:{value:n},on:{deselect:function(d){return e.emit("deselect-filter",{filterId:s.id,value:n})}}})}),1)],1)}),0)},_t=[],ht=g(gt,vt,_t,!1,null,"db72611f");const Mt=ht.exports,yt=m({__name:"PhotosFiltersInput",props:{selectedFilters:null},emits:["select-filter"],setup(t,{emit:a}){const e=t,s=p([]),n=u(()=>s.value.filter(r=>!_(r))),o=p(!0),d=x.map(async r=>{const i=await r.getOptions();s.value.push(...i)});Promise.all(d).then(()=>{o.value=!1});function l(r){r.forEach(async i=>{i.getValue!==void 0&&(i.value=await i.getValue()),i.value!==void 0&&a("select-filter",i)})}function _(r){return e.selectedFilters[r.filterId]?.includes(r.value)}return{__sfc:!0,props:e,emit:a,availableOptions:s,availableOptionsWithSelection:n,loading:o,getOptionsPromises:d,handleSelectOptions:l,optionIsSelected:_,t:f,NcListItemIcon:$,NcSelect:T}}});var Ct=function(){var t=this,a=t._self._c,e=t._self._setupProxy;return a("div",{staticClass:"photos-filters-input",attrs:{"data-cy-photos-filters-input":""}},[a(e.NcSelect,{staticClass:"places-select",attrs:{options:e.availableOptionsWithSelection,"aria-label-combobox":e.t("photos","Select filters"),placeholder:e.t("photos","Select filters"),loading:e.loading,multiple:!0},on:{"option:selected":e.handleSelectOptions},scopedSlots:t._u([{key:"option",fn:function(s){return[a(e.NcListItemIcon,{attrs:{name:s.label,"is-no-user":!0,url:s.imgSrc}})]}}])})],1)},St=[],bt=g(yt,Ct,St,!1,null,"cd233c90");const Ft=bt.exports;export{Mt as P,Ft as a,x as f};
//# sourceMappingURL=PhotosFiltersInput-jccLyG2n.chunk.mjs.map

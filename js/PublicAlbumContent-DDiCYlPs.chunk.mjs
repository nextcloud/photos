import{t as a,_ as s,Q as n,a6 as r}from"./vue.runtime.esm-DMa8KkVG.chunk.mjs";import{B as m,K as o,D as c,L as i}from"./index-B6un_sFJ.chunk.mjs";import{N as u}from"./NcEmptyContent-HeyKi7BU.chunk.mjs";import{i as h}from"./isMobile-DdVhdwV1.chunk.mjs";import{m as b,M as p,n as d}from"./icons-CG9j2hi8.chunk.mjs";import{C as f}from"./CollectionContent-DqTCw9Dg.chunk.mjs";import{H as g}from"./HeaderNavigation-DJMwdi8D.chunk.mjs";import{P as C}from"./PhotosFiltersDisplay-ANX6-Qvc.chunk.mjs";import{F}from"./FetchCollectionContentMixin-DACfHJT2.chunk.mjs";import"./index-Ef_xmGOs.chunk.mjs";import"./FileComponent-BbJAB6Co.chunk.mjs";import"./FilesSelectionMixin-DffLZIEQ.chunk.mjs";import"./fileFetcher-3khBzTR2.chunk.mjs";import"./collectionFetcher-D79nAIin.chunk.mjs";import"./index-D8H910dW.chunk.mjs";import"./preload-helper-Dh9HmuEY.chunk.mjs";import"./AbortControllerMixin-CnjZSzur.chunk.mjs";const v={name:"PublicAlbumContent",components:{MapMarker:p,ImageOff:b,NcEmptyContent:u,NcActions:m,CollectionContent:f,HeaderNavigation:g,PhotosFiltersDisplay:C},mixins:[F,h],props:{token:{type:String,required:!0}},data(){return{showAddPhotosModal:!1,loadingCount:0,loadingAddFilesToAlbum:!1,albumOriginalName:"",publicClient:n(r("dav"),{Authorization:`Basic ${btoa(`${this.token}:`)}`})}},computed:{album(){return this.$store.getters.getPublicAlbum(this.albumName)},albumName(){return this.token},albumFileIds(){return this.$store.getters.getPublicAlbumFiles(this.albumName)},publicAlbumFileName(){return this.$store.getters.getPublicAlbumName(this.albumName)}},async beforeMount(){await this.fetchAlbumInfo(),await this.fetchAlbumContent()},methods:{async fetchAlbumInfo(){const t=await this.fetchCollection(`${o}/${this.token}`,i,this.publicClient);t!==null&&(this.albumOriginalName=t.attributes["original-name"])},async fetchAlbumContent(){(await this.fetchCollectionFiles(`${o}/${this.token}`,[...c,...i],this.publicClient)).forEach(t=>{t.update({previewUrl:s(`/apps/photos/api/v1/publicPreview/${t.fileid}?x=2048&y=2048&token=${this.token}`),hasPreview:!1})})},async handleFilesPicked(t){this.showAddPhotosModal=!1,await this.$store.dispatch("addFilesToCollection",{collectionFileName:this.album.root+this.albumName,fileIdsToAdd:t}),await this.fetchAlbumContent()},async handleRemoveFilesFromAlbum(t){this.$refs.collectionContent.onUncheckFiles(t),await this.$store.dispatch("removeFilesFromCollection",{collectionFileName:this.album.root+this.albumName,fileIdsToRemove:t})},t:a}};var N=function(){var t=this,e=t._self._c;return e("div",[e("CollectionContent",{ref:"collectionContent",attrs:{collection:t.album,"collection-file-ids":t.albumFileIds,"allow-selection":!1,loading:t.loadingCollection||t.loadingCollectionFiles,error:t.errorFetchingCollection||t.errorFetchingCollectionFiles},scopedSlots:t._u([{key:"header",fn:function({selectedFileIds:l}){return t.albumOriginalName!==""?e("HeaderNavigation",{key:"navigation",attrs:{loading:t.loadingCollection||t.loadingCollectionFiles,params:{token:t.token},path:"/","root-title":t.albumOriginalName,title:t.albumOriginalName},on:{refresh:t.fetchAlbumContent}},[t.album.attributes.location!==""?e("div",{staticClass:"album__location",attrs:{slot:"subtitle"},slot:"subtitle"},[e("MapMarker"),t._v(t._s(t.album.attributes.location)+" ")],1):t._e(),e("template",{slot:"default"},[t.album!==void 0?e("span",{staticClass:"album-container__filters"},[e("PhotosFiltersDisplay",{attrs:{"filters-value":t.album.attributes.filters}})],1):t._e()]),t.album!==void 0?e("template",{slot:"right"},[e("NcActions",{attrs:{"force-menu":!0,"aria-label":t.t("photos","Open actions menu")}},[l.length>0?void 0:t._e()],2)],1):t._e()],2):t._e()}}],null,!0)},[e("NcEmptyContent",{staticClass:"album__empty",attrs:{slot:"empty-content",name:t.t("photos","This album does not have any photos or videos yet!")},slot:"empty-content"},[e("ImageOff",{attrs:{slot:"icon"},slot:"icon"})],1)],1)],1)},A=[],y=d(v,N,A,!1,null,"9438992c");const q=y.exports;export{q as default};
//# sourceMappingURL=PublicAlbumContent-DDiCYlPs.chunk.mjs.map

import{_ as m,d as y,a as v,t as h,g as n,u as A,s as F}from"./vue.runtime.esm-DE8Vf-Sj.chunk.mjs";import{m as r}from"./index-CKppNoVt.chunk.mjs";import{u as g}from"./index-Bgusy0Eo.chunk.mjs";import{N as C}from"./NcActionButton-CuVNJJtW-CuYdCDcU.chunk.mjs";import{n as w,s as p,f as k,N as f,q as c,h as N,m as S,ag as u,ah as d}from"./index-DiDFXBG0.chunk.mjs";import{N as O}from"./NcEmptyContent-pb5UHZk8.chunk.mjs";import{n as l,j as x,P as b,J as B,u as I,E as $,K as L,z as M,L as D,N as P,D as T}from"./icons-I1kUiwaa.chunk.mjs";import{N as U}from"./NcAvatar-YSp2ORHc-DK-v-LWX.chunk.mjs";import{P as H,A as Y}from"./PhotosFiltersInput-BtDzqQgX.chunk.mjs";import{A as _}from"./AlbumForm-ZLNIP4Vj.chunk.mjs";import{N as E}from"./NcListItem-DfaWGP5A-htYZRI9I.chunk.mjs";import{N as j}from"./NcVNodes-vvJKR-pE.chunk.mjs";import{N as V}from"./NcUserBubble-B3-E-5F5-DRWJKlQU.chunk.mjs";import{F as K}from"./FetchCollectionsMixin-DJlbs6PZ.chunk.mjs";import{F as q}from"./FileComponent-Ci4zUbmk.chunk.mjs";import{F as R,a as z}from"./FilesSelectionMixin-DX6eHzUH.chunk.mjs";import{H as J}from"./HeaderNavigation-U6-9Ub1R.chunk.mjs";import{a as Q}from"./PhotosSourceLocationsSettings-1-duP_W0.chunk.mjs";import{F as G}from"./FetchFilesMixin-BBjoMOjL.chunk.mjs";import{F as W}from"./FilesByMonthMixin-CuObt4Pl.chunk.mjs";import{p as X}from"./PhotosFiltersDisplay-B6WPl7MF.chunk.mjs";import"./preload-helper-Dh9HmuEY.chunk.mjs";import"./logger-D3RVzcfQ-DuMcYv0L.chunk.mjs";import"./NcTextField-o_8gWurX-CGIOV_Iq.chunk.mjs";import"./useModelMigration-EhAWvqDD-DdyTIrbs.chunk.mjs";import"./index-x9vhq81Z.chunk.mjs";import"./NcDateTimePicker-Cw1hqwsP.chunk.mjs";import"./ChevronDown-DFQfzh63-DzrxVXh0.chunk.mjs";import"./FetchCollectionContentMixin-BHZgi5-5.chunk.mjs";import"./collectionFetcher-C_jh_sgq.chunk.mjs";import"./AbortControllerMixin-CtlVmv6y.chunk.mjs";import"./NcCheckboxRadioSwitch-VeztTzpz-BiMk-OgY.chunk.mjs";import"./fileFetcher-CTCND05K.chunk.mjs";import"./index-D4aMb6Rr.chunk.mjs";import"./index-CRBSYXMv.chunk.mjs";import"./PhotoSearch-DTZLo_8Q.chunk.mjs";import"./NcDateTime-DshRFtUU-8kfZRxpS.chunk.mjs";const Z={name:"NcListItem",components:{NcActions:p,NcCounterBubble:E,NcVNodes:j},props:{details:{type:String,default:""},name:{type:String,default:void 0},exact:{type:Boolean,default:!1},to:{type:[String,Object],default:null},href:{type:String,default:"#"},target:{type:String,default:""},anchorId:{type:String,default:""},bold:{type:Boolean,default:!1},compact:{type:Boolean,default:!1},active:{type:Boolean,default:!1},linkAriaLabel:{type:String,default:""},actionsAriaLabel:{type:String,default:void 0},counterNumber:{type:[Number,String],default:0},counterType:{type:String,default:"",validator(t){return["highlighted","outlined",""].indexOf(t)!==-1}},forceDisplayActions:{type:Boolean,default:!1},forceMenu:{type:Boolean,default:!1},oneLine:{type:Boolean,default:!1}},emits:["click","update:menuOpen"],setup(){const[t]=window._oc_config?.version.split(".",2)??[];return{isLegacy:t&&Number.parseInt(t)<30}},data(){return{hovered:!1,hasActions:!1,hasSubname:!1,displayActionsOnHoverFocus:!1,menuOpen:!1,hasIndicator:!1,hasDetails:!1}},computed:{showAdditionalElements(){return!this.displayActionsOnHoverFocus||this.forceDisplayActions},showDetails(){return(this.details!==""||this.hasDetails)&&(!this.displayActionsOnHoverFocus||this.forceDisplayActions)}},watch:{menuOpen(t){!t&&!this.hovered&&(this.displayActionsOnHoverFocus=!1)}},mounted(){this.checkSlots()},updated(){this.checkSlots()},methods:{onClick(t,e,s){this.$emit("click",t),!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)&&s&&(e?.(t),t.preventDefault())},showActions(){this.hasActions&&(this.displayActionsOnHoverFocus=!0),this.hovered=!1},hideActions(){this.displayActionsOnHoverFocus=!1},handleBlur(t){this.menuOpen||this.$refs["list-item"].contains(t.relatedTarget)||this.hideActions()},handleMouseleave(){this.menuOpen||(this.displayActionsOnHoverFocus=!1),this.hovered=!1},handleMouseover(){this.showActions(),this.hovered=!0},handleActionsUpdateOpen(t){this.menuOpen=t,this.$emit("update:menuOpen",t)},checkSlots(){this.hasActions!==!!this.$slots.actions&&(this.hasActions=!!this.$slots.actions),this.hasSubname!==!!this.$slots.subname&&(this.hasSubname=!!this.$slots.subname),this.hasIndicator!==!!this.$slots.indicator&&(this.hasIndicator=!!this.$slots.indicator),this.hasDetails!==!!this.$slots.details&&(this.hasDetails=!!this.$slots.details)}}};var tt=function(){var t=this,e=t._self._c;return e(t.to?"router-link":"NcVNodes",{tag:"component",attrs:{custom:t.to?!0:null,to:t.to,exact:t.to?t.exact:null},scopedSlots:t._u([{key:"default",fn:function({href:s,navigate:a,isActive:i}){return[e("li",{staticClass:"list-item__wrapper",class:{"list-item__wrapper--active":i||t.active}},[e("div",{ref:"list-item",staticClass:"list-item",class:{"list-item--compact":t.compact,"list-item--legacy":t.isLegacy,"list-item--one-line":t.oneLine},on:{mouseover:t.handleMouseover,mouseleave:t.handleMouseleave}},[e("a",{staticClass:"list-item__anchor",attrs:{id:t.anchorId||void 0,"aria-label":t.linkAriaLabel,href:s||t.href,target:t.target||(t.href==="#"?void 0:"_blank"),rel:t.href==="#"?void 0:"noopener noreferrer"},on:{focus:t.showActions,focusout:t.handleBlur,click:function(o){return t.onClick(o,a,s)},keydown:function(o){return!o.type.indexOf("key")&&t._k(o.keyCode,"esc",27,o.key,["Esc","Escape"])?null:t.hideActions.apply(null,arguments)}}},[t._t("icon"),e("div",{staticClass:"list-item-content"},[e("div",{staticClass:"list-item-content__main"},[e("div",{staticClass:"list-item-content__name"},[t._t("name",function(){return[t._v(t._s(t.name))]})],2),t.hasSubname?e("div",{staticClass:"list-item-content__subname",class:{"list-item-content__subname--bold":t.bold}},[t._t("subname")],2):t._e()]),e("div",{staticClass:"list-item-content__details"},[t.showDetails?e("div",{staticClass:"list-item-details__details"},[t._t("details",function(){return[t._v(t._s(t.details))]})],2):t._e(),t.counterNumber||t.hasIndicator?e("div",{directives:[{name:"show",rawName:"v-show",value:t.showAdditionalElements,expression:"showAdditionalElements"}],staticClass:"list-item-details__extra"},[t.counterNumber?e("NcCounterBubble",{staticClass:"list-item-details__counter",attrs:{active:i||t.active,type:t.counterType}},[t._v(" "+t._s(t.counterNumber)+" ")]):t._e(),t.hasIndicator?e("span",{staticClass:"list-item-details__indicator"},[t._t("indicator")],2):t._e()],1):t._e()])])],2),t.$slots["extra-actions"]?e("div",{staticClass:"list-item-content__extra-actions"},[t._t("extra-actions")],2):t._e(),e("div",{directives:[{name:"show",rawName:"v-show",value:t.forceDisplayActions||t.displayActionsOnHoverFocus,expression:"forceDisplayActions || displayActionsOnHoverFocus"}],staticClass:"list-item-content__actions",on:{focusout:t.handleBlur}},[e("NcActions",{ref:"actions",attrs:{primary:i||t.active,"force-menu":t.forceMenu,"aria-label":t.actionsAriaLabel},on:{"update:open":t.handleActionsUpdateOpen},scopedSlots:t._u([t.$slots["actions-icon"]?{key:"icon",fn:function(){return[t._t("actions-icon")]},proxy:!0}:null],null,!0)},[t._t("actions")],2)],1),t.$slots.extra?e("div",{staticClass:"list-item__extra"},[t._t("extra")],2):t._e()])])]}}],null,!0)})},et=[],st=w(Z,tt,et,!1,null,"40599719");const it=st.exports,ot={name:"ActionDownload",components:{NcActionLink:U},props:{title:{type:String,required:!0},selectedFileIds:{type:Array,required:!0}},computed:{files(){return this.$store.state.files.files},downloadUrl(){const t=new URLSearchParams;return t.append("files",JSON.stringify(this.paths)),m(`/apps/files/ajax/download.php?${t}`)},paths(){return this.selectedFileIds.map(t=>this.files[t].path)}}};var at=function(){var t=this,e=t._self._c;return e("NcActionLink",{attrs:{"close-after-click":!0,href:t.downloadUrl,download:t.downloadUrl,"aria-label":t.title}},[t._v(" "+t._s(t.title)+" "),t._t("icon",null,{slot:"icon"})],2)},lt=[],nt=l(ot,at,lt,!1,null,null);const rt=nt.exports,ct=y({name:"AlbumPicker",components:{Plus:b,ImageMultipleOutline:x,NcButton:f,NcListItem:it,NcLoadingIcon:k,NcUserBubble:V,AlbumForm:_},filters:{toCoverUrl(t){return m(`/apps/photos/api/v1/preview/${t}?x=64&y=64`)}},mixins:[K],data(){return{showAlbumCreationForm:!1}},computed:{albums(){return this.$store.getters.albums},sharedAlbums(){return this.$store.getters.sharedAlbums},allAlbums(){return[...Object.values(this.albums),...Object.values(this.sharedAlbums)]}},mounted(){this.fetchAlbumList()},methods:{async fetchAlbumList(){await this.fetchCollections(`/photos/${n()?.uid}/albums`,c),await this.fetchCollections(`/photos/${n()?.uid}/sharedalbums`,c)},albumCreatedHandler(){this.showAlbumCreationForm=!1,this.fetchAlbumList()},pickAlbum(t){this.$emit("album-picked",t)},isSharedAlbum(t){return t.path.match(/^\/photos\/.+\/sharedalbums\//)!==null},originalName(t){return this.isSharedAlbum(t)?t.basename.replace(new RegExp(`\\(${t.attributes.collaborators[0].id}\\)$`),""):t.basename},t:h,n:v}});var ut=function(){var t=this,e=t._self._c;return t._self._setupProxy,t.showAlbumCreationForm?e("AlbumForm",{attrs:{"display-back-button":!0,title:t.t("photos","New album")},on:{back:function(s){t.showAlbumCreationForm=!1},done:t.albumCreatedHandler}}):e("div",{staticClass:"album-picker"},[e("h2",[t._v(" "+t._s(t.t("photos","Add to Album"))+" "),t.loadingCollections?e("NcLoadingIcon",{staticClass:"loading-icon"}):t._e()],1),e("ul",{staticClass:"albums-container"},t._l(t.allAlbums,function(s){return e("NcListItem",{key:s.attributes.filename,staticClass:"album",attrs:{name:t.originalName(s),"aria-label":t.t("photos","Add selection to album {albumName}",{albumName:s.basename})},on:{click:function(a){return t.pickAlbum(s)}},scopedSlots:t._u([{key:"subname",fn:function(){return[t._v(" "+t._s(t.n("photos","%n item","%n photos and videos",s.attributes.nbItems))+" "),t.isSharedAlbum(s)?[t._v(" ⸱ "+t._s(t.t("photos","Shared by"))+" "),e("NcUserBubble",{attrs:{"display-name":s.attributes.collaborators[0].label,user:s.attributes.collaborators[0].id}})]:t._e()]},proxy:!0}],null,!0)},[e("template",{slot:"icon"},[s.attributes["last-photo"]!==-1?e("img",{staticClass:"album__image",attrs:{src:t._f("toCoverUrl")(s.attributes["last-photo"])}}):e("div",{staticClass:"album__image album__image--placeholder"},[e("ImageMultipleOutline",{attrs:{size:32}})],1)])],2)}),1),e("NcButton",{staticClass:"new-album-button",attrs:{"aria-label":t.t("photos","Create a new album."),type:"tertiary"},on:{click:function(s){t.showAlbumCreationForm=!0}},scopedSlots:t._u([{key:"icon",fn:function(){return[e("Plus")]},proxy:!0}],null,!1,1489515321)},[t._v(" "+t._s(t.t("photos","Create new album"))+" ")])],1)},dt=[],mt=l(ct,ut,dt,!1,null,"fc6b3de5");const ht=mt.exports,pt={name:"TimelineView",components:{DeleteOutline:T,PlusBoxMultipleOutline:P,DownloadOutline:D,Close:M,Plus:b,FolderAlertOutline:L,NcEmptyContent:O,NcModal:S,NcActions:p,NcActionButton:C,NcButton:f,AlbumForm:_,AlbumPicker:ht,FilesListViewer:z,FileComponent:q,ActionFavorite:Y,ActionDownload:rt,HeaderNavigation:J,PhotosSourceLocationsSettings:Q,AlertCircleOutline:$,PhotosFiltersInput:H,FilterOutline:I,FilterOffOutline:B},filters:{dateMonth(t){return r(t,"YYYYMM").format("MMMM")},dateYear(t){return r(t,"YYYYMM").format("YYYY")}},mixins:[G,R,W],beforeRouteLeave(t,e,s){window.scrollTo(0,0),s()},props:{onlyFavorites:{type:Boolean,default:!1},mimesType:{type:Array,default:()=>N},onThisDay:{type:Boolean,default:!1},rootTitle:{type:String,required:!0}},setup(){return{isMobile:g()}},data(){return{loadingCount:0,showAlbumCreationForm:!1,showAlbumPicker:!1,appContent:document.getElementById("app-content-vue"),showFilters:!1,filters:{}}},computed:{files(){return this.$store.state.files.files},createAlbumButtonLabel(){return Object.values(this.filters).filter(t=>t!==void 0).length>0?this.t("photos","Create new album from filters"):this.t("photos","Create new album")}},watch:{"$route.path":function(){this.filters={}}},mounted(){F(d,this.handleUserConfigChange)},destroyed(){A(d,this.handleUserConfigChange)},methods:{getContent(){this.fetchFiles({mimesType:this.mimesType,onThisDay:this.onThisDay,onlyFavorites:this.onlyFavorites,extraFilters:Object.entries(this.filters).map(([t,e])=>X.find(s=>s.id===t)?.getQuery(e)).join(`
`)})},openViewer(t){window.OCA.Viewer.open({fileInfo:u(this.files[t]),list:Object.values(this.fileIdsByMonth).flat().map(e=>u(this.files[e]))})},openUploader(){},async addSelectionToAlbum(t){this.showAlbumPicker=!1,await this.$store.dispatch("addFilesToCollection",{collectionFileName:t.root+t.path,fileIdsToAdd:this.selectedFileIds})},async deleteSelection(){const t=this.selectedFileIds;this.onUncheckFiles(t),this.fetchedFileIds=this.fetchedFileIds.filter(e=>!t.includes(e)),await this.$store.dispatch("deleteFiles",t)},handleUserConfigChange({key:t}){t==="photosSourceFolders"&&this.resetFetchFilesState()},toggleFilters(){this.showFilters=!this.showFilters,this.showFilters||(this.filters={},this.resetFetchFilesState())},handleFiltersChange(t){this.filters=t,this.resetFetchFilesState(),this.getContent()},handleFormCreationDone({album:t}){this.showAlbumCreationForm=!1,this.$router.push(`/albums/${t.basename}`)},t:h}};var ft=function(){var t=this,e=t._self._c;return t.errorFetchingFiles?e("div",{staticClass:"timeline__empty-content"},[t.errorFetchingFiles===404?e("NcEmptyContent",{attrs:{name:t.t("photos","One of the source folders does not exist")}},[e("FolderAlertOutline",{attrs:{slot:"icon"},slot:"icon"}),e("PhotosSourceLocationsSettings",{staticClass:"timeline__update_source_directory",attrs:{slot:"action"},slot:"action"})],1):e("NcEmptyContent",{attrs:{name:t.t("photos","An error occurred")}},[e("AlertCircleOutline",{attrs:{slot:"icon"},slot:"icon"})],1)],1):e("div",{staticClass:"timeline"},[e("HeaderNavigation",{key:"navigation",attrs:{loading:t.loadingCount>0,path:"/",title:t.rootTitle,"root-title":t.rootTitle},on:{refresh:t.resetFetchFilesState}},[e("div",{staticClass:"timeline__header__left"},[t.selectedFileIds.length===0?e("NcButton",{ref:"newAlbumButton",attrs:{"aria-label":t.createAlbumButtonLabel,"data-cy-header-action":"create-album"},on:{click:function(s){t.showAlbumCreationForm=!0}},scopedSlots:t._u([{key:"icon",fn:function(){return[e("PlusBoxMultipleOutline")]},proxy:!0}],null,!1,2448450972)},[t._v(" "+t._s(t.createAlbumButtonLabel)+" ")]):[e("NcButton",{attrs:{"close-after-click":!0,type:"primary","aria-label":t.t("photos","Add to album"),"data-cy-header-action":"add-to-album"},on:{click:function(s){t.showAlbumPicker=!0}},scopedSlots:t._u([{key:"icon",fn:function(){return[e("Plus")]},proxy:!0},t.isMobile?null:{key:"default",fn:function(){return[t._v(" "+t._s(t.t("photos","Add to album"))+" ")]},proxy:!0}],null,!0)}),t.selectedFileIds.length>0?e("NcButton",{attrs:{"aria-label":t.t("photos","Unselect all"),"data-cy-header-action":"unselect-all"},on:{click:t.resetSelection},scopedSlots:t._u([{key:"icon",fn:function(){return[e("Close")]},proxy:!0},t.isMobile?null:{key:"default",fn:function(){return[t._v(" "+t._s(t.t("photos","Unselect all"))+" ")]},proxy:!0}],null,!0)}):t._e(),e("NcActions",{attrs:{"aria-label":t.t("photos","Open actions menu")}},[e("ActionDownload",{attrs:{"selected-file-ids":t.selectedFileIds,title:t.t("photos","Download selected files"),"data-cy-header-action":"download-selection"}},[e("DownloadOutline",{attrs:{slot:"icon"},slot:"icon"})],1),e("ActionFavorite",{attrs:{"selected-file-ids":t.selectedFileIds}}),e("NcActionButton",{attrs:{"close-after-click":!0,"aria-label":t.t("photos","Delete selection"),"data-cy-header-action":"delete-selection"},on:{click:t.deleteSelection},scopedSlots:t._u([{key:"icon",fn:function(){return[e("DeleteOutline")]},proxy:!0}])},[t._v(" "+t._s(t.t("photos","Delete selection"))+" ")])],1)],e("NcButton",{attrs:{title:t.t("photos","Toggle filter"),"aria-label":t.t("photos","Toggle filter"),"data-cy-header-action":"toggle-filters",type:"tertiary"},on:{click:t.toggleFilters},scopedSlots:t._u([{key:"icon",fn:function(){return[t.showFilters?e("FilterOffOutline"):e("FilterOutline")]},proxy:!0}])})],2)]),t.showFilters?e("PhotosFiltersInput",{staticClass:"timeline__filters",attrs:{value:t.filters},on:{"update:value":t.handleFiltersChange}}):t._e(),e("FilesListViewer",{ref:"filesListViewer",staticClass:"timeline__file-list",attrs:{"container-element":t.appContent,"file-ids-by-section":t.fileIdsByMonth,sections:t.monthsList,loading:t.loadingFiles,"base-height":t.isMobile?120:200,"empty-message":t.t("photos","No photos or videos in here")},on:{"need-content":t.getContent},scopedSlots:t._u([{key:"default",fn:function({file:s,isHeader:a,distance:i}){return[a?e("h2",{staticClass:"section-header",attrs:{id:`file-picker-section-header-${s.id}`}},[e("b",[t._v(t._s(t._f("dateMonth")(s.id)))]),t._v(" "+t._s(t._f("dateYear")(s.id))+" ")]):e("FileComponent",{attrs:{file:t.files[s.id],"allow-selection":!0,selected:t.selection[s.id]===!0,distance:i},on:{click:t.openViewer,"select-toggled":t.onFileSelectToggle}})]}}])}),t.showAlbumCreationForm?e("NcModal",{key:"albumCreationForm",attrs:{"label-id":"new-album-form","set-return-focus":t.$refs.newAlbumButton?.$el},on:{close:function(s){t.showAlbumCreationForm=!1}}},[e("h2",{staticClass:"timeline__heading"},[t._v(" "+t._s(t.t("photos","New album"))+" ")]),e("AlbumForm",{attrs:{"filters-value":t.filters},on:{done:t.handleFormCreationDone}})],1):t._e(),t.showAlbumPicker?e("NcModal",{key:"albumPicker",attrs:{"label-id":"album-picker"},on:{close:function(s){t.showAlbumPicker=!1}}},[e("AlbumPicker",{on:{"album-picked":t.addSelectionToAlbum}})],1):t._e()],1)},bt=[],_t=l(pt,ft,bt,!1,null,"dd24445d");const ee=_t.exports;export{ee as default};
//# sourceMappingURL=TimelineView-BZ7YsBKd.chunk.mjs.map

import{t as n,V as l}from"./vue.runtime.esm-DMa8KkVG.chunk.mjs";import{A as c,C as r,B as d,o as f,f as s,O as i}from"./index-B6un_sFJ.chunk.mjs";import{N as h}from"./NcEmptyContent-HeyKi7BU.chunk.mjs";import{J as u,q as p,p as F,t as m,S as v,n as g}from"./icons-CG9j2hi8.chunk.mjs";import{F as _}from"./FaceMergeForm-Ck5wtdOH.chunk.mjs";import{F as w}from"./FileComponent-BbJAB6Co.chunk.mjs";import{F as C,a as y}from"./FilesSelectionMixin-DffLZIEQ.chunk.mjs";import{F as S}from"./FaceCover-DCsDx45Q.chunk.mjs";import{F as M}from"./FetchFilesMixin-3KT11p3k.chunk.mjs";import"./index-Ef_xmGOs.chunk.mjs";import"./fileFetcher-3khBzTR2.chunk.mjs";import"./AbortControllerMixin-CnjZSzur.chunk.mjs";import"./PhotoSearch-Bybibn_e.chunk.mjs";const k={name:"UnassignedFaces",components:{Star:v,Download:m,AlertCircle:F,ArrowLeft:p,FaceMergeForm:_,FilesListViewer:y,FileComponent:w,NcLoadingIcon:f,NcEmptyContent:h,NcActions:d,NcActionButton:r,NcDialog:c,AccountSwitch:u},directives:{focus(e){l.nextTick(()=>e.focus())}},mixins:[S,M,C],data(){return{showMoveModal:!1,loadingCount:0,appContent:document.getElementById("app-content-vue")}},computed:{files(){return this.$store.state.files.files},unassignedFiles(){return this.$store.state.faces.unassignedFiles},faceFileIds(){return this.unassignedFiles||[]},shouldFavoriteSelection(){return this.selectedFileIds.some(e=>this.$store.state.files.files[e].attributes.favorite===0)}},mounted(){this.fetchUnassignedFaces()},methods:{openViewer(e){window.OCA.Viewer.open({fileInfo:i(this.files[e]),list:this.faceFileIds.map(t=>i(this.files[t]))})},async handleMove(e,t){try{this.loadingCount++,await this.$store.dispatch("moveFilesToFace",{oldFace:null,faceName:e,fileIdsToMove:t}),this.showMoveModal=!1}catch(o){s.error("Failed to move selection",{error:o})}finally{this.loadingCount--}},async favoriteSelection(){try{this.loadingCount++,await this.$store.dispatch("toggleFavoriteForFiles",{fileIds:this.selectedFileIds,favoriteState:!0})}catch(e){s.error("Failed to favorite selection",{error:e})}finally{this.loadingCount--}},async unFavoriteSelection(){try{this.loadingCount++,await this.$store.dispatch("toggleFavoriteForFiles",{fileIds:this.selectedFileIds,favoriteState:!1})}catch(e){s.error("Failed to unfavorite selection",{error:e})}finally{this.loadingCount--}},async downloadSelection(){try{this.loadingCount++,await this.$store.dispatch("downloadFiles",this.selectedFileIds)}catch(e){s.error("Faile to download selection",{error:e})}finally{this.loadingCount--}},t:n}};var A=function(){var e=this,t=e._self._c;return e.errorFetchingFiles?t("NcEmptyContent",{scopedSlots:e._u([{key:"icon",fn:function(){return[t("AlertCircle")]},proxy:!0}],null,!1,794036927)},[e._v(" "+e._s(e.t("photos","An error occurred"))+" ")]):t("div",{staticClass:"face"},[t("div",{staticClass:"face__header"},[t("div",{staticClass:"face__header__left"},[t("NcActions",[t("NcActionButton",{on:{click:function(o){return e.$router.push("/faces/")}},scopedSlots:e._u([{key:"icon",fn:function(){return[t("ArrowLeft")]},proxy:!0}])},[e._v(e._s(e.t("photos","Back"))+" ")])],1),t("div",{staticClass:"face__header__title"},[t("h2",{class:{"face-name":!0}},[e._v(" "+e._s(e.t("photos","Unassigned faces"))+" ")])]),e.loadingCount>0||e.loadingFaces?t("NcLoadingIcon"):e._e()],1),t("div",{staticClass:"face__header__actions"},[t("NcActions",{attrs:{"force-menu":!0}},[e.selectedFileIds.length?[t("NcActionButton",{attrs:{"close-after-click":!0,"aria-label":e.t("photos","Download selected files")},on:{click:e.downloadSelection}},[t("Download",{attrs:{slot:"icon"},slot:"icon"}),e._v(" "+e._s(e.t("photos","Download selected photos"))+" ")],1),e.shouldFavoriteSelection?t("NcActionButton",{attrs:{"close-after-click":!0,"aria-label":e.t("photos","Mark selection as favorite")},on:{click:e.favoriteSelection}},[t("Star",{attrs:{slot:"icon"},slot:"icon"}),e._v(" "+e._s(e.t("photos","Favorite"))+" ")],1):t("NcActionButton",{attrs:{"close-after-click":!0,"aria-label":e.t("photos","Remove selection from favorites")},on:{click:e.unFavoriteSelection}},[t("Star",{attrs:{slot:"icon"},slot:"icon"}),e._v(" "+e._s(e.t("photos","Remove from favorites"))+" ")],1),t("NcActionButton",{attrs:{"close-after-click":!0},on:{click:function(o){e.showMoveModal=!0}},scopedSlots:e._u([{key:"icon",fn:function(){return[t("AccountSwitch")]},proxy:!0}],null,!1,2937983280)},[e._v(" "+e._s(e.n("photos","Move photo to a different person","Move photos to a different person",e.selectedFileIds.length))+" ")])]:e._e()],2)],1)]),t("FilesListViewer",{staticClass:"face__photos",attrs:{"container-element":e.appContent,"file-ids":e.faceFileIds,loading:e.loadingFiles||e.loadingFaces},scopedSlots:e._u([{key:"default",fn:function({file:o,distance:a}){return t("FileComponent",{attrs:{file:e.files[o.id],"allow-selection":!0,selected:e.selection[o.id]===!0,distance:a},on:{click:e.openViewer,"select-toggled":e.onFileSelectToggle}})}}])}),e.showMoveModal?t("NcDialog",{attrs:{name:e.t("photos","Move to different person"),"close-on-click-outside":"",size:"normal"},on:{closing:function(o){e.showMoveModal=!1}}},[t("FaceMergeForm",{attrs:{"first-face":"-1"},on:{select:function(o){return e.handleMove(o,e.selectedFileIds)}}})],1):e._e()],1)},I=[],N=g(k,A,I,!1,null,"0f7ffc65");const z=N.exports;export{z as default};
//# sourceMappingURL=UnassignedFaces-DwxOvDrx.chunk.mjs.map

import{r as m,a as g}from"./vue.runtime.esm-OiydnxB-.chunk.mjs";import{m as c}from"./index-Dt0wq4bO.chunk.mjs";import{d as p,l}from"./index-ycziVi-9.chunk.mjs";var x=Object.defineProperty,f=Object.getOwnPropertySymbols,y=Object.prototype.hasOwnProperty,v=Object.prototype.propertyIsEnumerable,u=(o,r,a)=>r in o?x(o,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):o[r]=a,d=(o,r)=>{for(var a in r||(r={}))y.call(r,a)&&u(o,a,r[a]);if(f)for(var a of f(r))v.call(r,a)&&u(o,a,r[a]);return o};function b(o=[]){return'<?xml version="1.0"?>\n			<d:propfind xmlns:d="DAV:"\n				xmlns:oc="http://owncloud.org/ns"\n				xmlns:nc="http://nextcloud.org/ns"\n				xmlns:ocs="http://open-collaboration-services.org/ns">\n				<d:prop>\n					<nc:last-photo />\n					<nc:nbItems />\n					'.concat(o.join(""),"\n				</d:prop>\n			</d:propfind>")}function D(o=[]){return'<?xml version="1.0"?>\n			<d:propfind xmlns:d="DAV:"\n				xmlns:oc="http://owncloud.org/ns"\n				xmlns:nc="http://nextcloud.org/ns"\n				xmlns:ocs="http://open-collaboration-services.org/ns">\n				<d:prop>\n					<d:getcontentlength />\n					<d:getcontenttype />\n					<d:getetag />\n					<d:getlastmodified />\n					<d:resourcetype />\n					<nc:metadata-photos-size />\n					<nc:metadata-photos-original_date_time />\n					<nc:metadata-files-live-photo />\n					<nc:has-preview />\n					<nc:hidden />\n					<oc:favorite />\n					<oc:fileid />\n					<oc:permissions />\n					'.concat(o.join("\n					"),"\n				</d:prop>\n			</d:propfind>")}async function R(o,r,a=[],n=p){try{const t=await n.stat(o,d({data:b(a),details:!0},r));return l.debug("[Collections] Fetched a collection: ",{data:t.data}),h(t.data,o.split("/").slice(0,-1).join("/"))}catch(t){if(t instanceof DOMException&&t.code===t.ABORT_ERR)return null;throw t}}async function j(o,r={},a=[],n=p){try{const t=await n.getDirectoryContents(o,d({data:b(a),details:!0},r));return l.debug("[Collections] Fetched ".concat(t.data.length," collections: "),{data:t.data}),t.data.filter(e=>e.filename!==o).map(e=>h(e,o))}catch(t){if(t instanceof DOMException&&t.code===t.ABORT_ERR)return[];throw t}}function h(o,r){var a,n,t;o.props.collaborators===void 0||o.props.collaborators===""?o.props.collaborators=[]:typeof o.props.collaborators.collaborator=="object"&&(Array.isArray(o.props.collaborators.collaborator)?o.props.collaborators=o.props.collaborators.collaborator:o.props.collaborators=[o.props.collaborators.collaborator]);const e=JSON.parse((n=(a=o.props.dateRange)==null?void 0:a.replace(/&quot;/g,'"'))!=null?n:"{}");e.start===null&&(e.start=c().unix(),e.end=c().unix());const s={startDate:c.unix(e.start).format("MMMM YYYY"),endDate:c.unix(e.end).format("MMMM YYYY")};return s.startDate===s.endDate?o.props.date=s.startDate:o.props.date=g("photos","{startDate} to {endDate}",s),o.props.filters=JSON.parse((t=o.props.filters)!=null?t:"{}"),m(o,r)}async function E(o,r,a=[],n=p){try{const t=await n.getDirectoryContents(o,d({data:D(a),details:!0},r)),e=o.split("/").slice(0,-1).join("/"),s=t.data.map(i=>m(i,e)).filter(i=>i.fileid!==void 0);return l.debug("[Collections] Fetched ".concat(s.length," new files: "),{fetchedFiles:s}),s}catch(t){if(t instanceof DOMException&&t.code===t.ABORT_ERR)return[];throw l.error("Error fetching collection files",{error:t}),t}}export{E as a,R as b,j as f};
//# sourceMappingURL=collectionFetcher-DAjdzmEV.chunk.mjs.map

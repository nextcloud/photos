import{V as s,I as u,u as P,s as M,d as S,a4 as O,y as L,e as T,H as f,z,W as x,a as o,k as h,p as r,i as E,j as p}from"./vue.runtime.esm-OiydnxB-.chunk.mjs";import{a as B,g as $,P as V,u as H,s as D,b as W,c as R}from"./filters-Bm6FUGKw.chunk.mjs";import{a as U,N as G,b as j,f as K,m as q,g as J,v as Q,i as X,s as Y,c as Z,r as y}from"./video-BDfR9rZh.chunk.mjs";import{n as m,a9 as tt,H as b,aa as et,ab as at,h as C,l as i,B as g,p as _}from"./index-ycziVi-9.chunk.mjs";import{N as ot,u as st,A as it,a as nt,b as rt}from"./NcAppSettingsSection-Yg4NYCih-C5zG9GrB.chunk.mjs";import{u as pt}from"./useHotKey-DwbsMrnX.chunk.mjs";import{n as l,H as lt,M as ct,x as dt,y as ut,z as ht,V as gt,B as mt,T as vt,G as ft,S as yt,a as _t,b as Nt,J as St,l as bt,K as Ct,I as At,L as kt,v as wt,N as It,r as Ft,O as Pt,Q as Mt,R as Ot,U as Lt,W as Tt,X as zt,h as xt,Y as Et}from"./icons-UgBTm9C1.chunk.mjs";import{P as Bt,a as $t}from"./PhotosFiltersInput-BXJdN7DC.chunk.mjs";import{N as Vt}from"./NcCheckboxRadioSwitch-Di43R9CE-DU845puP.chunk.mjs";import{d as Ht}from"./index-gUDvIMxF.chunk.mjs";import"./preload-helper-CPULxMJS.chunk.mjs";import"./dialog-CiY8TRVl.chunk.mjs";import"./index-Dt0wq4bO.chunk.mjs";import"./NcSelect-BD9fhCVy-vmNiMZzD.chunk.mjs";import"./NcAvatar-OCD_HmOb-BPLtBYgo.chunk.mjs";import"./NcActionButton-1gSJfFUC-DtAb5qOU.chunk.mjs";import"./useModelMigration-EhAWvqDD-CCVvXBPb.chunk.mjs";import"./NcDialog-Bu9xyU24-In8X1aeg.chunk.mjs";import"./NcDateTimePicker-BP2THb4s.chunk.mjs";import"./useFormatDateTime-DCSIXuCx.chunk.mjs";import"./createElementId-DhjFt1I9-D5Zp4M-4.chunk.mjs";import"./NcDateTime-enXYuwj8-BbRwmIXM.chunk.mjs";import"./collectionFetcher-DAjdzmEV.chunk.mjs";const Dt={name:"NcAppNavigationList"};var Wt=function(){var t=this,e=t._self._c;return e("ul",{staticClass:"app-navigation-list"},[t._t("default")],2)},Rt=[],Ut=m(Dt,Wt,Rt,!1,null,"058e6060");const Gt=Ut.exports,jt={name:"NcAppNavigation",components:{NcAppNavigationList:Gt,NcAppNavigationToggle:ot},inject:{setHasAppNavigation:{default:()=>()=>s.util.warn("NcAppNavigation is not mounted inside NcContent, this is probably an error."),from:"NcContent:setHasAppNavigation"}},props:{ariaLabel:{type:String,default:""},ariaLabelledby:{type:String,default:""}},setup(){return{isMobile:U()}},data(){return{open:!this.isMobile,focusTrap:null}},watch:{isMobile(){this.open=!this.isMobile,this.toggleFocusTrap()},open(){this.toggleFocusTrap()}},mounted(){this.setHasAppNavigation(!0),M("toggle-navigation",this.toggleNavigationByEventBus),u("navigation-toggled",{open:this.open}),this.focusTrap=et(this.$refs.appNavigationContainer,{allowOutsideClick:!0,fallbackFocus:this.$refs.appNavigationContainer,trapStack:at(),escapeDeactivates:!1}),this.toggleFocusTrap(),pt("n",this.onKeyDown,{prevent:!0,stop:!0})},unmounted(){this.setHasAppNavigation(!1),P("toggle-navigation",this.toggleNavigationByEventBus),this.focusTrap.deactivate()},methods:{async toggleNavigation(t){if(this.open===t){u("navigation-toggled",{open:this.open});return}this.open=typeof t>"u"?!this.open:t;const e=getComputedStyle(document.body),a=parseInt(e.getPropertyValue("--animation-quick"))||100;this.open&&(await this.$nextTick(),this.focusFirstElement()),setTimeout(()=>{u("navigation-toggled",{open:this.open})},1.5*a)},toggleNavigationByEventBus({open:t}){this.toggleNavigation(t)},toggleFocusTrap(){this.isMobile&&this.open?this.focusTrap.activate():this.focusTrap.deactivate()},handleEsc(){this.isMobile&&this.open&&this.toggleNavigation(!1)},focusFirstElement(){const t=tt(this.$refs.appNavigationContainer)[0];t&&(t.focus(),b.debug("Focusing first element in the navigation",{element:t}))},onKeyDown(t){if(t.key==="n"){if(!this.open){this.toggleNavigation(!0);return}this.isFocusWithinNavigation()&&this.toggleNavigation(!1)}},isFocusWithinNavigation(){var e;const t=document.activeElement;return(e=this.$refs.appNavigationContainer)==null?void 0:e.contains(t)}}};var Kt=function(){var t=this,e=t._self._c;return e("div",{ref:"appNavigationContainer",staticClass:"app-navigation",class:{"app-navigation--close":!t.open}},[e("nav",{staticClass:"app-navigation__content",attrs:{id:"app-navigation-vue","aria-hidden":t.open?"false":"true","aria-label":t.ariaLabel||void 0,"aria-labelledby":t.ariaLabelledby||void 0,inert:!t.open||void 0},on:{keydown:function(a){return!a.type.indexOf("key")&&t._k(a.keyCode,"esc",27,a.key,["Esc","Escape"])?null:t.handleEsc.apply(null,arguments)}}},[e("div",{staticClass:"app-navigation__search"},[t._t("search")],2),e("div",{staticClass:"app-navigation__body",class:{"app-navigation__body--no-list":!t.$scopedSlots.list}},[t._t("default")],2),t.$scopedSlots.list?e("NcAppNavigationList",{staticClass:"app-navigation__list"},[t._t("list")],2):t._e(),t._t("footer")],2),e("NcAppNavigationToggle",{attrs:{open:t.open},on:{"update:open":t.toggleNavigation}})],1)},qt=[],Jt=m(jt,Kt,qt,!1,null,"119f2aad");const Qt=Jt.exports,Xt=S({__name:"NcAppSettingsSection",props:{name:null,description:null,id:null,order:null},setup(t){const e=t,a=O(),{registerSection:c,unregisterSection:d}=st(),A=L(it),k=T(()=>"settings-section_"+e.id);return f(()=>e.id,()=>{/^[a-z0-9\-_]+$/.test(e.id)||b.warn("Invalid id prop: ".concat(e.id,". Only alphanumeric, dash and underscore are allowed."))},{immediate:!0}),f([()=>e.id,()=>e.name,()=>e.order],([n,w,I],[F,,])=>{var v;d(F),c(n,w,I,(v=a==null?void 0:a.icon)==null?void 0:v.call(a))}),z(()=>{var n;c(e.id,e.name,e.order,(n=a==null?void 0:a.icon)==null?void 0:n.call(a))}),x(()=>{d(e.id)}),{__sfc:!0,props:e,slots:a,registerSection:c,unregisterSection:d,legacy:A,htmlId:k}}});var Yt=function(){var t=this,e=t._self._c,a=t._self._setupProxy;return e("section",{staticClass:"app-settings-section",class:{"app-settings-section__legacy":a.legacy},attrs:{id:a.htmlId,"aria-labelledby":"".concat(a.htmlId,"--label")}},[e("h3",{staticClass:"app-settings-section__name",attrs:{id:"".concat(a.htmlId,"--label")}},[t._v(" "+t._s(t.name)+" ")]),e("div",{staticClass:"app-settings-section__description"},[t._v(" "+t._s(t.description)+" ")]),e("div",{staticClass:"app-settings-section__content"},[t._t("default")],2),t._e()],2)},Zt=[],te=m(Xt,Yt,Zt,!1,null,"06cd755d");const ee=te.exports,ae={name:"CroppedLayoutSettings",components:{NcCheckboxRadioSwitch:Vt},computed:{croppedLayout(){return this.$store.state.userConfig.croppedLayout}},methods:{updateSetting(t){this.$store.dispatch("updateUserConfig",{key:"croppedLayout",value:t})}}};var oe=function(){var t=this,e=t._self._c;return e("NcCheckboxRadioSwitch",{attrs:{"model-value":t.croppedLayout,type:"switch"},on:{"update:model-value":t.updateSetting}},[t._v(" "+t._s(t.t("photos","Enable squared photos view"))+" ")])},se=[],ie=l(ae,oe,se,!1,null,null);const ne=ie.exports,re=S({name:"PhotosUploadLocationSettings",components:{NcButton:C,PhotosFolder:B},data(){return{HomeOutline:lt}},computed:{photosLocation(){return this.$store.state.userConfig.photosLocation}},methods:{debounceSelectPhotosFolder:Ht(function(){this.selectPhotosFolder()}),async selectPhotosFolder(){const t=await this.openFilePicker(o("photos","Select the default upload location for your media"));this.updatePhotosFolder(t)},async openFilePicker(t){return $(t).setMultiSelect(!1).addMimeTypeFilter("httpd/unix-directory").allowDirectories().startAt(this.photosLocation).addButton({label:o("photos","Pick folder"),callback:e=>i.debug("Picked",{nodes:e})}).build().pick()},updatePhotosFolder(t){this.$store.dispatch("updateUserConfig",{key:"photosLocation",value:t})},t:o}});var pe=function(){var t=this,e=t._self._c;return t._self._setupProxy,e("div",{staticClass:"photos-location"},[e("PhotosFolder",{attrs:{path:t.photosLocation,"root-folder-label":t.t("photos","Home"),"root-folder-icon":t.HomeOutline}}),e("NcButton",{attrs:{"aria-label":t.t("photos","Choose default Photos upload and Albums location")},on:{click:t.debounceSelectPhotosFolder}},[t._v(" "+t._s(t.t("photos","Choose a different folder"))+" ")])],1)},le=[],ce=l(re,pe,le,!1,null,"2647e1a5");const de=ce.exports,ue={name:"SettingsDialog",components:{NcAppSettingsDialog:nt,NcAppSettingsSection:ee,CroppedLayoutSettings:ne,PhotosSourceLocationsSettings:V,PhotosUploadLocationSettings:de},props:{open:{type:Boolean,default:!1}},methods:{onClose(){this.$emit("update:open",!1)},t:o}};var he=function(){var t=this,e=t._self._c;return e("NcAppSettingsDialog",{attrs:{open:t.open,"show-navigation":!0,name:t.t("photos","Photos settings")},on:{"update:open":t.onClose}},[e("NcAppSettingsSection",{attrs:{id:"layout-settings",name:t.t("photos","View")}},[e("CroppedLayoutSettings")],1),e("NcAppSettingsSection",{attrs:{id:"source-directories-settings",name:t.t("photos","Media folders")}},[e("div",{staticClass:"setting-section-subline"},[t._v(" "+t._s(t.t("photos","Choose the folders from where photos and videos are shown."))+" ")]),e("PhotosSourceLocationsSettings")],1),e("NcAppSettingsSection",{attrs:{id:"upload-directory-settings",name:t.t("photos","Upload folder")}},[e("div",{staticClass:"setting-section-subline"},[t._v(" "+t._s(t.t("photos","Choose the folder where photos and albums are uploaded to."))+" ")]),e("PhotosUploadLocationSettings")],1)],1)},ge=[],me=l(ue,he,ge,!1,null,null);const ve=me.exports,N=g("photos","appStoreEnabled",!1),fe={name:"PhotosApp",components:{AccountBoxMultiple:Et,AccountBoxMultipleOutline:xt,CogOutline:zt,CalendarToday:Tt,CalendarTodayOutline:Lt,Camera:Ot,CameraOutline:Mt,AccountGroup:Pt,AccountGroupOutline:Ft,Folder:It,FolderOutline:wt,ImageMultiple:kt,ImageMultipleOutline:At,ImageIcon:Ct,ImageOutline:bt,ShareVariant:St,ShareVariantOutline:Nt,Star:_t,StarOutline:yt,Tag:ft,TagOutline:vt,VideoIcon:mt,VideoOutline:gt,MapIcon:ht,MapOutline:ut,MapMarker:dt,MapMarkerOutline:ct,NcAppContent:j,NcAppNavigation:Qt,NcAppNavigationItem:rt,NcButton:C,NcContent:G,SettingsDialog:ve,PhotosFiltersInput:$t,PhotosFiltersDisplay:Bt},setup(){const t=H(),{selectedFilters:e}=D(t);return{selectedFilters:e}},data(){return{svgplaceholder:Y,imgplaceholder:X,videoplaceholder:Q,areTagsInstalled:J,showLocationMenuEntry:r()===null?!1:r().isAdmin&&N||q,showPeopleMenuEntry:r()===null?!1:r().isAdmin&&g("photos","showPeopleMenuEntry",!0)&&N||K,openedSettings:!1}},computed:{isTimelineView(){return["all_media","photos","videos"].includes(this.$store.state.route.name||"")}},async beforeMount(){const t=g("photos","nomedia-paths",[]);this.$store.dispatch("setNomediaPaths",t),i.debug("Known .nomedia and .noimage  paths",{files:t}),"serviceWorker"in navigator?window.addEventListener("load",()=>{navigator.serviceWorker.register(h("/apps/photos/service-worker.js",{},{noRewrite:!0}),{scope:h("/apps/photos")}).then(e=>{i.debug("SW registered: ",{registration:e})}).catch(e=>{i.error("SW registration failed: ",{registrationError:e})})}):i.debug("Service Worker is not enabled on this browser.")},beforeDestroy(){window.removeEventListener("load",()=>{navigator.serviceWorker.register(h("/apps/photos/service-worker.js",{},{noRewrite:!0}))})},methods:{showSettings(){this.openedSettings=!0},selectFilter(t){this.selectedFilters[t.filterId].push(t.value)},deselectFilter(t){const e=this.selectedFilters[t.filterId].indexOf(t.value);e!==-1&&this.selectedFilters[t.filterId].splice(e,1)},t:o}};var ye=function(){var t=this,e=t._self._c;return e("NcContent",{attrs:{"app-name":"photos"}},[e("NcAppNavigation",{attrs:{"aria-label":t.t("photos","Photos")},scopedSlots:t._u([t.isTimelineView?{key:"search",fn:function(){return[e("PhotosFiltersInput",{attrs:{"selected-filters":t.selectedFilters},on:{"select-filter":t.selectFilter}}),e("PhotosFiltersDisplay",{attrs:{"selected-filters":t.selectedFilters},on:{"deselect-filter":t.deselectFilter}})]},proxy:!0}:null,{key:"list",fn:function(){return[e("NcAppNavigationItem",{staticClass:"app-navigation__all_media",attrs:{to:{name:"all_media"},name:t.t("photos","All media"),"data-id-app-nav-item":"all-media",exact:""},scopedSlots:t._u([{key:"icon",fn:function({active:a}){return[a?e("ImageIcon",{attrs:{size:20}}):e("ImageOutline",{attrs:{size:20}})]}}])}),e("NcAppNavigationItem",{attrs:{to:"/photos",name:t.t("photos","Photos"),"data-id-app-nav-item":"photos"},scopedSlots:t._u([{key:"icon",fn:function({active:a}){return[a?e("Camera",{attrs:{size:20}}):e("CameraOutline",{attrs:{size:20}})]}}])}),e("NcAppNavigationItem",{attrs:{to:"/videos",name:t.t("photos","Videos"),"data-id-app-nav-item":"videos"},scopedSlots:t._u([{key:"icon",fn:function({active:a}){return[a?e("VideoIcon",{attrs:{size:20}}):e("VideoOutline",{attrs:{size:20}})]}}])}),e("NcAppNavigationItem",{attrs:{to:{name:"albums"},name:t.t("photos","Albums"),"data-id-app-nav-item":"albums"},scopedSlots:t._u([{key:"icon",fn:function({active:a}){return[a?e("ImageMultiple",{attrs:{size:20}}):e("ImageMultipleOutline",{attrs:{size:20}})]}}])}),e("NcAppNavigationItem",{attrs:{to:{name:"sharedAlbums"},name:t.t("photos","Collaborative albums"),"data-id-app-nav-item":"sharedalbums"},scopedSlots:t._u([{key:"icon",fn:function({active:a}){return[a?e("AccountGroup",{attrs:{size:20}}):e("AccountGroupOutline",{attrs:{size:20}})]}}])}),t.showPeopleMenuEntry?e("NcAppNavigationItem",{attrs:{to:{name:"faces"},name:t.t("photos","People"),"data-id-app-nav-item":"faces"},scopedSlots:t._u([{key:"icon",fn:function({active:a}){return[a?e("AccountBoxMultiple",{attrs:{size:20}}):e("AccountBoxMultipleOutline",{attrs:{size:20}})]}}],null,!1,3295904880)}):t._e(),e("NcAppNavigationItem",{attrs:{to:{name:"folders"},name:t.t("photos","Folders"),"data-id-app-nav-item":"folders"},scopedSlots:t._u([{key:"icon",fn:function({active:a}){return[a?e("Folder",{attrs:{size:20}}):e("FolderOutline",{attrs:{size:20}})]}}])}),e("NcAppNavigationItem",{attrs:{to:"/favorites",name:t.t("photos","Favorites"),"data-id-app-nav-item":"favorites"},scopedSlots:t._u([{key:"icon",fn:function({active:a}){return[a?e("Star",{attrs:{size:20}}):e("StarOutline",{attrs:{size:20}})]}}])}),e("NcAppNavigationItem",{attrs:{to:{name:"thisday"},name:t.t("photos","On this day"),"data-id-app-nav-item":"this-day"},scopedSlots:t._u([{key:"icon",fn:function({active:a}){return[a?e("CalendarToday",{attrs:{size:20}}):e("CalendarTodayOutline",{attrs:{size:20}})]}}])}),e("NcAppNavigationItem",{attrs:{to:{name:"shared"},name:t.t("photos","Shared with you"),"data-id-app-nav-item":"shared"},scopedSlots:t._u([{key:"icon",fn:function({active:a}){return[a?e("ShareVariant",{attrs:{size:20}}):e("ShareVariantOutline",{attrs:{size:20}})]}}])}),t.areTagsInstalled?e("NcAppNavigationItem",{attrs:{to:{name:"tags"},name:t.t("photos","Tags"),"data-id-app-nav-item":"tags"},scopedSlots:t._u([{key:"icon",fn:function({active:a}){return[a?e("Tag",{attrs:{size:20}}):e("TagOutline",{attrs:{size:20}})]}}],null,!1,346180464)}):t._e(),e("NcAppNavigationItem",{attrs:{to:{name:"places"},name:t.t("photos","Places"),"data-id-app-nav-item":"places"},scopedSlots:t._u([{key:"icon",fn:function({active:a}){return[a?e("MapMarker",{attrs:{size:20}}):e("MapMarkerOutline",{attrs:{size:20}})]}}])}),t.showLocationMenuEntry?e("NcAppNavigationItem",{attrs:{to:{name:"maps"},name:t.t("photos","Map"),"data-id-app-nav-item":"maps"},scopedSlots:t._u([{key:"icon",fn:function({active:a}){return[a?e("MapIcon",{attrs:{size:20}}):e("MapOutline",{attrs:{size:20}})]}}],null,!1,257739259)}):t._e()]},proxy:!0},{key:"footer",fn:function(){return[e("div",{staticClass:"app-navigation__footer"},[e("NcButton",{attrs:{variant:"tertiary",alignment:"start",wide:""},on:{click:t.showSettings},scopedSlots:t._u([{key:"icon",fn:function(){return[e("CogOutline",{attrs:{size:20}})]},proxy:!0}])},[t._v(" "+t._s(t.t("photos","Photos settings"))+" ")])],1)]},proxy:!0}],null,!0)}),e("NcAppContent",[e("RouterView"),e("span",{staticClass:"hidden-visually",attrs:{role:"none"},domProps:{innerHTML:t._s(t.svgplaceholder)}}),e("span",{staticClass:"hidden-visually",attrs:{role:"none"},domProps:{innerHTML:t._s(t.imgplaceholder)}}),e("span",{staticClass:"hidden-visually",attrs:{role:"none"},domProps:{innerHTML:t._s(t.videoplaceholder)}})],1),e("SettingsDialog",{attrs:{open:t.openedSettings},on:{"update:open":function(a){t.openedSettings=a}}})],1)},_e=[],Ne=l(fe,ye,_e,!1,null,null);const Se=Ne.exports;Z.sync(_,y),s.prototype.t=o,s.prototype.n=E,p("nc:metadata-photos-size"),p("nc:metadata-files-live-photo"),p("nc:metadata-blurhash"),p("nc:metadata-photos-original_date_time"),s.use(W),new s({el:"#content",name:"PhotosRoot",router:y,store:_,pinia:R(),render:t=>t(Se)});
//# sourceMappingURL=photos-main.mjs.map

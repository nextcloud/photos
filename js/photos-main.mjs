import{V as l,G as f,u as x,v as P,d as S,a5 as M,y as O,e as B,w as y,z as T,a0 as z,a as r,C as N,_,s as u,i as L,k as m}from"./vue.runtime.esm-Y-1zM5FG.chunk.mjs";import{N as $,a as C,b as E,c as V,P as D,u as W,s as H,d as U,e as j}from"./filters-KTXCxfDk.chunk.mjs";import{a as G,N as R,b as K,d as q,m as J,e as Q,v as X,i as Y,s as Z,c as tt,r as b}from"./video-Bu4B9qGU.chunk.mjs";import{N as et,u as ot,A as at,a as st,b as it}from"./NcFormBoxSwitch-BmyNQCbA-E03pjeKd.chunk.mjs";import{e as h,a9 as nt,J as F,aa as rt,ab as lt,W as pt,F as ct,ac as dt,ad as ut,l as p,q as mt,p as k}from"./index-tCa5sXx0.chunk.mjs";import{u as ht}from"./useHotKey-f0bTPqDk.chunk.mjs";import{n as g,u as gt,H as vt,M as ft,v as _t,w as yt,x as Nt,V as St,y as bt,T as kt,z as wt,S as At,a as Ct,b as Ft,B as It,l as xt,G as Pt,I as Mt,J as Ot,K as Bt,L as Tt,N as zt,O as Lt,Q as $t,R as Et,U as Vt,W as Dt,X as Wt,h as Ht,Y as Ut}from"./icons-DCeqHGx9.chunk.mjs";import{P as jt,a as Gt}from"./PhotosFiltersInput-DzvE4fcQ.chunk.mjs";import{c as Rt}from"./createElementId-DhjFt1I9-B2HCdIOx.chunk.mjs";import{g as Kt}from"./index-D9sA044l.chunk.mjs";import{d as qt}from"./index-DEH-_w5A.chunk.mjs";import"./NcFormBoxButton-C6EvdLK4-B6znKLdQ.chunk.mjs";import"./index-BVMPBczj.chunk.mjs";import"./preload-helper-DxYC2qmj.chunk.mjs";import"./NcSelect-DTniMiUS-fbH4DTl8.chunk.mjs";import"./useModelMigration-EhAWvqDD-DzxBudUx.chunk.mjs";import"./NcAvatar-D5nljVEA-BCH1d86J.chunk.mjs";import"./NcActionButton-DykQxmXJ-CHMmWVBd.chunk.mjs";import"./NcDialog-DDuqQeT--BubrW9iJ.chunk.mjs";import"./dialog-BAwqHAhC.chunk.mjs";import"./NcDateTimePicker-DfuwQtxj.chunk.mjs";import"./useFormatDateTime-CNeNRpCg.chunk.mjs";import"./NcDateTime-enXYuwj8-gTZD7HQn.chunk.mjs";import"./collectionFetcher-CzCBTFAx.chunk.mjs";const Jt={name:"NcAppNavigationList"};var Qt=function(){var t=this,e=t._self._c;return e("ul",{staticClass:"app-navigation-list"},[t._t("default")],2)},Xt=[],Yt=h(Jt,Qt,Xt,!1,null,"058e6060");const Zt=Yt.exports,te={name:"NcAppNavigation",components:{NcAppNavigationList:Zt,NcAppNavigationToggle:et},inject:{setHasAppNavigation:{default:()=>()=>l.util.warn("NcAppNavigation is not mounted inside NcContent, this is probably an error."),from:"NcContent:setHasAppNavigation"}},props:{ariaLabel:{type:String,default:""},ariaLabelledby:{type:String,default:""}},setup(){return{isMobile:G()}},data(){return{open:!this.isMobile,focusTrap:null}},watch:{isMobile(){this.open=!this.isMobile,this.toggleFocusTrap()},open(){this.toggleFocusTrap()}},mounted(){this.setHasAppNavigation(!0),P("toggle-navigation",this.toggleNavigationByEventBus),f("navigation-toggled",{open:this.open}),this.focusTrap=rt(this.$refs.appNavigationContainer,{allowOutsideClick:!0,fallbackFocus:this.$refs.appNavigationContainer,trapStack:lt(),escapeDeactivates:!1}),this.toggleFocusTrap(),ht("n",this.onKeyDown,{prevent:!0,stop:!0})},unmounted(){this.setHasAppNavigation(!1),x("toggle-navigation",this.toggleNavigationByEventBus),this.focusTrap.deactivate()},methods:{async toggleNavigation(t){if(this.open===t){f("navigation-toggled",{open:this.open});return}this.open=typeof t>"u"?!this.open:t;const e=getComputedStyle(document.body),o=parseInt(e.getPropertyValue("--animation-quick"))||100;this.open&&(await this.$nextTick(),this.focusFirstElement()),setTimeout(()=>{f("navigation-toggled",{open:this.open})},1.5*o)},toggleNavigationByEventBus({open:t}){this.toggleNavigation(t)},toggleFocusTrap(){this.isMobile&&this.open?this.focusTrap.activate():this.focusTrap.deactivate()},handleEsc(){this.isMobile&&this.open&&this.toggleNavigation(!1)},focusFirstElement(){const t=nt(this.$refs.appNavigationContainer)[0];t&&(t.focus(),F.debug("Focusing first element in the navigation",{element:t}))},onKeyDown(t){if(t.key==="n"){if(!this.open){this.toggleNavigation(!0);return}this.isFocusWithinNavigation()&&this.toggleNavigation(!1)}},isFocusWithinNavigation(){const t=document.activeElement;return this.$refs.appNavigationContainer?.contains(t)}}};var ee=function(){var t=this,e=t._self._c;return e("div",{ref:"appNavigationContainer",staticClass:"app-navigation",class:{"app-navigation--close":!t.open}},[e("nav",{staticClass:"app-navigation__content",attrs:{id:"app-navigation-vue","aria-hidden":t.open?"false":"true","aria-label":t.ariaLabel||void 0,"aria-labelledby":t.ariaLabelledby||void 0,inert:!t.open||void 0},on:{keydown:function(o){return!o.type.indexOf("key")&&t._k(o.keyCode,"esc",27,o.key,["Esc","Escape"])?null:t.handleEsc.apply(null,arguments)}}},[e("div",{staticClass:"app-navigation__search"},[t._t("search")],2),e("div",{staticClass:"app-navigation__body",class:{"app-navigation__body--no-list":!t.$scopedSlots.list}},[t._t("default")],2),t.$scopedSlots.list?e("NcAppNavigationList",{staticClass:"app-navigation__list"},[t._t("list")],2):t._e(),t._t("footer")],2),e("NcAppNavigationToggle",{attrs:{open:t.open},on:{"update:open":t.toggleNavigation}})],1)},oe=[],ae=h(te,ee,oe,!1,null,"cdba9e96");const se=ae.exports,ie=S({__name:"NcAppSettingsSection",props:{name:null,description:null,id:null,order:null},setup(t){const e=t,o=M(),{registerSection:a,unregisterSection:s}=ot(),i=O(at),c=B(()=>"settings-section_"+e.id);return y(()=>e.id,()=>{/^[a-z0-9\-_]+$/.test(e.id)||F.warn(`Invalid id prop: ${e.id}. Only alphanumeric, dash and underscore are allowed.`)},{immediate:!0}),y([()=>e.id,()=>e.name,()=>e.order],([v,d,n],[I,,])=>{s(I),a(v,d,n,o?.icon?.())}),T(()=>{a(e.id,e.name,e.order,o?.icon?.())}),z(()=>{s(e.id)}),{__sfc:!0,props:e,slots:o,registerSection:a,unregisterSection:s,legacy:i,htmlId:c}}});var ne=function(){var t=this,e=t._self._c,o=t._self._setupProxy;return e("section",{staticClass:"app-settings-section",class:{"app-settings-section__legacy":o.legacy},attrs:{id:o.htmlId,"aria-labelledby":`${o.htmlId}--label`}},[e("h3",{staticClass:"app-settings-section__name",attrs:{id:`${o.htmlId}--label`}},[t._v(" "+t._s(t.name)+" ")]),e("div",{staticClass:"app-settings-section__description"},[t._v(" "+t._s(t.description)+" ")]),e("div",{staticClass:"app-settings-section__content"},[t._t("default")],2),t._e()],2)},re=[],le=h(ie,ne,re,!1,null,"06cd755d");const pe=le.exports,ce={model:{prop:"modelValue",event:"update:modelValue"}},de=S({...ce,__name:"NcFormBoxSwitch",props:{label:{default:void 0},description:{default:void 0},disabled:{type:Boolean,default:!1},modelValue:{type:Boolean}},emits:["enable","disable","update:modelValue"],setup(t,{emit:e}){const o=t,a=pt(o,"modelValue",e),s=Rt();return y(a,()=>{a.value?e("enable"):e("disable")},{flush:"sync"}),{__sfc:!0,props:o,emit:e,model:a,inputId:s,mdiToggleSwitch:ut,mdiToggleSwitchOff:dt,NcFormBoxItem:$,NcIconSvgWrapper:ct}}}),ue="_formBoxSwitch__input_hjv1a_20",me="_formBoxSwitch__icon_hjv1a_34",he={"material-design-icon":"_material-design-icon_hjv1a_12",formBoxSwitch__input:ue,formBoxSwitch__icon:me};var ge=function(){var t=this,e=t._self._c,o=t._self._setupProxy;return e(o.NcFormBoxItem,{attrs:{tag:"label",for:o.inputId},scopedSlots:t._u([t.$slots.default||t.label?{key:"default",fn:function(){return[t._t("default",function(){return[t._v(" "+t._s(t.label)+" ")]})]},proxy:!0}:null,t.$slots.description||t.description?{key:"description",fn:function(){return[t._t("description",function(){return[t._v(" "+t._s(t.description)+" ")]})]},proxy:!0}:null,{key:"icon",fn:function({descriptionId:a}){return[e("input",{directives:[{name:"model",rawName:"v-model",value:o.model,expression:"model"}],class:t.$style.formBoxSwitch__input,attrs:{id:o.inputId,type:"checkbox",role:"switch","aria-describedby":a,disabled:t.disabled},domProps:{checked:Array.isArray(o.model)?t._i(o.model,null)>-1:o.model},on:{change:function(s){var i=o.model,c=s.target,v=!!c.checked;if(Array.isArray(i)){var d=null,n=t._i(i,d);c.checked?n<0&&(o.model=i.concat([d])):n>-1&&(o.model=i.slice(0,n).concat(i.slice(n+1)))}else o.model=v}}}),e(o.NcIconSvgWrapper,{class:t.$style.formBoxSwitch__icon,attrs:{path:o.model?o.mdiToggleSwitch:o.mdiToggleSwitchOff,size:34,inline:""}})]}}],null,!0)})},ve=[];const w={$style:he};function fe(t){for(var e in w)this[e]=w[e]}var _e=h(de,ge,ve,!1,fe,null);const ye=_e.exports,Ne={name:"CroppedLayoutSettings",components:{NcFormBoxSwitch:ye,NcFormBox:C},computed:{croppedLayout(){return this.$store.state.userConfig.croppedLayout}},methods:{updateSetting(t){this.$store.dispatch("updateUserConfig",{key:"croppedLayout",value:t})}}};var Se=function(){var t=this,e=t._self._c;return e("NcFormBox",[e("NcFormBoxSwitch",{attrs:{"model-value":t.croppedLayout,label:t.t("photos","Enable squared photos view")},on:{"update:modelValue":t.updateSetting}})],1)},be=[],ke=g(Ne,Se,be,!1,null,null);const we=ke.exports,Ae=S({name:"PhotosUploadLocationSettings",components:{NcFormBox:C,NcFormBoxButton:V,PhotosFolder:E,FolderEditOutline:gt},data(){return{HomeOutline:vt}},computed:{photosLocation(){return this.$store.state.userConfig.photosLocation}},methods:{debounceSelectPhotosFolder:qt(function(){this.selectPhotosFolder()}),async selectPhotosFolder(){const t=await this.openFilePicker(r("photos","Select the default upload location for your media"));this.updatePhotosFolder(t)},async openFilePicker(t){return Kt(t).setMultiSelect(!1).addMimeTypeFilter("httpd/unix-directory").allowDirectories().startAt(this.photosLocation).addButton({label:r("photos","Pick folder"),callback:e=>p.debug("Picked",{nodes:e})}).build().pick()},updatePhotosFolder(t){this.$store.dispatch("updateUserConfig",{key:"photosLocation",value:t})},t:r}});var Ce=function(){var t=this,e=t._self._c;return t._self._setupProxy,e("div",{staticClass:"photos-location"},[e("PhotosFolder",{attrs:{path:t.photosLocation,"root-folder-label":t.t("photos","Home"),"root-folder-icon":t.HomeOutline}}),e("NcFormBox",[e("NcFormBoxButton",{attrs:{"aria-label":t.t("photos","Choose default Photos upload and Albums location")},on:{click:t.debounceSelectPhotosFolder},scopedSlots:t._u([{key:"icon",fn:function(){return[e("FolderEditOutline",{attrs:{size:20}})]},proxy:!0}])},[t._v(" "+t._s(t.t("photos","Choose a different folder"))+" ")])],1)],1)},Fe=[],Ie=g(Ae,Ce,Fe,!1,null,"efac653f");const xe=Ie.exports,Pe={name:"SettingsDialog",components:{NcAppSettingsDialog:st,NcAppSettingsSection:pe,CroppedLayoutSettings:we,PhotosSourceLocationsSettings:D,PhotosUploadLocationSettings:xe},props:{open:{type:Boolean,default:!1}},methods:{onClose(){this.$emit("update:open",!1)},t:r}};var Me=function(){var t=this,e=t._self._c;return e("NcAppSettingsDialog",{attrs:{open:t.open,"show-navigation":!0,name:t.t("photos","Photos settings"),legacy:!1},on:{"update:open":t.onClose}},[e("NcAppSettingsSection",{attrs:{id:"layout-settings",name:t.t("photos","View")}},[e("CroppedLayoutSettings")],1),e("NcAppSettingsSection",{attrs:{id:"source-directories-settings",name:t.t("photos","Media folders")}},[e("div",{staticClass:"setting-section-subline"},[t._v(" "+t._s(t.t("photos","Choose the folders from where photos and videos are shown."))+" ")]),e("PhotosSourceLocationsSettings")],1),e("NcAppSettingsSection",{attrs:{id:"upload-directory-settings",name:t.t("photos","Upload folder")}},[e("div",{staticClass:"setting-section-subline"},[t._v(" "+t._s(t.t("photos","Choose the folder where photos and albums are uploaded to."))+" ")]),e("PhotosUploadLocationSettings")],1)],1)},Oe=[],Be=g(Pe,Me,Oe,!1,null,null);const Te=Be.exports,A=N("photos","appStoreEnabled",!1),ze={name:"PhotosApp",components:{AccountBoxMultiple:Ut,AccountBoxMultipleOutline:Ht,CogOutline:Wt,CalendarToday:Dt,CalendarTodayOutline:Vt,Camera:Et,CameraOutline:$t,AccountGroup:Lt,AccountGroupOutline:zt,Folder:Tt,FolderOutline:Bt,ImageMultiple:Ot,ImageMultipleOutline:Mt,ImageIcon:Pt,ImageOutline:xt,ShareVariant:It,ShareVariantOutline:Ft,Star:Ct,StarOutline:At,Tag:wt,TagOutline:kt,VideoIcon:bt,VideoOutline:St,MapIcon:Nt,MapOutline:yt,MapMarker:_t,MapMarkerOutline:ft,NcAppContent:K,NcAppNavigation:se,NcAppNavigationItem:it,NcButton:mt,NcContent:R,SettingsDialog:Te,PhotosFiltersInput:Gt,PhotosFiltersDisplay:jt},setup(){const t=W(),{selectedFilters:e}=H(t);return{selectedFilters:e}},data(){return{svgplaceholder:Z,imgplaceholder:Y,videoplaceholder:X,areTagsInstalled:Q,showLocationMenuEntry:u()===null?!1:u().isAdmin&&A||J,showPeopleMenuEntry:u()===null?!1:u().isAdmin&&N("photos","showPeopleMenuEntry",!0)&&A||q,openedSettings:!1}},computed:{isTimelineView(){return["all_media","photos","videos"].includes(this.$store.state.route.name||"")}},async beforeMount(){const t=N("photos","nomedia-paths",[]);this.$store.dispatch("setNomediaPaths",t),p.debug("Known .nomedia and .noimage  paths",{files:t}),"serviceWorker"in navigator?window.addEventListener("load",()=>{navigator.serviceWorker.register(_("/apps/photos/service-worker.js",{},{noRewrite:!0}),{scope:_("/apps/photos")}).then(e=>{p.debug("SW registered: ",{registration:e})}).catch(e=>{p.error("SW registration failed: ",{registrationError:e})})}):p.debug("Service Worker is not enabled on this browser.")},beforeDestroy(){window.removeEventListener("load",()=>{navigator.serviceWorker.register(_("/apps/photos/service-worker.js",{},{noRewrite:!0}))})},methods:{showSettings(){this.openedSettings=!0},selectFilter(t){this.selectedFilters[t.filterId].push(t.value)},deselectFilter(t){const e=this.selectedFilters[t.filterId].indexOf(t.value);e!==-1&&this.selectedFilters[t.filterId].splice(e,1)},t:r}};var Le=function(){var t=this,e=t._self._c;return e("NcContent",{attrs:{"app-name":"photos"}},[e("NcAppNavigation",{attrs:{"aria-label":t.t("photos","Photos")},scopedSlots:t._u([t.isTimelineView?{key:"search",fn:function(){return[e("PhotosFiltersInput",{attrs:{"selected-filters":t.selectedFilters},on:{"select-filter":t.selectFilter}}),e("PhotosFiltersDisplay",{attrs:{"selected-filters":t.selectedFilters},on:{"deselect-filter":t.deselectFilter}})]},proxy:!0}:null,{key:"list",fn:function(){return[e("NcAppNavigationItem",{staticClass:"app-navigation__all_media",attrs:{to:{name:"all_media"},name:t.t("photos","All media"),"data-id-app-nav-item":"all-media",exact:""},scopedSlots:t._u([{key:"icon",fn:function({active:o}){return[o?e("ImageIcon",{attrs:{size:20}}):e("ImageOutline",{attrs:{size:20}})]}}])}),e("NcAppNavigationItem",{attrs:{to:"/photos",name:t.t("photos","Photos"),"data-id-app-nav-item":"photos"},scopedSlots:t._u([{key:"icon",fn:function({active:o}){return[o?e("Camera",{attrs:{size:20}}):e("CameraOutline",{attrs:{size:20}})]}}])}),e("NcAppNavigationItem",{attrs:{to:"/videos",name:t.t("photos","Videos"),"data-id-app-nav-item":"videos"},scopedSlots:t._u([{key:"icon",fn:function({active:o}){return[o?e("VideoIcon",{attrs:{size:20}}):e("VideoOutline",{attrs:{size:20}})]}}])}),e("NcAppNavigationItem",{attrs:{to:{name:"albums"},name:t.t("photos","Albums"),"data-id-app-nav-item":"albums"},scopedSlots:t._u([{key:"icon",fn:function({active:o}){return[o?e("ImageMultiple",{attrs:{size:20}}):e("ImageMultipleOutline",{attrs:{size:20}})]}}])}),e("NcAppNavigationItem",{attrs:{to:{name:"sharedAlbums"},name:t.t("photos","Collaborative albums"),"data-id-app-nav-item":"sharedalbums"},scopedSlots:t._u([{key:"icon",fn:function({active:o}){return[o?e("AccountGroup",{attrs:{size:20}}):e("AccountGroupOutline",{attrs:{size:20}})]}}])}),t.showPeopleMenuEntry?e("NcAppNavigationItem",{attrs:{to:{name:"faces"},name:t.t("photos","People"),"data-id-app-nav-item":"faces"},scopedSlots:t._u([{key:"icon",fn:function({active:o}){return[o?e("AccountBoxMultiple",{attrs:{size:20}}):e("AccountBoxMultipleOutline",{attrs:{size:20}})]}}],null,!1,3295904880)}):t._e(),e("NcAppNavigationItem",{attrs:{to:{name:"folders"},name:t.t("photos","Folders"),"data-id-app-nav-item":"folders"},scopedSlots:t._u([{key:"icon",fn:function({active:o}){return[o?e("Folder",{attrs:{size:20}}):e("FolderOutline",{attrs:{size:20}})]}}])}),e("NcAppNavigationItem",{attrs:{to:"/favorites",name:t.t("photos","Favorites"),"data-id-app-nav-item":"favorites"},scopedSlots:t._u([{key:"icon",fn:function({active:o}){return[o?e("Star",{attrs:{size:20}}):e("StarOutline",{attrs:{size:20}})]}}])}),e("NcAppNavigationItem",{attrs:{to:{name:"thisday"},name:t.t("photos","On this day"),"data-id-app-nav-item":"this-day"},scopedSlots:t._u([{key:"icon",fn:function({active:o}){return[o?e("CalendarToday",{attrs:{size:20}}):e("CalendarTodayOutline",{attrs:{size:20}})]}}])}),e("NcAppNavigationItem",{attrs:{to:{name:"shared"},name:t.t("photos","Shared with you"),"data-id-app-nav-item":"shared"},scopedSlots:t._u([{key:"icon",fn:function({active:o}){return[o?e("ShareVariant",{attrs:{size:20}}):e("ShareVariantOutline",{attrs:{size:20}})]}}])}),t.areTagsInstalled?e("NcAppNavigationItem",{attrs:{to:{name:"tags"},name:t.t("photos","Tags"),"data-id-app-nav-item":"tags"},scopedSlots:t._u([{key:"icon",fn:function({active:o}){return[o?e("Tag",{attrs:{size:20}}):e("TagOutline",{attrs:{size:20}})]}}],null,!1,346180464)}):t._e(),e("NcAppNavigationItem",{attrs:{to:{name:"places"},name:t.t("photos","Places"),"data-id-app-nav-item":"places"},scopedSlots:t._u([{key:"icon",fn:function({active:o}){return[o?e("MapMarker",{attrs:{size:20}}):e("MapMarkerOutline",{attrs:{size:20}})]}}])}),t.showLocationMenuEntry?e("NcAppNavigationItem",{attrs:{to:{name:"maps"},name:t.t("photos","Map"),"data-id-app-nav-item":"maps"},scopedSlots:t._u([{key:"icon",fn:function({active:o}){return[o?e("MapIcon",{attrs:{size:20}}):e("MapOutline",{attrs:{size:20}})]}}],null,!1,257739259)}):t._e()]},proxy:!0},{key:"footer",fn:function(){return[e("div",{staticClass:"app-navigation__footer"},[e("NcButton",{attrs:{variant:"tertiary",alignment:"start",wide:""},on:{click:t.showSettings},scopedSlots:t._u([{key:"icon",fn:function(){return[e("CogOutline",{attrs:{size:20}})]},proxy:!0}])},[t._v(" "+t._s(t.t("photos","Photos settings"))+" ")])],1)]},proxy:!0}],null,!0)}),e("NcAppContent",[e("RouterView"),e("span",{staticClass:"hidden-visually",attrs:{role:"none"},domProps:{innerHTML:t._s(t.svgplaceholder)}}),e("span",{staticClass:"hidden-visually",attrs:{role:"none"},domProps:{innerHTML:t._s(t.imgplaceholder)}}),e("span",{staticClass:"hidden-visually",attrs:{role:"none"},domProps:{innerHTML:t._s(t.videoplaceholder)}})],1),e("SettingsDialog",{attrs:{open:t.openedSettings},on:{"update:open":function(o){t.openedSettings=o}}})],1)},$e=[],Ee=g(ze,Le,$e,!1,null,null);const Ve=Ee.exports;tt.sync(k,b),l.prototype.t=r,l.prototype.n=L,m("nc:metadata-photos-size"),m("nc:metadata-files-live-photo"),m("nc:metadata-blurhash"),m("nc:metadata-photos-original_date_time"),l.use(U),new l({el:"#content",name:"PhotosRoot",router:b,store:k,pinia:j(),render:t=>t(Ve)});
//# sourceMappingURL=photos-main.mjs.map

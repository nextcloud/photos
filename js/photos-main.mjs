import{V as s,U as d,u as P,s as F,d as _,a4 as M,z as O,e as L,P as m,A as z,H as T,a as o,k as u,q as n,i as x,j as r}from"./vue.runtime.esm-BXvG6LpI.chunk.mjs";import{a as E,P as $,u as B,s as V,b as D,c as H}from"./filters-jthXMQxi.chunk.mjs";import{a as W,N as U,b as R,e as G,m as j,f as K,v as q,i as J,s as Q,c as X,r as v}from"./video-BXb3J_ov.chunk.mjs";import{n as g,ab as Y,J as N,ac as Z,ad as tt,k as S,l as i,D as h,p as f}from"./index-DYMFnNke.chunk.mjs";import{N as et,u as at,A as ot,a as st,b as it}from"./NcAppSettingsSection-Yg4NYCih-KMyWTMrv.chunk.mjs";import{u as nt}from"./useHotKey-BPOlV9lE.chunk.mjs";import{n as p,H as rt,M as pt,x as lt,y as ct,z as dt,V as ut,B as ht,T as gt,G as mt,S as vt,a as ft,b as yt,J as _t,l as Nt,K as St,I as bt,L as Ct,u as At,N as kt,r as wt,O as It,Q as Pt,R as Ft,U as Mt,W as Ot,X as Lt,h as zt,Y as Tt}from"./icons-BoPzhPJ9.chunk.mjs";import{P as xt,a as Et}from"./PhotosFiltersInput-Ce1rYTEU.chunk.mjs";import{N as $t}from"./NcCheckboxRadioSwitch-BF1M0HBu-BLuX0CUC.chunk.mjs";import{g as Bt}from"./index-BugWYp1e.chunk.mjs";import{d as Vt}from"./index-DsdaSfKX.chunk.mjs";import"./index-lTlKQ0F5.chunk.mjs";import"./preload-helper-Dh9HmuEY.chunk.mjs";import"./NcSelect-B-X6xD0o-BLz9a2Lz.chunk.mjs";import"./NcAvatar-sR6y5B6f-CeUUcGkp.chunk.mjs";import"./NcActionButton-1gSJfFUC-Bkqpynuc.chunk.mjs";import"./useModelMigration-EhAWvqDD-KN1-JmAp.chunk.mjs";import"./NcVNodes-CZY_0ebk.chunk.mjs";import"./NcDialog-xD1P4AFd-ClgZMDQN.chunk.mjs";import"./dialog-C7fnOJva.chunk.mjs";import"./NcDateTimePicker-D_GyWiXR.chunk.mjs";import"./useFormatDateTime-DmRTKkoP.chunk.mjs";import"./createElementId-DhjFt1I9-B2HCdIOx.chunk.mjs";import"./NcDateTime-enXYuwj8-_olnb_tR.chunk.mjs";import"./collectionFetcher-BK5tftpz.chunk.mjs";const Dt={name:"NcAppNavigationList"};var Ht=function(){var t=this,e=t._self._c;return e("ul",{staticClass:"app-navigation-list"},[t._t("default")],2)},Wt=[],Ut=g(Dt,Ht,Wt,!1,null,"058e6060");const Rt=Ut.exports,Gt={name:"NcAppNavigation",components:{NcAppNavigationList:Rt,NcAppNavigationToggle:et},inject:{setHasAppNavigation:{default:()=>()=>s.util.warn("NcAppNavigation is not mounted inside NcContent, this is probably an error."),from:"NcContent:setHasAppNavigation"}},props:{ariaLabel:{type:String,default:""},ariaLabelledby:{type:String,default:""}},setup(){return{isMobile:W()}},data(){return{open:!this.isMobile,focusTrap:null}},watch:{isMobile(){this.open=!this.isMobile,this.toggleFocusTrap()},open(){this.toggleFocusTrap()}},mounted(){this.setHasAppNavigation(!0),F("toggle-navigation",this.toggleNavigationByEventBus),d("navigation-toggled",{open:this.open}),this.focusTrap=Z(this.$refs.appNavigationContainer,{allowOutsideClick:!0,fallbackFocus:this.$refs.appNavigationContainer,trapStack:tt(),escapeDeactivates:!1}),this.toggleFocusTrap(),nt("n",this.onKeyDown,{prevent:!0,stop:!0})},unmounted(){this.setHasAppNavigation(!1),P("toggle-navigation",this.toggleNavigationByEventBus),this.focusTrap.deactivate()},methods:{async toggleNavigation(t){if(this.open===t){d("navigation-toggled",{open:this.open});return}this.open=typeof t>"u"?!this.open:t;const e=getComputedStyle(document.body),a=parseInt(e.getPropertyValue("--animation-quick"))||100;this.open&&(await this.$nextTick(),this.focusFirstElement()),setTimeout(()=>{d("navigation-toggled",{open:this.open})},1.5*a)},toggleNavigationByEventBus({open:t}){this.toggleNavigation(t)},toggleFocusTrap(){this.isMobile&&this.open?this.focusTrap.activate():this.focusTrap.deactivate()},handleEsc(){this.isMobile&&this.open&&this.toggleNavigation(!1)},focusFirstElement(){const t=Y(this.$refs.appNavigationContainer)[0];t&&(t.focus(),N.debug("Focusing first element in the navigation",{element:t}))},onKeyDown(t){if(t.key==="n"){if(!this.open){this.toggleNavigation(!0);return}this.isFocusWithinNavigation()&&this.toggleNavigation(!1)}},isFocusWithinNavigation(){const t=document.activeElement;return this.$refs.appNavigationContainer?.contains(t)}}};var jt=function(){var t=this,e=t._self._c;return e("div",{ref:"appNavigationContainer",staticClass:"app-navigation",class:{"app-navigation--close":!t.open}},[e("nav",{staticClass:"app-navigation__content",attrs:{id:"app-navigation-vue","aria-hidden":t.open?"false":"true","aria-label":t.ariaLabel||void 0,"aria-labelledby":t.ariaLabelledby||void 0,inert:!t.open||void 0},on:{keydown:function(a){return!a.type.indexOf("key")&&t._k(a.keyCode,"esc",27,a.key,["Esc","Escape"])?null:t.handleEsc.apply(null,arguments)}}},[e("div",{staticClass:"app-navigation__search"},[t._t("search")],2),e("div",{staticClass:"app-navigation__body",class:{"app-navigation__body--no-list":!t.$scopedSlots.list}},[t._t("default")],2),t.$scopedSlots.list?e("NcAppNavigationList",{staticClass:"app-navigation__list"},[t._t("list")],2):t._e(),t._t("footer")],2),e("NcAppNavigationToggle",{attrs:{open:t.open},on:{"update:open":t.toggleNavigation}})],1)},Kt=[],qt=g(Gt,jt,Kt,!1,null,"119f2aad");const Jt=qt.exports,Qt=_({__name:"NcAppSettingsSection",props:{name:null,description:null,id:null,order:null},setup(t){const e=t,a=M(),{registerSection:l,unregisterSection:c}=at(),b=O(ot),C=L(()=>"settings-section_"+e.id);return m(()=>e.id,()=>{/^[a-z0-9\-_]+$/.test(e.id)||N.warn(`Invalid id prop: ${e.id}. Only alphanumeric, dash and underscore are allowed.`)},{immediate:!0}),m([()=>e.id,()=>e.name,()=>e.order],([A,k,w],[I,,])=>{c(I),l(A,k,w,a?.icon?.())}),z(()=>{l(e.id,e.name,e.order,a?.icon?.())}),T(()=>{c(e.id)}),{__sfc:!0,props:e,slots:a,registerSection:l,unregisterSection:c,legacy:b,htmlId:C}}});var Xt=function(){var t=this,e=t._self._c,a=t._self._setupProxy;return e("section",{staticClass:"app-settings-section",class:{"app-settings-section__legacy":a.legacy},attrs:{id:a.htmlId,"aria-labelledby":`${a.htmlId}--label`}},[e("h3",{staticClass:"app-settings-section__name",attrs:{id:`${a.htmlId}--label`}},[t._v(" "+t._s(t.name)+" ")]),e("div",{staticClass:"app-settings-section__description"},[t._v(" "+t._s(t.description)+" ")]),e("div",{staticClass:"app-settings-section__content"},[t._t("default")],2),t._e()],2)},Yt=[],Zt=g(Qt,Xt,Yt,!1,null,"06cd755d");const te=Zt.exports,ee={name:"CroppedLayoutSettings",components:{NcCheckboxRadioSwitch:$t},computed:{croppedLayout(){return this.$store.state.userConfig.croppedLayout}},methods:{updateSetting(t){this.$store.dispatch("updateUserConfig",{key:"croppedLayout",value:t})}}};var ae=function(){var t=this,e=t._self._c;return e("NcCheckboxRadioSwitch",{attrs:{"model-value":t.croppedLayout,type:"switch"},on:{"update:model-value":t.updateSetting}},[t._v(" "+t._s(t.t("photos","Enable squared photos view"))+" ")])},oe=[],se=p(ee,ae,oe,!1,null,null);const ie=se.exports,ne=_({name:"PhotosUploadLocationSettings",components:{NcButton:S,PhotosFolder:E},data(){return{HomeOutline:rt}},computed:{photosLocation(){return this.$store.state.userConfig.photosLocation}},methods:{debounceSelectPhotosFolder:Vt(function(){this.selectPhotosFolder()}),async selectPhotosFolder(){const t=await this.openFilePicker(o("photos","Select the default upload location for your media"));this.updatePhotosFolder(t)},async openFilePicker(t){return Bt(t).setMultiSelect(!1).addMimeTypeFilter("httpd/unix-directory").allowDirectories().startAt(this.photosLocation).addButton({label:o("photos","Pick folder"),callback:e=>i.debug("Picked",{nodes:e})}).build().pick()},updatePhotosFolder(t){this.$store.dispatch("updateUserConfig",{key:"photosLocation",value:t})},t:o}});var re=function(){var t=this,e=t._self._c;return t._self._setupProxy,e("div",{staticClass:"photos-location"},[e("PhotosFolder",{attrs:{path:t.photosLocation,"root-folder-label":t.t("photos","Home"),"root-folder-icon":t.HomeOutline}}),e("NcButton",{attrs:{"aria-label":t.t("photos","Choose default Photos upload and Albums location")},on:{click:t.debounceSelectPhotosFolder}},[t._v(" "+t._s(t.t("photos","Choose a different folder"))+" ")])],1)},pe=[],le=p(ne,re,pe,!1,null,"2647e1a5");const ce=le.exports,de={name:"SettingsDialog",components:{NcAppSettingsDialog:st,NcAppSettingsSection:te,CroppedLayoutSettings:ie,PhotosSourceLocationsSettings:$,PhotosUploadLocationSettings:ce},props:{open:{type:Boolean,default:!1}},methods:{onClose(){this.$emit("update:open",!1)},t:o}};var ue=function(){var t=this,e=t._self._c;return e("NcAppSettingsDialog",{attrs:{open:t.open,"show-navigation":!0,name:t.t("photos","Photos settings")},on:{"update:open":t.onClose}},[e("NcAppSettingsSection",{attrs:{id:"layout-settings",name:t.t("photos","View")}},[e("CroppedLayoutSettings")],1),e("NcAppSettingsSection",{attrs:{id:"source-directories-settings",name:t.t("photos","Media folders")}},[e("div",{staticClass:"setting-section-subline"},[t._v(" "+t._s(t.t("photos","Choose the folders from where photos and videos are shown."))+" ")]),e("PhotosSourceLocationsSettings")],1),e("NcAppSettingsSection",{attrs:{id:"upload-directory-settings",name:t.t("photos","Upload folder")}},[e("div",{staticClass:"setting-section-subline"},[t._v(" "+t._s(t.t("photos","Choose the folder where photos and albums are uploaded to."))+" ")]),e("PhotosUploadLocationSettings")],1)],1)},he=[],ge=p(de,ue,he,!1,null,null);const me=ge.exports,y=h("photos","appStoreEnabled",!1),ve={name:"PhotosApp",components:{AccountBoxMultiple:Tt,AccountBoxMultipleOutline:zt,CogOutline:Lt,CalendarToday:Ot,CalendarTodayOutline:Mt,Camera:Ft,CameraOutline:Pt,AccountGroup:It,AccountGroupOutline:wt,Folder:kt,FolderOutline:At,ImageMultiple:Ct,ImageMultipleOutline:bt,ImageIcon:St,ImageOutline:Nt,ShareVariant:_t,ShareVariantOutline:yt,Star:ft,StarOutline:vt,Tag:mt,TagOutline:gt,VideoIcon:ht,VideoOutline:ut,MapIcon:dt,MapOutline:ct,MapMarker:lt,MapMarkerOutline:pt,NcAppContent:R,NcAppNavigation:Jt,NcAppNavigationItem:it,NcButton:S,NcContent:U,SettingsDialog:me,PhotosFiltersInput:Et,PhotosFiltersDisplay:xt},setup(){const t=B(),{selectedFilters:e}=V(t);return{selectedFilters:e}},data(){return{svgplaceholder:Q,imgplaceholder:J,videoplaceholder:q,areTagsInstalled:K,showLocationMenuEntry:n()===null?!1:n().isAdmin&&y||j,showPeopleMenuEntry:n()===null?!1:n().isAdmin&&h("photos","showPeopleMenuEntry",!0)&&y||G,openedSettings:!1}},computed:{isTimelineView(){return["all_media","photos","videos"].includes(this.$store.state.route.name||"")}},async beforeMount(){const t=h("photos","nomedia-paths",[]);this.$store.dispatch("setNomediaPaths",t),i.debug("Known .nomedia and .noimage  paths",{files:t}),"serviceWorker"in navigator?window.addEventListener("load",()=>{navigator.serviceWorker.register(u("/apps/photos/service-worker.js",{},{noRewrite:!0}),{scope:u("/apps/photos")}).then(e=>{i.debug("SW registered: ",{registration:e})}).catch(e=>{i.error("SW registration failed: ",{registrationError:e})})}):i.debug("Service Worker is not enabled on this browser.")},beforeDestroy(){window.removeEventListener("load",()=>{navigator.serviceWorker.register(u("/apps/photos/service-worker.js",{},{noRewrite:!0}))})},methods:{showSettings(){this.openedSettings=!0},selectFilter(t){this.selectedFilters[t.filterId].push(t.value)},deselectFilter(t){const e=this.selectedFilters[t.filterId].indexOf(t.value);e!==-1&&this.selectedFilters[t.filterId].splice(e,1)},t:o}};var fe=function(){var t=this,e=t._self._c;return e("NcContent",{attrs:{"app-name":"photos"}},[e("NcAppNavigation",{attrs:{"aria-label":t.t("photos","Photos")},scopedSlots:t._u([t.isTimelineView?{key:"search",fn:function(){return[e("PhotosFiltersInput",{attrs:{"selected-filters":t.selectedFilters},on:{"select-filter":t.selectFilter}}),e("PhotosFiltersDisplay",{attrs:{"selected-filters":t.selectedFilters},on:{"deselect-filter":t.deselectFilter}})]},proxy:!0}:null,{key:"list",fn:function(){return[e("NcAppNavigationItem",{staticClass:"app-navigation__all_media",attrs:{to:{name:"all_media"},name:t.t("photos","All media"),"data-id-app-nav-item":"all-media",exact:""},scopedSlots:t._u([{key:"icon",fn:function({active:a}){return[a?e("ImageIcon",{attrs:{size:20}}):e("ImageOutline",{attrs:{size:20}})]}}])}),e("NcAppNavigationItem",{attrs:{to:"/photos",name:t.t("photos","Photos"),"data-id-app-nav-item":"photos"},scopedSlots:t._u([{key:"icon",fn:function({active:a}){return[a?e("Camera",{attrs:{size:20}}):e("CameraOutline",{attrs:{size:20}})]}}])}),e("NcAppNavigationItem",{attrs:{to:"/videos",name:t.t("photos","Videos"),"data-id-app-nav-item":"videos"},scopedSlots:t._u([{key:"icon",fn:function({active:a}){return[a?e("VideoIcon",{attrs:{size:20}}):e("VideoOutline",{attrs:{size:20}})]}}])}),e("NcAppNavigationItem",{attrs:{to:{name:"albums"},name:t.t("photos","Albums"),"data-id-app-nav-item":"albums"},scopedSlots:t._u([{key:"icon",fn:function({active:a}){return[a?e("ImageMultiple",{attrs:{size:20}}):e("ImageMultipleOutline",{attrs:{size:20}})]}}])}),e("NcAppNavigationItem",{attrs:{to:{name:"sharedAlbums"},name:t.t("photos","Collaborative albums"),"data-id-app-nav-item":"sharedalbums"},scopedSlots:t._u([{key:"icon",fn:function({active:a}){return[a?e("AccountGroup",{attrs:{size:20}}):e("AccountGroupOutline",{attrs:{size:20}})]}}])}),t.showPeopleMenuEntry?e("NcAppNavigationItem",{attrs:{to:{name:"faces"},name:t.t("photos","People"),"data-id-app-nav-item":"faces"},scopedSlots:t._u([{key:"icon",fn:function({active:a}){return[a?e("AccountBoxMultiple",{attrs:{size:20}}):e("AccountBoxMultipleOutline",{attrs:{size:20}})]}}],null,!1,3295904880)}):t._e(),e("NcAppNavigationItem",{attrs:{to:{name:"folders"},name:t.t("photos","Folders"),"data-id-app-nav-item":"folders"},scopedSlots:t._u([{key:"icon",fn:function({active:a}){return[a?e("Folder",{attrs:{size:20}}):e("FolderOutline",{attrs:{size:20}})]}}])}),e("NcAppNavigationItem",{attrs:{to:"/favorites",name:t.t("photos","Favorites"),"data-id-app-nav-item":"favorites"},scopedSlots:t._u([{key:"icon",fn:function({active:a}){return[a?e("Star",{attrs:{size:20}}):e("StarOutline",{attrs:{size:20}})]}}])}),e("NcAppNavigationItem",{attrs:{to:{name:"thisday"},name:t.t("photos","On this day"),"data-id-app-nav-item":"this-day"},scopedSlots:t._u([{key:"icon",fn:function({active:a}){return[a?e("CalendarToday",{attrs:{size:20}}):e("CalendarTodayOutline",{attrs:{size:20}})]}}])}),e("NcAppNavigationItem",{attrs:{to:{name:"shared"},name:t.t("photos","Shared with you"),"data-id-app-nav-item":"shared"},scopedSlots:t._u([{key:"icon",fn:function({active:a}){return[a?e("ShareVariant",{attrs:{size:20}}):e("ShareVariantOutline",{attrs:{size:20}})]}}])}),t.areTagsInstalled?e("NcAppNavigationItem",{attrs:{to:{name:"tags"},name:t.t("photos","Tags"),"data-id-app-nav-item":"tags"},scopedSlots:t._u([{key:"icon",fn:function({active:a}){return[a?e("Tag",{attrs:{size:20}}):e("TagOutline",{attrs:{size:20}})]}}],null,!1,346180464)}):t._e(),e("NcAppNavigationItem",{attrs:{to:{name:"places"},name:t.t("photos","Places"),"data-id-app-nav-item":"places"},scopedSlots:t._u([{key:"icon",fn:function({active:a}){return[a?e("MapMarker",{attrs:{size:20}}):e("MapMarkerOutline",{attrs:{size:20}})]}}])}),t.showLocationMenuEntry?e("NcAppNavigationItem",{attrs:{to:{name:"maps"},name:t.t("photos","Map"),"data-id-app-nav-item":"maps"},scopedSlots:t._u([{key:"icon",fn:function({active:a}){return[a?e("MapIcon",{attrs:{size:20}}):e("MapOutline",{attrs:{size:20}})]}}],null,!1,257739259)}):t._e()]},proxy:!0},{key:"footer",fn:function(){return[e("div",{staticClass:"app-navigation__footer"},[e("NcButton",{attrs:{variant:"tertiary",alignment:"start",wide:""},on:{click:t.showSettings},scopedSlots:t._u([{key:"icon",fn:function(){return[e("CogOutline",{attrs:{size:20}})]},proxy:!0}])},[t._v(" "+t._s(t.t("photos","Photos settings"))+" ")])],1)]},proxy:!0}],null,!0)}),e("NcAppContent",[e("RouterView"),e("span",{staticClass:"hidden-visually",attrs:{role:"none"},domProps:{innerHTML:t._s(t.svgplaceholder)}}),e("span",{staticClass:"hidden-visually",attrs:{role:"none"},domProps:{innerHTML:t._s(t.imgplaceholder)}}),e("span",{staticClass:"hidden-visually",attrs:{role:"none"},domProps:{innerHTML:t._s(t.videoplaceholder)}})],1),e("SettingsDialog",{attrs:{open:t.openedSettings},on:{"update:open":function(a){t.openedSettings=a}}})],1)},ye=[],_e=p(ve,fe,ye,!1,null,null);const Ne=_e.exports;X.sync(f,v),s.prototype.t=o,s.prototype.n=x,r("nc:metadata-photos-size"),r("nc:metadata-files-live-photo"),r("nc:metadata-blurhash"),r("nc:metadata-photos-original_date_time"),s.use(D),new s({el:"#content",name:"PhotosRoot",router:v,store:f,pinia:H(),render:t=>t(Ne)});
//# sourceMappingURL=photos-main.mjs.map

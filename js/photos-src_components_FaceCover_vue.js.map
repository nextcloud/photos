{"version":3,"file":"photos-src_components_FaceCover_vue.js?v=d1dae6def2eafbbdf0ca","mappings":";;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;AChKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;ACpCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;AChGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;AC5PA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;AC1BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAkBA;AACA;;;;;;;;;;;;;;;ACvCA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AGAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","sources":["webpack:///photos/src/components/FaceCover.vue?vue&type=script&lang=js&","webpack:///photos/src/mixins/AbortControllerMixin.js","webpack:///photos/src/mixins/FaceCoverMixin.js","webpack:///photos/src/mixins/FetchFacesMixin.js","webpack:///photos/src/components/FaceCover.vue?vue&type=style&index=0&id=acc68b4c&lang=scss&scoped=true&","webpack://photos/./src/components/FaceCover.vue?e980","webpack:///photos/src/components/FaceCover.vue","webpack://photos/./src/components/FaceCover.vue?e065","webpack://photos/./src/components/FaceCover.vue?c703","webpack:///photos/src/components/FaceCover.vue?vue&type=template&id=acc68b4c&scoped=true&","webpack://photos/./src/components/FaceCover.vue?14eb"],"sourcesContent":["function asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }\n\nfunction _asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value); } function _throw(err) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err); } _next(undefined); }); }; }\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { mapGetters } from 'vuex';\nimport { generateUrl } from '@nextcloud/router';\nimport FetchFacesMixin from '../mixins/FetchFacesMixin.js';\nimport FaceCoverMixin from '../mixins/FaceCoverMixin.js';\nexport default {\n  name: 'FaceCover',\n  mixins: [FetchFacesMixin, FaceCoverMixin],\n  props: {\n    baseName: {\n      type: String,\n      required: true\n    },\n    small: {\n      type: Boolean,\n      default: false\n    }\n  },\n  data: function data() {\n    return {\n      observer: null\n    };\n  },\n  computed: _objectSpread(_objectSpread({}, mapGetters(['files', 'faces', 'facesFiles'])), {}, {\n    /**\n     * @return {Face}\n     */\n    face: function face() {\n      return this.faces[this.baseName];\n    },\n\n    /**\n     * @return {string}\n     */\n    coverUrl: function coverUrl() {\n      if (!this.cover) {\n        return '';\n      }\n\n      return generateUrl(\"/apps/photos/api/v1/preview/\".concat(this.cover.fileid, \"?x=\", 512, \"&y=\", 512));\n    },\n    cover: function cover() {\n      return this.getFaceCover(this.face.basename);\n    },\n    coverDimensions: function coverDimensions() {\n      if (!this.cover) return {};\n      return this.getCoverStyle(this.face.basename);\n    }\n  }),\n  mounted: function mounted() {\n    var _this = this;\n\n    return _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee() {\n      return regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _this.waitForVisible(_this.$el, function (isVisible) {\n                if (!_this.facesFiles[_this.face.basename]) {\n                  _this.fetchFiles();\n                }\n              });\n\n            case 1:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }))();\n  },\n  beforeDestroy: function beforeDestroy() {\n    this.observer.disconnect();\n  },\n  methods: {\n    fetchFiles: function fetchFiles() {\n      var _this2 = this;\n\n      return _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee2() {\n        return regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                _context2.next = 2;\n                return _this2.fetchFaceContent(_this2.face.basename);\n\n              case 2:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2);\n      }))();\n    },\n    waitForVisible: function waitForVisible(el, listener) {\n      this.observer = new IntersectionObserver(function (entries, observer) {\n        entries.forEach(function (entry) {\n          if (entry.intersectionRatio > 0) {\n            listener();\n            observer.disconnect();\n          }\n        });\n      });\n      this.observer.observe(el);\n    }\n  }\n};","/**\n * @copyright Copyright (c) 2022 Louis Chemineau <louis@chmn.me>\n *\n * @author Louis Chemineau <louis@chmn.me>\n *\n * @license AGPL-3.0-or-later\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n */\nexport default {\n  name: 'AbortControllerMixin',\n  data: function data() {\n    return {\n      abortController: new AbortController()\n    };\n  },\n  beforeDestroy: function beforeDestroy() {\n    this.abortController.abort();\n  },\n  beforeRouteLeave: function beforeRouteLeave(from, to, next) {\n    this.abortController.abort();\n    this.abortController = new AbortController();\n    next();\n  }\n};","function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\n/**\n * @copyright Copyright (c) 2022 Marcel Klehr <mklehr@gmx.net>\n *\n * @author Marcel Klehr <mklehr@gmx.net>\n *\n * @license AGPL-3.0-or-later\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n */\nimport { mapGetters } from 'vuex';\nexport default {\n  name: 'FaceCoverMixin',\n  computed: _objectSpread({}, mapGetters(['faces', 'facesFiles', 'files'])),\n  methods: {\n    getFaceCover: function getFaceCover(faceName) {\n      var _this = this;\n\n      // Give high scores for faces that intersect with the edge of the picture (with a margin of half the face size)\n      var scoreFacePosition = function scoreFacePosition(faceDetection) {\n        return Math.max(0, -1 * (faceDetection.x - faceDetection.width * 0.5)) + Math.max(0, -1 * (faceDetection.y - faceDetection.height * 0.5)) + Math.max(0, -1 * (1 - (faceDetection.x + faceDetection.width) - faceDetection.width * 0.5)) + Math.max(0, -1 * (1 - (faceDetection.y + faceDetection.height) - faceDetection.height * 0.5));\n      };\n\n      return (this.facesFiles[faceName] || []).slice(0, 25).map(function (fileId) {\n        return _this.files[fileId];\n      }) // sort larges face first\n      .sort(function (a, b) {\n        return b.faceDetections.find(function (d) {\n          return d.title === faceName;\n        }).width - a.faceDetections.find(function (d) {\n          return d.title === faceName;\n        }).width;\n      }) // sort fewest face detections first\n      .sort(function (a, b) {\n        return a.faceDetections.length - b.faceDetections.length;\n      }) // Sort faces that are at the edge last\n      .sort(function (a, b) {\n        return scoreFacePosition(a.faceDetections.find(function (d) {\n          return d.title === faceName;\n        })) - scoreFacePosition(b.faceDetections.find(function (d) {\n          return d.title === faceName;\n        }));\n      })[0];\n    },\n\n    /**\n     * This will produce an inline style to apply to images\n     * to zoom toward the detected face\n     *\n     * @param faceName\n     * @return {{}|{transform: string, width: string, transformOrigin: string}}\n     */\n    getCoverStyle: function getCoverStyle(faceName) {\n      var cover = this.getFaceCover(faceName);\n\n      if (!cover) {\n        return {};\n      }\n\n      var detections = cover.faceDetections;\n      var detection = detections.find(function (detection) {\n        return detection.title === faceName;\n      }); // Zoom into the picture so that the face fills the --photos-face-width box nicely\n      // if the face is larger than the image, we don't zoom out (reason for the Math.max)\n\n      var zoom = Math.max(1, 1 / detection.width * 0.4);\n      var horizontalCenterOfFace = (detection.x + detection.width / 2) * 100;\n      var verticalCenterOfFace = (detection.y + detection.height / 2) * 100;\n      return {\n        // We assume that the image is inside a div with width: var(--photos-face-width)\n        width: '100%',\n        // we translate the image so that the center of the detected face is in the center of the --photos-face-width box\n        // and add the zoom\n        transform: \"translate(calc( var(--photos-face-width)/2 - \".concat(horizontalCenterOfFace, \"% ), calc( var(--photos-face-width)/2 - \").concat(verticalCenterOfFace, \"% )) scale(\").concat(zoom, \")\"),\n        // this is necessary for the zoom to zoom toward the center of the face\n        transformOrigin: \"\".concat(horizontalCenterOfFace, \"% \").concat(verticalCenterOfFace, \"%\")\n      };\n    }\n  }\n};","function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nfunction asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }\n\nfunction _asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value); } function _throw(err) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err); } _next(undefined); }); }; }\n\n/**\n * @copyright Copyright (c) 2022 Louis Chemineau <louis@chmn.me>\n *\n * @author Louis Chemineau <louis@chmn.me>\n *\n * @license AGPL-3.0-or-later\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n */\nimport { mapActions, mapGetters } from 'vuex';\nimport { showError } from '@nextcloud/dialogs';\nimport { getCurrentUser } from '@nextcloud/auth';\nimport client from '../services/DavClient.js';\nimport logger from '../services/logger.js';\nimport DavRequest from '../services/DavRequest';\nimport { genFileInfo } from '../utils/fileUtils';\nimport AbortControllerMixin from './AbortControllerMixin';\nimport he from 'he';\nexport default {\n  name: 'FetchFacesMixin',\n  data: function data() {\n    return {\n      errorFetchingFaces: null,\n      loadingFaces: false,\n      errorFetchingFiles: null,\n      loadingFiles: false\n    };\n  },\n  mixins: [AbortControllerMixin],\n  beforeMount: function beforeMount() {\n    var _this = this;\n\n    return _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee() {\n      return regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _this.fetchFaces();\n\n            case 1:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }))();\n  },\n  computed: _objectSpread({}, mapGetters(['faces'])),\n  methods: _objectSpread(_objectSpread({}, mapActions(['appendFiles'])), {}, {\n    fetchFaces: function fetchFaces() {\n      var _this2 = this;\n\n      return _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee2() {\n        var _getCurrentUser, _yield$client$getDire, faces;\n\n        return regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                if (!_this2.loadingFaces) {\n                  _context2.next = 2;\n                  break;\n                }\n\n                return _context2.abrupt(\"return\");\n\n              case 2:\n                if (!Object.keys(_this2.faces).length) {\n                  _context2.next = 4;\n                  break;\n                }\n\n                return _context2.abrupt(\"return\");\n\n              case 4:\n                _context2.prev = 4;\n                _this2.loadingFaces = true;\n                _this2.errorFetchingFaces = null;\n                _context2.next = 9;\n                return client.getDirectoryContents(\"/recognize/\".concat((_getCurrentUser = getCurrentUser()) === null || _getCurrentUser === void 0 ? void 0 : _getCurrentUser.uid, \"/faces/\"), {\n                  data: DavRequest,\n                  details: true,\n                  signal: _this2.abortController.signal\n                });\n\n              case 9:\n                _yield$client$getDire = _context2.sent;\n                faces = _yield$client$getDire.data;\n\n                _this2.$store.dispatch('addFaces', {\n                  faces: faces\n                });\n\n                logger.debug(\"[FetchFacesMixin] Fetched \".concat(faces.length, \" new faces: \"), faces);\n                _context2.next = 20;\n                break;\n\n              case 15:\n                _context2.prev = 15;\n                _context2.t0 = _context2[\"catch\"](4);\n\n                if (_context2.t0.response && _context2.t0.response.status) {\n                  if (_context2.t0.response.status === 404) {\n                    _this2.errorFetchingFaces = 404;\n                  } else {\n                    _this2.errorFetchingFaces = _context2.t0;\n                  }\n                }\n\n                logger.error(t('photos', 'Failed to fetch faces list.'), {\n                  error: _context2.t0\n                });\n                showError(t('photos', 'Failed to fetch faces list.'));\n\n              case 20:\n                _context2.prev = 20;\n                _this2.loadingFaces = false;\n                return _context2.finish(20);\n\n              case 23:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, null, [[4, 15, 20, 23]]);\n      }))();\n    },\n    fetchFaceContent: function fetchFaceContent(faceName, force) {\n      var _this3 = this;\n\n      return _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee3() {\n        var _getCurrentUser2, _yield$client$getDire2, fetchedFiles, fileIds;\n\n        return regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                if (!_this3.loadingFiles) {\n                  _context3.next = 2;\n                  break;\n                }\n\n                return _context3.abrupt(\"return\");\n\n              case 2:\n                if (!(!force && _this3.facesFiles[faceName] && _this3.facesFiles[faceName].length)) {\n                  _context3.next = 4;\n                  break;\n                }\n\n                return _context3.abrupt(\"return\");\n\n              case 4:\n                _context3.prev = 4;\n                _this3.errorFetchingFiles = null;\n                _this3.loadingFiles = true;\n                _context3.next = 9;\n                return client.getDirectoryContents(\"/recognize/\".concat((_getCurrentUser2 = getCurrentUser()) === null || _getCurrentUser2 === void 0 ? void 0 : _getCurrentUser2.uid, \"/faces/\").concat(faceName), {\n                  data: DavRequest,\n                  details: true,\n                  signal: _this3.abortController.signal\n                });\n\n              case 9:\n                _yield$client$getDire2 = _context3.sent;\n                fetchedFiles = _yield$client$getDire2.data;\n                fetchedFiles = fetchedFiles.map(function (file) {\n                  return genFileInfo(file);\n                }).map(function (file) {\n                  return _objectSpread(_objectSpread({}, file), {}, {\n                    filename: file.realpath.replace(\"/\".concat(getCurrentUser().uid, \"/files\"), \"/files/\".concat(getCurrentUser().uid))\n                  });\n                }).map(function (file) {\n                  return _objectSpread(_objectSpread({}, file), {}, {\n                    faceDetections: JSON.parse(he.decode(file.faceDetections))\n                  });\n                });\n                fileIds = fetchedFiles.map(function (file) {\n                  return '' + file.fileid;\n                });\n\n                _this3.appendFiles(fetchedFiles);\n\n                if (!(fetchedFiles.length > 0)) {\n                  _context3.next = 17;\n                  break;\n                }\n\n                _context3.next = 17;\n                return _this3.$store.commit('addFilesToFace', {\n                  faceName: faceName,\n                  fileIdsToAdd: fileIds\n                });\n\n              case 17:\n                logger.debug(\"[FetchFacesMixin] Fetched \".concat(fileIds.length, \" new files: \"), fileIds);\n                _context3.next = 24;\n                break;\n\n              case 20:\n                _context3.prev = 20;\n                _context3.t0 = _context3[\"catch\"](4);\n\n                if (_context3.t0.response && _context3.t0.response.status) {\n                  if (_context3.t0.response.status === 404) {\n                    _this3.errorFetchingFiles = 404;\n                  } else {\n                    _this3.errorFetchingFiles = _context3.t0;\n                  }\n                } // cancelled request, moving on...\n\n\n                logger.error('Error fetching face files', {\n                  error: _context3.t0\n                });\n\n              case 24:\n                _context3.prev = 24;\n                _this3.loadingFiles = false;\n                return _context3.finish(24);\n\n              case 27:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, null, [[4, 20, 24, 27]]);\n      }))();\n    }\n  })\n};","// Imports\nimport ___CSS_LOADER_API_NO_SOURCEMAP_IMPORT___ from \"../../node_modules/css-loader/dist/runtime/noSourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_NO_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, \".face-cover[data-v-acc68b4c] {\\n  display: flex;\\n  flex-direction: column;\\n  padding: 10px;\\n  border-radius: var(--border-radius-large);\\n}\\n.face-cover__crop-container[data-v-acc68b4c] {\\n  overflow: hidden;\\n  width: 250px;\\n  height: 250px;\\n  border-radius: 250px;\\n  position: relative;\\n  background: var(--color-background-darker);\\n  --photos-face-width: 250px;\\n}\\n@media only screen and (max-width: 1020px) {\\n.face-cover__crop-container[data-v-acc68b4c] {\\n    width: 95px;\\n    height: 95px;\\n    --photos-face-width: 95px;\\n}\\n}\\n.face-cover[data-v-acc68b4c]:hover, .face-cover[data-v-acc68b4c]:focus {\\n  background: var(--color-background-hover);\\n}\\n.face-cover__details[data-v-acc68b4c] {\\n  display: flex;\\n  flex-direction: column;\\n  width: 250px;\\n  margin-top: 4px;\\n  text-align: center;\\n}\\n@media only screen and (max-width: 1020px) {\\n.face-cover__details[data-v-acc68b4c] {\\n    width: 95px;\\n}\\n}\\n.face-cover__details__first-line[data-v-acc68b4c] {\\n  display: flex;\\n  height: 2em;\\n  overflow: hidden;\\n  text-overflow: ellipsis;\\n}\\n.face-cover__details__second-line[data-v-acc68b4c] {\\n  margin-top: 6px;\\n  color: var(--color-text-maxcontrast);\\n}\\n.face-cover__details__name[data-v-acc68b4c] {\\n  flex-grow: 1;\\n  margin: 0;\\n}\\n.face-cover--small *[data-v-acc68b4c] {\\n  font-size: 15px !important;\\n}\\n.face-cover--small .face-cover__details[data-v-acc68b4c] {\\n  width: 60px !important;\\n}\\n.face-cover--small .face-cover__crop-container[data-v-acc68b4c] {\\n  width: 60px !important;\\n  height: 60px !important;\\n  --photos-face-width: 60px !important;\\n}\", \"\"]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","\n      import API from \"!../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\";\n      import domAPI from \"!../../node_modules/style-loader/dist/runtime/styleDomAPI.js\";\n      import insertFn from \"!../../node_modules/style-loader/dist/runtime/insertBySelector.js\";\n      import setAttributes from \"!../../node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js\";\n      import insertStyleElement from \"!../../node_modules/style-loader/dist/runtime/insertStyleElement.js\";\n      import styleTagTransformFn from \"!../../node_modules/style-loader/dist/runtime/styleTagTransform.js\";\n      import content, * as namedExport from \"!!../../node_modules/css-loader/dist/cjs.js!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/dist/cjs.js!../../node_modules/sass-loader/dist/cjs.js??clonedRuleSet-2[0].rules[0].use[3]!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./FaceCover.vue?vue&type=style&index=0&id=acc68b4c&lang=scss&scoped=true&\";\n      \n      \n\nvar options = {};\n\noptions.styleTagTransform = styleTagTransformFn;\noptions.setAttributes = setAttributes;\n\n      options.insert = insertFn.bind(null, \"head\");\n    \noptions.domAPI = domAPI;\noptions.insertStyleElement = insertStyleElement;\n\nvar update = API(content, options);\n\n\n\nexport * from \"!!../../node_modules/css-loader/dist/cjs.js!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/dist/cjs.js!../../node_modules/sass-loader/dist/cjs.js??clonedRuleSet-2[0].rules[0].use[3]!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./FaceCover.vue?vue&type=style&index=0&id=acc68b4c&lang=scss&scoped=true&\";\n       export default content && content.locals ? content.locals : undefined;\n","import { render, staticRenderFns } from \"./FaceCover.vue?vue&type=template&id=acc68b4c&scoped=true&\"\nimport script from \"./FaceCover.vue?vue&type=script&lang=js&\"\nexport * from \"./FaceCover.vue?vue&type=script&lang=js&\"\nimport style0 from \"./FaceCover.vue?vue&type=style&index=0&id=acc68b4c&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"acc68b4c\",\n  null\n  \n)\n\n/* hot reload */\nif (module.hot) {\n  var api = require(\"/var/www/nextcloud/apps/photos/node_modules/vue-hot-reload-api/dist/index.js\")\n  api.install(require('vue'))\n  if (api.compatible) {\n    module.hot.accept()\n    if (!api.isRecorded('acc68b4c')) {\n      api.createRecord('acc68b4c', component.options)\n    } else {\n      api.reload('acc68b4c', component.options)\n    }\n    module.hot.accept(\"./FaceCover.vue?vue&type=template&id=acc68b4c&scoped=true&\", function () {\n      api.rerender('acc68b4c', {\n        render: render,\n        staticRenderFns: staticRenderFns\n      })\n    })\n  }\n}\ncomponent.options.__file = \"src/components/FaceCover.vue\"\nexport default component.exports","import mod from \"-!../../node_modules/babel-loader/lib/index.js!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./FaceCover.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/babel-loader/lib/index.js!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./FaceCover.vue?vue&type=script&lang=js&\"","export * from \"-!../../node_modules/style-loader/dist/cjs.js!../../node_modules/css-loader/dist/cjs.js!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/dist/cjs.js!../../node_modules/sass-loader/dist/cjs.js??clonedRuleSet-2[0].rules[0].use[3]!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./FaceCover.vue?vue&type=style&index=0&id=acc68b4c&lang=scss&scoped=true&\"","export * from \"-!../../node_modules/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./FaceCover.vue?vue&type=template&id=acc68b4c&scoped=true&\"","var render = function () {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  return _c(\n    \"div\",\n    {\n      class: [\"face-cover\", _vm.small && \"face-cover--small\"],\n      on: {\n        click: function ($event) {\n          return _vm.$emit(\"click\")\n        },\n      },\n    },\n    [\n      _c(\"div\", { staticClass: \"face-cover__crop-container\" }, [\n        _c(\"img\", {\n          ref: \"image\",\n          staticClass: \"face-cover__image\",\n          style: _vm.coverDimensions,\n          attrs: { src: _vm.coverUrl },\n        }),\n      ]),\n      _vm._v(\" \"),\n      _c(\"div\", { staticClass: \"face-cover__details\" }, [\n        !_vm.baseName.match(/^[0-9]+$/)\n          ? _c(\"div\", { staticClass: \"face-cover__details__first-line\" }, [\n              _c(\"h2\", { staticClass: \"face-cover__details__name\" }, [\n                _vm._v(\"\\n\\t\\t\\t\\t\" + _vm._s(_vm.baseName) + \"\\n\\t\\t\\t\"),\n              ]),\n            ])\n          : _vm._e(),\n        _vm._v(\" \"),\n        _vm.facesFiles[_vm.baseName] && !_vm.small\n          ? _c(\"div\", { staticClass: \"face-cover__details__second-line\" }, [\n              _vm._v(\n                \"\\n\\t\\t\\t\" +\n                  _vm._s(\n                    _vm.n(\n                      \"photos\",\n                      \"%n photos\",\n                      \"%n photos\",\n                      _vm.facesFiles[_vm.baseName].length\n                    )\n                  ) +\n                  \"\\n\\t\\t\"\n              ),\n            ])\n          : _vm._e(),\n      ]),\n    ]\n  )\n}\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns }"],"names":[],"sourceRoot":""}
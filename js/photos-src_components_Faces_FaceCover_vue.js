"use strict";(self.webpackChunkphotos=self.webpackChunkphotos||[]).push([["src_components_Faces_FaceCover_vue"],{34003(t,e,n){n.d(e,{A:()=>s});var r=n(95353),o=n(66067),a=n.n(o);function i(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function c(t,e,n){return(e=function(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}const s={name:"FaceCoverMixin",computed:function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?i(Object(n),!0).forEach((function(e){c(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({},(0,r.L8)(["faces","facesFiles","files"])),methods:{getFaceCover(t){return JSON.parse(a().decode(this.faces[t].props["face-preview-image"]||"{}"))},getCoverStyle(t){const e=this.getFaceCover(t);if(!e||!e.detection)return{};const n=e.detection,r=Math.max(1,1/n.width*.4),o=100*(n.x+n.width/2),a=100*(n.y+n.height/2);return{width:"100%",transform:"translate(calc( var(--photos-face-width)/2 - ".concat(o,"% ), calc( var(--photos-face-width)/2 - ").concat(a,"% )) scale(").concat(r,")"),transformOrigin:"".concat(o,"% ").concat(a,"%")}}}}},44671(e,n,r){r.d(n,{A:()=>m});var o=r(95353),a=r(85168),i=r(21777),c=r(59006),s=r(63360),l=r(32041),d=r(83984),f=r(58637),p=r(66067),A=r.n(p);function u(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function h(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?u(Object(n),!0).forEach((function(e){g(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):u(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function g(t,e,n){return(e=function(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}const v=["<nc:face-detections/>","<nc:face-preview-image/>","<nc:realpath/>"],m={name:"FetchFacesMixin",data:()=>({errorFetchingFaces:null,loadingFaces:!1,errorFetchingFiles:null,loadingFiles:!1}),mixins:[f.A],async beforeMount(){this.fetchFaces()},computed:h({},(0,o.L8)(["faces"])),methods:h(h({},(0,o.i0)(["appendFiles"])),{},{async fetchFaces(){if(!this.loadingFaces&&!Object.keys(this.faces).length)try{var e;this.loadingFaces=!0,this.errorFetchingFaces=null;const{data:t}=await c.Ay.getDirectoryContents("/recognize/".concat(null===(e=(0,i.HW)())||void 0===e?void 0:e.uid,"/faces/"),{data:(0,l.D0)(v),details:!0,signal:this.abortController.signal});this.$store.dispatch("addFaces",{faces:t}),s.A.debug("[FetchFacesMixin] Fetched ".concat(t.length," new faces: "),t)}catch(e){e.response&&e.response.status&&(404===e.response.status?this.errorFetchingFaces=404:this.errorFetchingFaces=e),s.A.error(t("photos","Failed to fetch faces list."),{error:e}),(0,a.Qg)(t("photos","Failed to fetch faces list."))}finally{this.loadingFaces=!1}},async fetchFaceContent(t,e){if(!this.loadingFiles&&(e||!this.facesFiles[t]||!this.facesFiles[t].length))try{var n;this.errorFetchingFiles=null,this.loadingFiles=!0;let{data:e}=await c.Ay.getDirectoryContents("/recognize/".concat(null===(n=(0,i.HW)())||void 0===n?void 0:n.uid,"/faces/").concat(t),{data:(0,l.mj)(v),details:!0,signal:this.abortController.signal});e=e.map((t=>(0,d.JR)(t))).map((t=>h(h({},t),{},{filename:A().decode(t.realpath).replace("/".concat((0,i.HW)().uid,"/files"),"/files/".concat((0,i.HW)().uid))}))).map((t=>h(h({},t),{},{faceDetections:JSON.parse(A().decode(t.faceDetections))})));const r=e.map((t=>""+t.fileid));this.appendFiles(e),e.length>0&&await this.$store.commit("addFilesToFace",{faceName:t,fileIdsToAdd:r}),s.A.debug("[FetchFacesMixin] Fetched ".concat(r.length," new files: "),r)}catch(t){t.response&&t.response.status&&(404===t.response.status?this.errorFetchingFiles=404:this.errorFetchingFiles=t),s.A.error("Error fetching face files",{error:t})}finally{this.loadingFiles=!1}},async fetchUnassignedFaces(t){if(!this.loadingFiles&&(t||!this.unassignedFiles||!this.unassignedFiles.length))try{var e;this.errorFetchingFiles=null,this.loadingFiles=!0;let{data:t}=await c.Ay.getDirectoryContents("/recognize/".concat(null===(e=(0,i.HW)())||void 0===e?void 0:e.uid,"/unassigned-faces"),{data:(0,l.D0)(v),details:!0,signal:this.abortController.signal});t=t.map((t=>(0,d.JR)(t))).map((t=>h(h({},t),{},{filename:A().decode(t.realpath).replace("/".concat((0,i.HW)().uid,"/files"),"/files/".concat((0,i.HW)().uid))}))).map((t=>h(h({},t),{},{faceDetections:JSON.parse(A().decode(t.faceDetections))})));const n=t.map((t=>""+t.fileid));this.appendFiles(t),t.length>0&&await this.$store.commit("addUnassignedFiles",{fileIdsToAdd:n}),s.A.debug("[FetchFacesMixin] Fetched ".concat(n.length," new unassigned files: "),n)}catch(t){t.response&&t.response.status&&(404===t.response.status?this.errorFetchingFiles=404:this.errorFetchingFiles=t),s.A.error("Error fetching unassigned files",{error:t})}finally{this.loadingFiles=!1}},async fetchUnassignedFacesCount(){try{var t;const{data:e}=await c.Ay.stat("/recognize/".concat(null===(t=(0,i.HW)())||void 0===t?void 0:t.uid,"/unassigned-faces"),{data:(0,l.D0)(v),details:!0,signal:this.abortController.signal}),n=Number(e.props.nbItems);await this.$store.commit("setUnassignedFilesCount",n),s.A.debug("[FetchFacesMixin] Fetched unassigned files count: ",n)}catch(t){s.A.error("Error fetching unassigned files count",{error:t})}}})}},32041(t,e,n){n.d(e,{An:()=>u,D0:()=>f,et:()=>g,mj:()=>p,t9:()=>A});var r=n(51651),o=n(53334),a=n(59006),i=n(63360),c=n(83984);function s(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function l(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?s(Object(n),!0).forEach((function(e){d(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function d(t,e,n){return(e=function(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function f(){return'<?xml version="1.0"?>\n\t\t\t<d:propfind xmlns:d="DAV:"\n\t\t\t\txmlns:oc="http://owncloud.org/ns"\n\t\t\t\txmlns:nc="http://nextcloud.org/ns"\n\t\t\t\txmlns:ocs="http://open-collaboration-services.org/ns">\n\t\t\t\t<d:prop>\n\t\t\t\t\t<nc:last-photo />\n\t\t\t\t\t<nc:nbItems />\n\t\t\t\t\t'.concat((arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).join(""),"\n\t\t\t\t</d:prop>\n\t\t\t</d:propfind>")}function p(){return'<?xml version="1.0"?>\n\t\t\t<d:propfind xmlns:d="DAV:"\n\t\t\t\txmlns:oc="http://owncloud.org/ns"\n\t\t\t\txmlns:nc="http://nextcloud.org/ns"\n\t\t\t\txmlns:ocs="http://open-collaboration-services.org/ns">\n\t\t\t\t<d:prop>\n\t\t\t\t\t<d:getcontentlength />\n\t\t\t\t\t<d:getcontenttype />\n\t\t\t\t\t<d:getetag />\n\t\t\t\t\t<d:getlastmodified />\n\t\t\t\t\t<d:resourcetype />\n\t\t\t\t\t<nc:metadata-photos-size />\n\t\t\t\t\t<nc:metadata-photos-original_date_time />\n\t\t\t\t\t<nc:metadata-files-live-photo />\n\t\t\t\t\t<nc:has-preview />\n\t\t\t\t\t<nc:hidden />\n\t\t\t\t\t<oc:favorite />\n\t\t\t\t\t<oc:fileid />\n\t\t\t\t\t<oc:permissions />\n\t\t\t\t\t'.concat((arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).join("\n\t\t\t\t\t"),"\n\t\t\t\t</d:prop>\n\t\t\t</d:propfind>")}async function A(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:a.Ay;try{const o=await r.stat(t,l({data:f(n),details:!0},e));return i.A.debug("[Collections] Fetched a collection: ",{data:o.data}),h(o.data)}catch(t){if(t instanceof DOMException&&t.code===t.ABORT_ERR)return null;throw t}}async function u(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:a.Ay;try{const o=await r.getDirectoryContents(t,l({data:f(n),details:!0},e));return i.A.debug("[Collections] Fetched ".concat(o.data.length," collections: "),{data:o.data}),o.data.filter((e=>e.filename!==t)).map(h)}catch(t){if(t instanceof DOMException&&t.code===t.ABORT_ERR)return[];throw t}}function h(t){var e,n;void 0===t.props.collaborators||""===t.props.collaborators?t.props.collaborators=[]:"object"==typeof t.props.collaborators.collaborator&&(Array.isArray(t.props.collaborators.collaborator)?t.props.collaborators=t.props.collaborators.collaborator:t.props.collaborators=[t.props.collaborators.collaborator]),t=(0,c.JR)(t);const a=JSON.parse(null!==(e=null===(n=t.dateRange)||void 0===n?void 0:n.replace(/&quot;/g,'"'))&&void 0!==e?e:"{}");null===a.start&&(a.start=(0,r.A)().unix(),a.end=(0,r.A)().unix());const i={startDate:r.A.unix(a.start).format("MMMM YYYY"),endDate:r.A.unix(a.end).format("MMMM YYYY")};return t.date=i.startDate===i.endDate?i.startDate:(0,o.Tl)("photos","{startDate} to {endDate}",i),t}async function g(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:a.Ay;try{const o=(await r.getDirectoryContents(t,l({data:p(n),details:!0},e))).data.map((t=>(0,c.JR)(t))).filter((t=>t.fileid));return i.A.debug("[Collections] Fetched ".concat(o.length," new files: "),o),o}catch(t){if(t instanceof DOMException&&t.code===t.ABORT_ERR)return[];throw i.A.error("Error fetching collection files",{error:t}),console.error(t),t}}},62702(t,e,n){n.d(e,{A:()=>c});var r=n(71354),o=n.n(r),a=n(76314),i=n.n(a)()(o());i.push([t.id,".face-cover[data-v-71f53f04]{display:flex;flex-direction:column;padding:10px;border-radius:var(--border-radius-large)}.face-cover__crop-container[data-v-71f53f04]{overflow:hidden;width:128px;height:128px;border-radius:128px;position:relative;background:var(--color-background-darker);--photos-face-width: 128px}@media only screen and (max-width: 1020px){.face-cover__crop-container[data-v-71f53f04]{width:95px;height:95px;--photos-face-width: 95px}}.face-cover[data-v-71f53f04]:hover,.face-cover[data-v-71f53f04]:focus{background:var(--color-background-hover)}.face-cover__details[data-v-71f53f04]{display:flex;flex-direction:column;width:128px;margin-top:4px;text-align:center}@media only screen and (max-width: 1020px){.face-cover__details[data-v-71f53f04]{width:95px}}.face-cover__details__first-line[data-v-71f53f04]{display:flex;height:2em;overflow:hidden;text-overflow:ellipsis}.face-cover__details__second-line[data-v-71f53f04]{margin-top:6px;color:var(--color-text-maxcontrast)}.face-cover__details__name[data-v-71f53f04]{flex-grow:1;margin:0;font-weight:bold;font-size:20px;line-height:30px;color:var(--color-main-text)}.face-cover--small *[data-v-71f53f04]{font-size:15px !important}.face-cover--small .face-cover__details[data-v-71f53f04]{width:60px !important}.face-cover--small .face-cover__crop-container[data-v-71f53f04]{width:60px !important;height:60px !important;--photos-face-width: 60px !important}","",{version:3,sources:["webpack://./src/mixins/FaceCover.scss"],names:[],mappings:"AAIA,6BACC,YAAA,CACA,qBAAA,CACA,YAAA,CACA,wCAAA,CAEA,6CACC,eAAA,CACA,WAAA,CACA,YAAA,CACA,mBAAA,CACA,iBAAA,CACA,yCAAA,CACA,0BAAA,CAEA,2CATD,6CAUE,UAAA,CACA,WAAA,CACA,yBAAA,CAAA,CAIF,sEACC,wCAAA,CAGD,sCACC,YAAA,CACA,qBAAA,CACA,WAAA,CACA,cAAA,CACA,iBAAA,CAEA,2CAPD,sCAQE,UAAA,CAAA,CAGD,kDACC,YAAA,CACA,UAAA,CACA,eAAA,CACA,sBAAA,CAGD,mDACC,cAAA,CACA,mCAAA,CAGD,4CACC,WAAA,CACA,QAAA,CACA,gBAAA,CACA,cAAA,CACA,gBAAA,CACA,4BAAA,CAMF,sCACC,yBAAA,CAED,yDACC,qBAAA,CAED,gEACC,qBAAA,CACA,sBAAA,CACA,oCAAA",sourcesContent:["/**\n * SPDX-FileCopyrightText: 2023 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n.face-cover {\n\tdisplay: flex;\n\tflex-direction: column;\n\tpadding: 10px;\n\tborder-radius: var(--border-radius-large);\n\n\t&__crop-container {\n\t\toverflow: hidden;\n\t\twidth: 128px;\n\t\theight: 128px;\n\t\tborder-radius: 128px;\n\t\tposition: relative;\n\t\tbackground: var(--color-background-darker);\n\t\t--photos-face-width: 128px;\n\n\t\t@media only screen and (max-width: 1020px) {\n\t\t\twidth: 95px;\n\t\t\theight: 95px;\n\t\t\t--photos-face-width: 95px;\n\t\t}\n\t}\n\n\t&:hover, &:focus {\n\t\tbackground: var(--color-background-hover);\n\t}\n\n\t&__details {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\twidth: 128px;\n\t\tmargin-top: 4px;\n\t\ttext-align: center;\n\n\t\t@media only screen and (max-width: 1020px) {\n\t\t\twidth: 95px;\n\t\t}\n\n\t\t&__first-line {\n\t\t\tdisplay: flex;\n\t\t\theight: 2em;\n\t\t\toverflow: hidden;\n\t\t\ttext-overflow: ellipsis;\n\t\t}\n\n\t\t&__second-line {\n\t\t\tmargin-top: 6px;\n\t\t\tcolor: var(--color-text-maxcontrast);\n\t\t}\n\n\t\t&__name {\n\t\t\tflex-grow: 1;\n\t\t\tmargin: 0;\n\t\t\tfont-weight: bold;\n\t\t\tfont-size: 20px;\n\t\t\tline-height: 30px;\n\t\t\tcolor: var(--color-main-text);\n\t\t}\n\t}\n}\n\n.face-cover--small {\n\t* {\n\t\tfont-size: 15px !important;\n\t}\n\t.face-cover__details {\n\t\twidth: 60px !important;\n\t}\n\t.face-cover__crop-container {\n\t\twidth: 60px !important;\n\t\theight: 60px !important;\n\t\t--photos-face-width: 60px !important;\n\t}\n}\n"],sourceRoot:""}]);const c=i},10462(t,e,n){n.d(e,{A:()=>F});var r=n(95353),o=n(63814),a=n(44671),i=n(34003);function c(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function s(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?c(Object(n),!0).forEach((function(e){l(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function l(t,e,n){return(e=function(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}const d={name:"FaceCover",mixins:[a.A,i.A],props:{baseName:{type:String,required:!0},small:{type:Boolean,default:!1}},data:()=>({observer:null}),computed:s(s({},(0,r.L8)(["files","faces","facesFiles"])),{},{face(){return this.faces[this.baseName]},coverUrl(){return this.cover?(0,o.Jv)("/apps/photos/api/v1/preview/".concat(this.cover.fileid,"?x=",512,"&y=",512)):""},cover(){return this.getFaceCover(this.face.basename)},coverDimensions(){return this.cover?this.getCoverStyle(this.face.basename):{}}})};var f=n(85072),p=n.n(f),A=n(97825),u=n.n(A),h=n(77659),g=n.n(h),v=n(55056),m=n.n(v),b=n(10540),y=n.n(b),C=n(41113),x=n.n(C),w=n(62702),O={};O.styleTagTransform=x(),O.setAttributes=m(),O.insert=g().bind(null,"head"),O.domAPI=u(),O.insertStyleElement=y();p()(w.A,O);w.A&&w.A.locals&&w.A.locals;const F=(0,n(14486).A)(d,(function(){var t=this,e=t._self._c;return e("div",{class:["face-cover",t.small&&"face-cover--small"],on:{click:function(e){return t.$emit("click")}}},[e("div",{staticClass:"face-cover__crop-container"},[e("img",{ref:"image",staticClass:"face-cover__image",style:t.coverDimensions,attrs:{src:t.coverUrl}})]),t._v(" "),e("div",{staticClass:"face-cover__details"},[t.baseName.match(/^[0-9]+$/)?t._e():e("div",{staticClass:"face-cover__details__first-line"},[e("span",{staticClass:"face-cover__details__name"},[t._v("\n\t\t\t\t"+t._s(t.baseName)+"\n\t\t\t")])]),t._v(" "),t.small?t._e():e("div",{staticClass:"face-cover__details__second-line"},[t._v("\n\t\t\t"+t._s(t.n("photos","%n photos","%n photos",t.face.props.nbItems))+"\n\t\t")])])])}),[],!1,null,"71f53f04",null).exports}}]);
//# sourceMappingURL=photos-src_components_Faces_FaceCover_vue.js.map?v=9792d1acffe33e14c5c3